{"version":3,"file":"EditorPage-xKmvdPKM.js","sources":["../../../frontend/src/stores/editorStore.js","../../../frontend/src/composables/usePdfRenderer.js","../../../frontend/src/composables/useFabricCanvas.js","../../../frontend/src/composables/usePdfModifier.js","../../../frontend/src/composables/useAnnotations.js","../../../frontend/src/composables/usePdfTextEditor.js","../../../frontend/src/components/editor/ToolButton.vue","../../../frontend/src/components/editor/PdfToolbar.vue","../../../frontend/src/components/editor/PdfPageCanvas.vue","../../../frontend/src/components/editor/PdfCanvas.vue","../../../frontend/src/components/editor/PdfSidebar.vue","../../../frontend/src/components/editor/PdfPropertiesPanel.vue","../../../frontend/src/components/editor/PdfStatusBar.vue","../../../frontend/src/components/editor/PdfSearchBar.vue","../../../frontend/src/components/editor/ServerToolPanel.vue","../../../frontend/src/components/editor/PdfEditor.vue","../../../frontend/src/pages/EditorPage.vue"],"sourcesContent":["/**\r\n * Pinia store for PDF editor state.\r\n */\r\nimport { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\n\r\nexport const useEditorStore = defineStore('editor', () => {\r\n  // Document state\r\n  const fileUrl = ref('')\r\n  const fileName = ref('')\r\n  const fileSize = ref(0)\r\n  const totalPages = ref(0)\r\n  const currentPage = ref(1)\r\n\r\n  // View state\r\n  const scale = ref(1.0)\r\n  const sidebarTab = ref('thumbnails') // thumbnails, outline, annotations, layers\r\n  const showSidebar = ref(true)\r\n  const showProperties = ref(false)\r\n\r\n  // Tool state\r\n  const activeTool = ref('select')\r\n  const toolOptions = ref({\r\n    color: '#000000',\r\n    fontSize: 16,\r\n    fontFamily: 'Helvetica',\r\n    strokeWidth: 2,\r\n    opacity: 1,\r\n    highlightColor: '#ffff00',\r\n  })\r\n\r\n  // Editing state\r\n  const isDirty = ref(false)\r\n  const sessionName = ref(null)\r\n  const lastSaved = ref(null)\r\n\r\n  // Embed mode (when loaded in iframe)\r\n  const isEmbedded = ref(false)\r\n  const allowedTools = ref(null) // null = all tools, or array of tool names\r\n\r\n  const zoomPercent = computed(() => Math.round(scale.value * 100))\r\n\r\n  function setDocument(url, name, size, pages) {\r\n    fileUrl.value = url\r\n    fileName.value = name\r\n    fileSize.value = size\r\n    totalPages.value = pages\r\n    currentPage.value = 1\r\n    isDirty.value = false\r\n    sessionName.value = null\r\n    lastSaved.value = null\r\n  }\r\n\r\n  function setTool(tool) {\r\n    activeTool.value = tool\r\n  }\r\n\r\n  function updateToolOptions(opts) {\r\n    toolOptions.value = { ...toolOptions.value, ...opts }\r\n  }\r\n\r\n  function markDirty() {\r\n    isDirty.value = true\r\n  }\r\n\r\n  function markSaved(name) {\r\n    isDirty.value = false\r\n    sessionName.value = name\r\n    lastSaved.value = new Date().toISOString()\r\n  }\r\n\r\n  function setEmbedMode(tools = null) {\r\n    isEmbedded.value = true\r\n    allowedTools.value = tools\r\n  }\r\n\r\n  function reset() {\r\n    fileUrl.value = ''\r\n    fileName.value = ''\r\n    fileSize.value = 0\r\n    totalPages.value = 0\r\n    currentPage.value = 1\r\n    scale.value = 1.0\r\n    activeTool.value = 'select'\r\n    isDirty.value = false\r\n    sessionName.value = null\r\n    lastSaved.value = null\r\n  }\r\n\r\n  return {\r\n    fileUrl,\r\n    fileName,\r\n    fileSize,\r\n    totalPages,\r\n    currentPage,\r\n    scale,\r\n    zoomPercent,\r\n    sidebarTab,\r\n    showSidebar,\r\n    showProperties,\r\n    activeTool,\r\n    toolOptions,\r\n    isDirty,\r\n    sessionName,\r\n    lastSaved,\r\n    isEmbedded,\r\n    allowedTools,\r\n    setDocument,\r\n    setTool,\r\n    updateToolOptions,\r\n    markDirty,\r\n    markSaved,\r\n    setEmbedMode,\r\n    reset,\r\n  }\r\n})\r\n","/**\r\n * Composable for rendering PDF pages using PDF.js.\r\n * Handles loading, page rendering, zoom, and continuous scroll.\r\n */\r\nimport { ref, shallowRef, computed, onUnmounted } from 'vue'\r\nimport * as pdfjsLib from 'pdfjs-dist'\r\n\r\n// Set worker path (PDF.js requires a web worker)\r\npdfjsLib.GlobalWorkerOptions.workerSrc = new URL(\r\n  'pdfjs-dist/build/pdf.worker.min.mjs',\r\n  import.meta.url\r\n).toString()\r\n\r\nexport function usePdfRenderer() {\r\n  const pdfDoc = shallowRef(null)\r\n  const totalPages = ref(0)\r\n  const currentPage = ref(1)\r\n  const scale = ref(1.0)\r\n  const loading = ref(false)\r\n  const error = ref('')\r\n  const pageRendering = ref(false)\r\n  const fileName = ref('')\r\n\r\n  const zoomPercent = computed(() => Math.round(scale.value * 100))\r\n\r\n  async function loadPdf(source) {\r\n    loading.value = true\r\n    error.value = ''\r\n\r\n    try {\r\n      let loadingTask\r\n\r\n      if (source instanceof ArrayBuffer || source instanceof Uint8Array) {\r\n        loadingTask = pdfjsLib.getDocument({ data: source })\r\n      } else if (source instanceof File) {\r\n        fileName.value = source.name\r\n        const arrayBuffer = await source.arrayBuffer()\r\n        loadingTask = pdfjsLib.getDocument({ data: arrayBuffer })\r\n      } else if (typeof source === 'string') {\r\n        // URL\r\n        fileName.value = source.split('/').pop()\r\n        loadingTask = pdfjsLib.getDocument(source)\r\n      } else {\r\n        throw new Error('Invalid PDF source')\r\n      }\r\n\r\n      const pdf = await loadingTask.promise\r\n      pdfDoc.value = pdf\r\n      totalPages.value = pdf.numPages\r\n      currentPage.value = 1\r\n    } catch (e) {\r\n      error.value = e.message || 'Failed to load PDF'\r\n      pdfDoc.value = null\r\n      totalPages.value = 0\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  async function renderPage(pageNum, canvas) {\r\n    if (!pdfDoc.value || pageNum < 1 || pageNum > totalPages.value) return null\r\n\r\n    pageRendering.value = true\r\n    try {\r\n      const page = await pdfDoc.value.getPage(pageNum)\r\n      const viewport = page.getViewport({ scale: scale.value })\r\n\r\n      canvas.width = viewport.width\r\n      canvas.height = viewport.height\r\n\r\n      const ctx = canvas.getContext('2d')\r\n      const renderContext = {\r\n        canvasContext: ctx,\r\n        viewport,\r\n      }\r\n\r\n      await page.render(renderContext).promise\r\n\r\n      return {\r\n        width: viewport.width,\r\n        height: viewport.height,\r\n        originalWidth: viewport.viewBox[2],\r\n        originalHeight: viewport.viewBox[3],\r\n      }\r\n    } catch (e) {\r\n      console.error(`Error rendering page ${pageNum}:`, e)\r\n      return null\r\n    } finally {\r\n      pageRendering.value = false\r\n    }\r\n  }\r\n\r\n  async function renderThumbnail(pageNum, canvas, thumbScale = 0.2) {\r\n    if (!pdfDoc.value || pageNum < 1 || pageNum > totalPages.value) return\r\n\r\n    try {\r\n      const page = await pdfDoc.value.getPage(pageNum)\r\n      const viewport = page.getViewport({ scale: thumbScale })\r\n\r\n      canvas.width = viewport.width\r\n      canvas.height = viewport.height\r\n\r\n      const ctx = canvas.getContext('2d')\r\n      await page.render({ canvasContext: ctx, viewport }).promise\r\n    } catch (e) {\r\n      console.error(`Error rendering thumbnail ${pageNum}:`, e)\r\n    }\r\n  }\r\n\r\n  async function getPageText(pageNum) {\r\n    if (!pdfDoc.value) return ''\r\n    const page = await pdfDoc.value.getPage(pageNum)\r\n    const textContent = await page.getTextContent()\r\n    return textContent.items.map(item => item.str).join(' ')\r\n  }\r\n\r\n  function zoomIn() {\r\n    scale.value = Math.min(scale.value + 0.25, 5.0)\r\n  }\r\n\r\n  function zoomOut() {\r\n    scale.value = Math.max(scale.value - 0.25, 0.25)\r\n  }\r\n\r\n  function zoomFit() {\r\n    scale.value = 1.0\r\n  }\r\n\r\n  function setZoom(newScale) {\r\n    scale.value = Math.max(0.25, Math.min(5.0, newScale))\r\n  }\r\n\r\n  function goToPage(pageNum) {\r\n    currentPage.value = Math.max(1, Math.min(pageNum, totalPages.value))\r\n  }\r\n\r\n  function nextPage() {\r\n    goToPage(currentPage.value + 1)\r\n  }\r\n\r\n  function prevPage() {\r\n    goToPage(currentPage.value - 1)\r\n  }\r\n\r\n  function destroy() {\r\n    if (pdfDoc.value) {\r\n      pdfDoc.value.destroy()\r\n      pdfDoc.value = null\r\n    }\r\n  }\r\n\r\n  onUnmounted(destroy)\r\n\r\n  return {\r\n    pdfDoc,\r\n    totalPages,\r\n    currentPage,\r\n    scale,\r\n    zoomPercent,\r\n    loading,\r\n    error,\r\n    pageRendering,\r\n    fileName,\r\n    loadPdf,\r\n    renderPage,\r\n    renderThumbnail,\r\n    getPageText,\r\n    zoomIn,\r\n    zoomOut,\r\n    zoomFit,\r\n    setZoom,\r\n    goToPage,\r\n    nextPage,\r\n    prevPage,\r\n    destroy,\r\n  }\r\n}\r\n","/**\r\n * Composable for managing Fabric.js overlay canvases on PDF pages.\r\n * Each page gets its own Fabric canvas for annotations.\r\n */\r\nimport { ref, shallowRef, onUnmounted } from 'vue'\r\nimport { Canvas, Rect, Textbox, Circle, Line, FabricImage } from 'fabric'\r\n\r\nexport function useFabricCanvas() {\r\n  const canvases = shallowRef(new Map()) // pageNum -> fabric.Canvas\r\n  const activeObject = ref(null)\r\n  const activeTool = ref('select')\r\n  const toolOptions = ref({\r\n    color: '#000000',\r\n    fontSize: 16,\r\n    strokeWidth: 2,\r\n    opacity: 1,\r\n    highlightColor: '#ffff00',\r\n  })\r\n\r\n  // Callback when an annotation is added (for undo/redo)\r\n  let onAnnotationAdded = null\r\n\r\n  function setOnAnnotationAdded(cb) {\r\n    onAnnotationAdded = cb\r\n  }\r\n\r\n  /**\r\n   * Initialize a Fabric canvas overlay for a specific page.\r\n   */\r\n  function initCanvas(pageNum, canvasEl, width, height) {\r\n    destroyCanvas(pageNum)\r\n\r\n    try {\r\n      const fabricCanvas = new Canvas(canvasEl, {\r\n        width,\r\n        height,\r\n        selection: activeTool.value === 'select',\r\n        isDrawingMode: false,\r\n      })\r\n\r\n    // Selection events\r\n    fabricCanvas.on('selection:created', (e) => {\r\n      activeObject.value = e.selected?.[0] || null\r\n    })\r\n    fabricCanvas.on('selection:updated', (e) => {\r\n      activeObject.value = e.selected?.[0] || null\r\n    })\r\n    fabricCanvas.on('selection:cleared', () => {\r\n      activeObject.value = null\r\n    })\r\n\r\n    // Click-to-add handler — creates annotation based on active tool\r\n    fabricCanvas.on('mouse:down', (opt) => {\r\n      if (activeTool.value === 'select') return\r\n\r\n      // Eraser: delete clicked object\r\n      if (activeTool.value === 'eraser' && opt.target) {\r\n        fabricCanvas.remove(opt.target)\r\n        fabricCanvas.renderAll()\r\n        activeObject.value = null\r\n        return\r\n      }\r\n\r\n      if (opt.target) return // clicked existing object, let fabric handle it\r\n\r\n      const pointer = fabricCanvas.getScenePoint\r\n        ? fabricCanvas.getScenePoint(opt.e)\r\n        : fabricCanvas.getPointer(opt.e)\r\n      handleToolClick(pageNum, fabricCanvas, pointer)\r\n    })\r\n\r\n    const newMap = new Map(canvases.value)\r\n    newMap.set(pageNum, fabricCanvas)\r\n    canvases.value = newMap\r\n\r\n    return fabricCanvas\r\n    } catch (e) {\r\n      console.error(`[FabricCanvas] FAILED page ${pageNum}:`, e)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle a click on the canvas based on the active tool.\r\n   */\r\n  function handleToolClick(pageNum, canvas, pointer) {\r\n    const x = pointer.x\r\n    const y = pointer.y\r\n    let obj = null\r\n\r\n    switch (activeTool.value) {\r\n      case 'text':\r\n        obj = new Textbox('Type here...', {\r\n          left: x,\r\n          top: y,\r\n          width: 200,\r\n          fontSize: toolOptions.value.fontSize || 16,\r\n          fill: toolOptions.value.color || '#000000',\r\n          fontFamily: 'Helvetica',\r\n          editable: true,\r\n          _annotationType: 'text',\r\n          _pageNum: pageNum,\r\n        })\r\n        canvas.add(obj)\r\n        canvas.setActiveObject(obj)\r\n        obj.enterEditing()\r\n        obj.selectAll()\r\n        break\r\n\r\n      case 'highlight':\r\n        obj = new Rect({\r\n          left: x,\r\n          top: y,\r\n          width: 200,\r\n          height: 22,\r\n          fill: toolOptions.value.highlightColor || '#ffff00',\r\n          opacity: 0.35,\r\n          selectable: true,\r\n          _annotationType: 'highlight',\r\n          _pageNum: pageNum,\r\n        })\r\n        canvas.add(obj)\r\n        canvas.setActiveObject(obj)\r\n        break\r\n\r\n      case 'whiteout':\r\n        obj = new Rect({\r\n          left: x,\r\n          top: y,\r\n          width: 200,\r\n          height: 28,\r\n          fill: '#ffffff',\r\n          opacity: 1,\r\n          selectable: true,\r\n          stroke: '#e0e0e0',\r\n          strokeWidth: 0.5,\r\n          _annotationType: 'whiteout',\r\n          _pageNum: pageNum,\r\n        })\r\n        canvas.add(obj)\r\n        canvas.setActiveObject(obj)\r\n        break\r\n\r\n      case 'shape':\r\n        obj = new Rect({\r\n          left: x,\r\n          top: y,\r\n          width: 150,\r\n          height: 100,\r\n          fill: 'transparent',\r\n          stroke: toolOptions.value.color || '#000000',\r\n          strokeWidth: toolOptions.value.strokeWidth || 2,\r\n          selectable: true,\r\n          _annotationType: 'rectangle',\r\n          _pageNum: pageNum,\r\n        })\r\n        canvas.add(obj)\r\n        canvas.setActiveObject(obj)\r\n        break\r\n\r\n      case 'note':\r\n        // Sticky note = yellow rect + text\r\n        const noteRect = new Rect({\r\n          left: x,\r\n          top: y,\r\n          width: 160,\r\n          height: 100,\r\n          fill: '#FFF9C4',\r\n          stroke: '#F9A825',\r\n          strokeWidth: 1,\r\n          rx: 4,\r\n          ry: 4,\r\n          shadow: { color: 'rgba(0,0,0,0.15)', blur: 6, offsetX: 2, offsetY: 2 },\r\n          selectable: true,\r\n          _annotationType: 'note-bg',\r\n          _pageNum: pageNum,\r\n        })\r\n        const noteText = new Textbox('Note...', {\r\n          left: x + 8,\r\n          top: y + 8,\r\n          width: 144,\r\n          fontSize: 12,\r\n          fill: '#333333',\r\n          fontFamily: 'Helvetica',\r\n          editable: true,\r\n          _annotationType: 'note-text',\r\n          _pageNum: pageNum,\r\n        })\r\n        canvas.add(noteRect)\r\n        canvas.add(noteText)\r\n        canvas.setActiveObject(noteText)\r\n        noteText.enterEditing()\r\n        obj = noteText\r\n        break\r\n\r\n      case 'signature':\r\n        // Placeholder signature — user can also upload\r\n        obj = new Textbox('Signature', {\r\n          left: x,\r\n          top: y,\r\n          width: 180,\r\n          fontSize: 28,\r\n          fill: '#1a237e',\r\n          fontFamily: 'cursive',\r\n          fontStyle: 'italic',\r\n          editable: true,\r\n          _annotationType: 'signature',\r\n          _pageNum: pageNum,\r\n        })\r\n        canvas.add(obj)\r\n        canvas.setActiveObject(obj)\r\n        obj.enterEditing()\r\n        obj.selectAll()\r\n        break\r\n\r\n      case 'image':\r\n        // Open file picker for image\r\n        pickImage().then((dataUrl) => {\r\n          if (dataUrl) {\r\n            addImageToCanvas(pageNum, canvas, dataUrl, x, y)\r\n          }\r\n        })\r\n        return\r\n\r\n      case 'draw':\r\n        // Drawing mode is handled separately\r\n        canvas.isDrawingMode = true\r\n        if (canvas.freeDrawingBrush) {\r\n          canvas.freeDrawingBrush.color = toolOptions.value.color || '#000000'\r\n          canvas.freeDrawingBrush.width = toolOptions.value.strokeWidth || 3\r\n        }\r\n        return\r\n\r\n      case 'eraser':\r\n        // In eraser mode, if they clicked an object we'd delete it\r\n        // but we returned early if opt.target existed. So we do nothing on empty space.\r\n        return\r\n    }\r\n\r\n    if (obj) {\r\n      canvas.renderAll()\r\n      if (onAnnotationAdded) {\r\n        onAnnotationAdded(pageNum, obj)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open a file picker to select an image.\r\n   */\r\n  function pickImage() {\r\n    return new Promise((resolve) => {\r\n      const input = document.createElement('input')\r\n      input.type = 'file'\r\n      input.accept = 'image/*'\r\n      input.onchange = (e) => {\r\n        const file = e.target.files[0]\r\n        if (!file) { resolve(null); return }\r\n        const reader = new FileReader()\r\n        reader.onload = (ev) => resolve(ev.target.result)\r\n        reader.readAsDataURL(file)\r\n      }\r\n      input.click()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Add an image to a canvas from a data URL.\r\n   */\r\n  async function addImageToCanvas(pageNum, canvas, dataUrl, x, y) {\r\n    try {\r\n      const img = await FabricImage.fromURL(dataUrl)\r\n      // Scale down if too large\r\n      const maxDim = 300\r\n      const scale = Math.min(maxDim / img.width, maxDim / img.height, 1)\r\n      img.set({\r\n        left: x,\r\n        top: y,\r\n        scaleX: scale,\r\n        scaleY: scale,\r\n        _annotationType: 'image',\r\n        _pageNum: pageNum,\r\n      })\r\n      canvas.add(img)\r\n      canvas.setActiveObject(img)\r\n      canvas.renderAll()\r\n      if (onAnnotationAdded) {\r\n        onAnnotationAdded(pageNum, img)\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to add image:', e)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the active tool and update all canvases.\r\n   */\r\n  function setTool(tool) {\r\n    activeTool.value = tool\r\n\r\n    for (const canvas of canvases.value.values()) {\r\n      // Exit drawing mode unless tool is draw\r\n      canvas.isDrawingMode = tool === 'draw'\r\n      if (tool === 'draw' && canvas.freeDrawingBrush) {\r\n        canvas.freeDrawingBrush.color = toolOptions.value.color || '#000000'\r\n        canvas.freeDrawingBrush.width = toolOptions.value.strokeWidth || 3\r\n      }\r\n\r\n      canvas.selection = tool === 'select'\r\n\r\n      // Cursor\r\n      if (tool === 'text' || tool === 'note' || tool === 'signature') {\r\n        canvas.defaultCursor = 'text'\r\n        canvas.hoverCursor = 'text'\r\n      } else if (tool === 'draw') {\r\n        canvas.defaultCursor = 'crosshair'\r\n        canvas.hoverCursor = 'crosshair'\r\n      } else if (tool === 'eraser') {\r\n        canvas.defaultCursor = 'not-allowed'\r\n        canvas.hoverCursor = 'pointer'\r\n      } else if (tool === 'select') {\r\n        canvas.defaultCursor = 'default'\r\n        canvas.hoverCursor = 'move'\r\n      } else {\r\n        canvas.defaultCursor = 'crosshair'\r\n        canvas.hoverCursor = 'crosshair'\r\n      }\r\n    }\r\n  }\r\n\r\n  function updateToolOptions(opts) {\r\n    toolOptions.value = { ...toolOptions.value, ...opts }\r\n  }\r\n\r\n  /**\r\n   * Delete the currently selected object on a page.\r\n   */\r\n  function deleteSelected(pageNum) {\r\n    const canvas = canvases.value.get(pageNum)\r\n    if (!canvas) {\r\n      // Try all canvases\r\n      for (const c of canvases.value.values()) {\r\n        const active = c.getActiveObject()\r\n        if (active) {\r\n          c.remove(active)\r\n          c.renderAll()\r\n          activeObject.value = null\r\n          return\r\n        }\r\n      }\r\n      return\r\n    }\r\n    const active = canvas.getActiveObject()\r\n    if (active) {\r\n      canvas.remove(active)\r\n      canvas.renderAll()\r\n      activeObject.value = null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all annotations from all pages in a serializable format.\r\n   */\r\n  function getAllAnnotations() {\r\n    const annotations = {}\r\n    for (const [pageNum, canvas] of canvases.value.entries()) {\r\n      const objects = canvas.toJSON(['_annotationType', '_pageNum']).objects\r\n      if (objects.length > 0) {\r\n        annotations[pageNum] = objects\r\n      }\r\n    }\r\n    return annotations\r\n  }\r\n\r\n  /**\r\n   * Load annotations from a serialized format.\r\n   */\r\n  async function loadAnnotations(annotations) {\r\n    for (const [pageNum, objects] of Object.entries(annotations)) {\r\n      const canvas = canvases.value.get(parseInt(pageNum))\r\n      if (canvas && objects.length > 0) {\r\n        await canvas.loadFromJSON({ objects, version: '6.0.0' })\r\n        canvas.renderAll()\r\n      }\r\n    }\r\n  }\r\n\r\n  function destroyCanvas(pageNum) {\r\n    const canvas = canvases.value.get(pageNum)\r\n    if (canvas) {\r\n      canvas.dispose()\r\n      const newMap = new Map(canvases.value)\r\n      newMap.delete(pageNum)\r\n      canvases.value = newMap\r\n    }\r\n  }\r\n\r\n  function destroyAll() {\r\n    for (const canvas of canvases.value.values()) {\r\n      canvas.dispose()\r\n    }\r\n    canvases.value = new Map()\r\n  }\r\n\r\n  onUnmounted(destroyAll)\r\n\r\n  return {\r\n    canvases,\r\n    activeObject,\r\n    activeTool,\r\n    toolOptions,\r\n    initCanvas,\r\n    setTool,\r\n    updateToolOptions,\r\n    deleteSelected,\r\n    getAllAnnotations,\r\n    loadAnnotations,\r\n    setOnAnnotationAdded,\r\n    destroyCanvas,\r\n    destroyAll,\r\n  }\r\n}\r\n","/**\r\n * Composable for modifying PDFs client-side using pdf-lib.\r\n * Handles annotation embedding, page operations, and export.\r\n */\r\nimport { ref } from 'vue'\r\nimport { PDFDocument, rgb, StandardFonts, degrees } from 'pdf-lib'\r\n\r\nexport function usePdfModifier() {\r\n  const exporting = ref(false)\r\n  const exportError = ref('')\r\n\r\n  /**\r\n   * Load a PDF from bytes or URL for modification.\r\n   */\r\n  async function loadForEdit(source) {\r\n    if (source instanceof ArrayBuffer || source instanceof Uint8Array) {\r\n      return await PDFDocument.load(source)\r\n    }\r\n    if (source instanceof File) {\r\n      const bytes = await source.arrayBuffer()\r\n      return await PDFDocument.load(bytes)\r\n    }\r\n    if (typeof source === 'string') {\r\n      const res = await fetch(source, { credentials: 'include' })\r\n      const bytes = await res.arrayBuffer()\r\n      return await PDFDocument.load(bytes)\r\n    }\r\n    throw new Error('Invalid source for PDF editing')\r\n  }\r\n\r\n  /**\r\n   * Embed Fabric.js annotations into a PDF document.\r\n   * Each annotation has: { page, type, x, y, width?, height?, text?, color?, fontSize?, imageData? }\r\n   */\r\n  async function embedAnnotations(pdfDoc, annotations) {\r\n    const font = await pdfDoc.embedFont(StandardFonts.Helvetica)\r\n\r\n    for (const annot of annotations) {\r\n      const pageIndex = (annot.page || 1) - 1\r\n      if (pageIndex >= pdfDoc.getPageCount()) continue\r\n\r\n      const page = pdfDoc.getPage(pageIndex)\r\n      const { height: pageHeight } = page.getSize()\r\n\r\n      switch (annot.type) {\r\n        case 'text':\r\n          page.drawText(annot.text || '', {\r\n            x: annot.x || 0,\r\n            y: pageHeight - (annot.y || 0) - (annot.fontSize || 14),\r\n            size: annot.fontSize || 14,\r\n            font,\r\n            color: parseColor(annot.color || '#000000'),\r\n            opacity: annot.opacity ?? 1,\r\n          })\r\n          break\r\n\r\n        case 'rectangle':\r\n        case 'whiteout':\r\n          page.drawRectangle({\r\n            x: annot.x || 0,\r\n            y: pageHeight - (annot.y || 0) - (annot.height || 20),\r\n            width: annot.width || 100,\r\n            height: annot.height || 20,\r\n            color: parseColor(annot.color || (annot.type === 'whiteout' ? '#ffffff' : '#000000')),\r\n            opacity: annot.opacity ?? 1,\r\n            borderWidth: annot.borderWidth || 0,\r\n          })\r\n          break\r\n\r\n        case 'highlight':\r\n          page.drawRectangle({\r\n            x: annot.x || 0,\r\n            y: pageHeight - (annot.y || 0) - (annot.height || 14),\r\n            width: annot.width || 100,\r\n            height: annot.height || 14,\r\n            color: parseColor(annot.color || '#ffff00'),\r\n            opacity: annot.opacity ?? 0.3,\r\n          })\r\n          break\r\n\r\n        case 'image':\r\n          if (annot.imageData) {\r\n            try {\r\n              let image\r\n              if (annot.imageData.startsWith('data:image/png')) {\r\n                const base64 = annot.imageData.split(',')[1]\r\n                image = await pdfDoc.embedPng(Uint8Array.from(atob(base64), c => c.charCodeAt(0)))\r\n              } else {\r\n                const base64 = annot.imageData.split(',')[1]\r\n                image = await pdfDoc.embedJpg(Uint8Array.from(atob(base64), c => c.charCodeAt(0)))\r\n              }\r\n              page.drawImage(image, {\r\n                x: annot.x || 0,\r\n                y: pageHeight - (annot.y || 0) - (annot.height || 100),\r\n                width: annot.width || 100,\r\n                height: annot.height || 100,\r\n                opacity: annot.opacity ?? 1,\r\n              })\r\n            } catch (e) {\r\n              console.error('Failed to embed image annotation:', e)\r\n            }\r\n          }\r\n          break\r\n\r\n        case 'line':\r\n          page.drawLine({\r\n            start: { x: annot.x || 0, y: pageHeight - (annot.y || 0) },\r\n            end: { x: annot.x2 || 100, y: pageHeight - (annot.y2 || 0) },\r\n            thickness: annot.strokeWidth || 2,\r\n            color: parseColor(annot.color || '#000000'),\r\n            opacity: annot.opacity ?? 1,\r\n          })\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply page modifications (reorder, delete, rotate).\r\n   */\r\n  async function applyPageModifications(pdfDoc, modifications) {\r\n    for (const mod of modifications) {\r\n      switch (mod.type) {\r\n        case 'rotate':\r\n          if (mod.pageIndex < pdfDoc.getPageCount()) {\r\n            const page = pdfDoc.getPage(mod.pageIndex)\r\n            page.setRotation(page.getRotation().angle + (mod.angle || 90))\r\n          }\r\n          break\r\n        case 'delete':\r\n          if (mod.pageIndex < pdfDoc.getPageCount()) {\r\n            pdfDoc.removePage(mod.pageIndex)\r\n          }\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export the modified PDF as a Uint8Array.\r\n   */\r\n  async function exportPdf(pdfDoc) {\r\n    exporting.value = true\r\n    exportError.value = ''\r\n    try {\r\n      return await pdfDoc.save()\r\n    } catch (e) {\r\n      exportError.value = e.message\r\n      return null\r\n    } finally {\r\n      exporting.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export as a downloadable Blob.\r\n   */\r\n  async function exportAsBlob(pdfDoc) {\r\n    const bytes = await exportPdf(pdfDoc)\r\n    if (!bytes) return null\r\n    return new Blob([bytes], { type: 'application/pdf' })\r\n  }\r\n\r\n  /**\r\n   * Trigger a download of the modified PDF.\r\n   */\r\n  async function downloadPdf(pdfDoc, filename = 'edited.pdf') {\r\n    const blob = await exportAsBlob(pdfDoc)\r\n    if (!blob) return\r\n\r\n    const url = URL.createObjectURL(blob)\r\n    const a = document.createElement('a')\r\n    a.href = url\r\n    a.download = filename\r\n    a.click()\r\n    URL.revokeObjectURL(url)\r\n  }\r\n\r\n  return {\r\n    exporting,\r\n    exportError,\r\n    loadForEdit,\r\n    embedAnnotations,\r\n    applyPageModifications,\r\n    exportPdf,\r\n    exportAsBlob,\r\n    downloadPdf,\r\n  }\r\n}\r\n\r\n/** Parse a hex color string into pdf-lib rgb(). */\r\nfunction parseColor(hex) {\r\n  hex = hex.replace('#', '')\r\n  const r = parseInt(hex.substring(0, 2), 16) / 255\r\n  const g = parseInt(hex.substring(2, 4), 16) / 255\r\n  const b = parseInt(hex.substring(4, 6), 16) / 255\r\n  return rgb(r, g, b)\r\n}\r\n","/**\r\n * Composable for managing annotation state across pages.\r\n */\r\nimport { ref, computed } from 'vue'\r\n\r\nexport function useAnnotations() {\r\n  const annotations = ref({}) // { pageNum: [annotationObjects] }\r\n  const selectedAnnotation = ref(null)\r\n\r\n  const annotationCount = computed(() => {\r\n    return Object.values(annotations.value).reduce((sum, page) => sum + page.length, 0)\r\n  })\r\n\r\n  const annotationList = computed(() => {\r\n    const list = []\r\n    for (const [page, annots] of Object.entries(annotations.value)) {\r\n      for (const annot of annots) {\r\n        list.push({ ...annot, page: parseInt(page) })\r\n      }\r\n    }\r\n    return list.sort((a, b) => a.page - b.page)\r\n  })\r\n\r\n  function addAnnotation(pageNum, annotation) {\r\n    if (!annotations.value[pageNum]) {\r\n      annotations.value[pageNum] = []\r\n    }\r\n    annotation.id = annotation.id || generateId()\r\n    annotations.value[pageNum].push(annotation)\r\n    return annotation\r\n  }\r\n\r\n  function removeAnnotation(pageNum, annotationId) {\r\n    if (!annotations.value[pageNum]) return\r\n    annotations.value[pageNum] = annotations.value[pageNum].filter(a => a.id !== annotationId)\r\n    if (annotations.value[pageNum].length === 0) {\r\n      delete annotations.value[pageNum]\r\n    }\r\n  }\r\n\r\n  function updateAnnotation(pageNum, annotationId, updates) {\r\n    if (!annotations.value[pageNum]) return\r\n    const idx = annotations.value[pageNum].findIndex(a => a.id === annotationId)\r\n    if (idx >= 0) {\r\n      annotations.value[pageNum][idx] = { ...annotations.value[pageNum][idx], ...updates }\r\n    }\r\n  }\r\n\r\n  function clearPage(pageNum) {\r\n    delete annotations.value[pageNum]\r\n  }\r\n\r\n  function clearAll() {\r\n    annotations.value = {}\r\n    selectedAnnotation.value = null\r\n  }\r\n\r\n  function selectAnnotation(annotation) {\r\n    selectedAnnotation.value = annotation\r\n  }\r\n\r\n  function generateId() {\r\n    return `annot_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`\r\n  }\r\n\r\n  return {\r\n    annotations,\r\n    selectedAnnotation,\r\n    annotationCount,\r\n    annotationList,\r\n    addAnnotation,\r\n    removeAnnotation,\r\n    updateAnnotation,\r\n    clearPage,\r\n    clearAll,\r\n    selectAnnotation,\r\n  }\r\n}\r\n","/**\r\n * Adobe-style PDF text editing using viewport transform math for pixel-perfect positioning.\r\n *\r\n * Uses textContent.items transform matrices + viewport.convertToViewportPoint()\r\n * to compute exact canvas pixel positions. No TextLayer DOM needed.\r\n *\r\n * 1. Read text items from page.getTextContent()\r\n * 2. Convert PDF coordinates to canvas pixels via viewport transform\r\n * 3. Sample text colors from the rendered canvas\r\n * 4. White-out original text on the PDF canvas\r\n * 5. Place Fabric.js Textbox objects at exact pixel positions\r\n * 6. On export: white-out + redraw via pdf-lib\r\n */\r\nimport { ref, shallowRef } from 'vue'\r\nimport { Textbox } from 'fabric'\r\n\r\nexport function usePdfTextEditor() {\r\n  const isEditingText = ref(false)\r\n  const editedPages = shallowRef(new Map())\r\n  const activeEditPage = ref(null)\r\n\r\n  /**\r\n   * Extract text with pixel-perfect positions using viewport transform math.\r\n   * Each textContent item has transform [scaleX, shearY, shearX, scaleY, tx, ty]\r\n   * in PDF coordinate space. We use viewport.convertToViewportPoint() to convert\r\n   * to canvas pixel coordinates, completely bypassing the TextLayer DOM and\r\n   * avoiding all DPR scaling issues.\r\n   */\r\n  async function extractTextWithPositions(pdfDoc, pageNum, scale) {\r\n    const page = await pdfDoc.getPage(pageNum)\r\n    const viewport = page.getViewport({ scale })\r\n    const textContent = await page.getTextContent()\r\n\r\n    const items = []\r\n\r\n    for (const item of textContent.items) {\r\n      if (!item.str || !item.str.trim()) continue\r\n\r\n      // item.transform = [scaleX, shearY, shearX, scaleY, translateX, translateY]\r\n      // translateX, translateY are the baseline-left position in PDF coords\r\n      const tx = item.transform[4]\r\n      const ty = item.transform[5]\r\n\r\n      // PDF font size is the scaleY component of the transform\r\n      const pdfFontSize = Math.abs(item.transform[3])\r\n\r\n      // Convert PDF origin (baseline-left) to viewport (canvas) coordinates\r\n      // viewport.convertToViewportPoint applies the full transform matrix\r\n      const [vx, vy] = viewport.convertToViewportPoint(tx, ty)\r\n\r\n      // The width/height from textContent are in PDF units — scale them\r\n      const width = item.width * scale\r\n      const height = item.height * scale\r\n      const fontSize = pdfFontSize * scale\r\n\r\n      // vy is the baseline Y. The top of the text is approximately baseline - ascent.\r\n      // For most fonts, ascent is ~80% of fontSize. We use height as a better proxy.\r\n      const topY = vy - height\r\n\r\n      items.push({\r\n        str: item.str,\r\n        x: vx,\r\n        y: topY,\r\n        width,\r\n        height,\r\n        fontSize,\r\n        fontFamily: item.fontName || 'sans-serif',\r\n        fontWeight: 'normal',\r\n        fontStyle: 'normal',\r\n        // Original PDF coordinate space (for backend content stream removal)\r\n        pdfX: tx,\r\n        pdfY: ty,\r\n        pdfFontSize,\r\n      })\r\n    }\r\n\r\n    return items\r\n  }\r\n\r\n  /**\r\n   * Group text items into blocks respecting column boundaries.\r\n   * Same Y (within threshold) AND close X gap = same block.\r\n   * Large X gap = different column = different block.\r\n   */\r\n  function groupIntoBlocks(items) {\r\n    if (items.length === 0) return []\r\n\r\n    // Sort top-to-bottom, then left-to-right\r\n    const sorted = [...items].sort((a, b) => {\r\n      const dy = a.y - b.y\r\n      if (Math.abs(dy) < 5) return a.x - b.x\r\n      return dy\r\n    })\r\n\r\n    const blocks = []\r\n    let currentBlock = [sorted[0]]\r\n\r\n    for (let i = 1; i < sorted.length; i++) {\r\n      const item = sorted[i]\r\n      const last = currentBlock[currentBlock.length - 1]\r\n\r\n      const sameLine = Math.abs(item.y - last.y) < 5\r\n\r\n      if (sameLine) {\r\n        // Check horizontal gap\r\n        const gap = item.x - (last.x + last.width)\r\n        const avgFontSize = (item.fontSize + last.fontSize) / 2\r\n\r\n        if (gap <= avgFontSize * 1.2 && gap >= -2) {\r\n          currentBlock.push(item)\r\n        } else {\r\n          blocks.push(currentBlock)\r\n          currentBlock = [item]\r\n        }\r\n      } else {\r\n        blocks.push(currentBlock)\r\n        currentBlock = [item]\r\n      }\r\n    }\r\n    blocks.push(currentBlock)\r\n\r\n    return blocks.map(block => {\r\n      const sortedBlock = block.sort((a, b) => a.x - b.x)\r\n      const text = sortedBlock.map(i => i.str).join(' ')\r\n      const first = sortedBlock[0]\r\n      const last = sortedBlock[sortedBlock.length - 1]\r\n      const maxFontSize = Math.max(...sortedBlock.map(i => i.fontSize))\r\n      const minY = Math.min(...sortedBlock.map(i => i.y))\r\n      const maxHeight = Math.max(...sortedBlock.map(i => i.height))\r\n\r\n      return {\r\n        text,\r\n        x: first.x,\r\n        y: minY,\r\n        width: (last.x + last.width) - first.x,\r\n        height: maxHeight,\r\n        fontSize: maxFontSize,\r\n        fontFamily: first.fontFamily,\r\n        fontWeight: first.fontWeight,\r\n        fontStyle: first.fontStyle,\r\n        items: sortedBlock,\r\n        // PDF coordinate space for backend\r\n        pdfX: first.pdfX,\r\n        pdfY: first.pdfY,\r\n        pdfFontSize: Math.max(...sortedBlock.map(i => i.pdfFontSize)),\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Sample text color from the PDF canvas at a block's position.\r\n   */\r\n  function sampleColor(ctx, x, y, width, height) {\r\n    try {\r\n      const sx = Math.max(0, Math.floor(x + 2))\r\n      const sy = Math.max(0, Math.floor(y + height * 0.5))\r\n      const sw = Math.max(Math.min(Math.floor(width * 0.3), 20), 1)\r\n\r\n      const data = ctx.getImageData(sx, sy, sw, 1).data\r\n      let dR = 255, dG = 255, dB = 255, dL = 999\r\n\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const lum = 0.299 * data[i] + 0.587 * data[i+1] + 0.114 * data[i+2]\r\n        if (lum < dL) { dL = lum; dR = data[i]; dG = data[i+1]; dB = data[i+2]; }\r\n      }\r\n\r\n      if (dL > 200) return '#000000'\r\n      return '#' + [dR, dG, dB].map(c => c.toString(16).padStart(2, '0')).join('')\r\n    } catch { return '#000000' }\r\n  }\r\n\r\n  /**\r\n   * White-out blocks on the PDF canvas.\r\n   */\r\n  function whiteOut(ctx, blocks, pad = 2) {\r\n    ctx.fillStyle = '#ffffff'\r\n    for (const b of blocks) {\r\n      ctx.fillRect(\r\n        Math.floor(b.x) - pad,\r\n        Math.floor(b.y) - pad,\r\n        Math.ceil(b.width) + pad * 2 + 2,\r\n        Math.ceil(b.height) + pad * 2 + 2\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enter text edit mode for a page.\r\n   */\r\n  async function enterTextEditMode(pdfDoc, pageNum, fabricCanvas, pdfCanvasEl, scale) {\r\n    if (!pdfDoc || !fabricCanvas || !pdfCanvasEl) return 0\r\n\r\n    // Prevent re-entry if already editing this page\r\n    if (isEditingText.value && activeEditPage.value === pageNum) return 0\r\n\r\n    isEditingText.value = true\r\n    activeEditPage.value = pageNum\r\n\r\n    // 1. Extract text with pixel-perfect positions via viewport transform\r\n    const items = await extractTextWithPositions(pdfDoc, pageNum, scale)\r\n    if (items.length === 0) return 0\r\n\r\n    // 2. Group into blocks (respects columns)\r\n    const blocks = groupIntoBlocks(items)\r\n\r\n    // 3. Sample colors before white-out\r\n    const ctx = pdfCanvasEl.getContext('2d')\r\n    const colors = blocks.map(b => sampleColor(ctx, b.x, b.y, b.width, b.height))\r\n\r\n    // 4. White-out original text on PDF canvas\r\n    whiteOut(ctx, blocks)\r\n\r\n    // 5. Create invisible Fabric text objects at exact positions\r\n    const pageEdits = []\r\n\r\n    for (let i = 0; i < blocks.length; i++) {\r\n      const block = blocks[i]\r\n      const color = colors[i]\r\n\r\n      const textObj = new Textbox(block.text, {\r\n        left: block.x,\r\n        top: block.y,\r\n        width: Math.max(block.width + 6, 30),\r\n        fontSize: block.fontSize,\r\n        fontFamily: block.fontFamily || 'Helvetica, Arial, sans-serif',\r\n        fontWeight: block.fontWeight || 'normal',\r\n        fontStyle: block.fontStyle || 'normal',\r\n        fill: color,\r\n        editable: true,\r\n        // Invisible — looks like native PDF text\r\n        backgroundColor: 'transparent',\r\n        borderColor: 'transparent',\r\n        cornerColor: '#4A90D9',\r\n        cornerSize: 5,\r\n        transparentCorners: false,\r\n        padding: 1,\r\n        splitByGrapheme: false,\r\n        hasBorders: false,\r\n        hasControls: false,\r\n        lockMovementX: true,\r\n        lockMovementY: true,\r\n        _annotationType: 'text-edit',\r\n        _pageNum: pageNum,\r\n        _originalText: block.text,\r\n        _originalColor: color,\r\n        _originalBounds: { x: block.x, y: block.y, width: block.width, height: block.height },\r\n      })\r\n\r\n      // Hover: subtle dashed border\r\n      textObj.on('mouseover', () => {\r\n        if (fabricCanvas.getActiveObject() !== textObj) {\r\n          textObj.set({ hasBorders: true, borderColor: 'rgba(74, 144, 217, 0.4)', borderDashArray: [4, 3] })\r\n          fabricCanvas.renderAll()\r\n        }\r\n      })\r\n      textObj.on('mouseout', () => {\r\n        if (fabricCanvas.getActiveObject() !== textObj) {\r\n          textObj.set({ hasBorders: false, borderColor: 'transparent', borderDashArray: null })\r\n          fabricCanvas.renderAll()\r\n        }\r\n      })\r\n\r\n      // Selected: unlock for editing\r\n      textObj.on('selected', () => {\r\n        textObj.set({\r\n          hasBorders: true, hasControls: true,\r\n          borderColor: '#4A90D9', borderDashArray: null,\r\n          lockMovementX: false, lockMovementY: false,\r\n        })\r\n        fabricCanvas.renderAll()\r\n      })\r\n      textObj.on('deselected', () => {\r\n        textObj.set({\r\n          hasBorders: false, hasControls: false,\r\n          borderColor: 'transparent',\r\n          lockMovementX: true, lockMovementY: true,\r\n        })\r\n        fabricCanvas.renderAll()\r\n      })\r\n\r\n      fabricCanvas.add(textObj)\r\n\r\n      const editEntry = {\r\n        original: block.text,\r\n        modified: block.text,\r\n        fabricObj: textObj,\r\n        color,\r\n        bounds: { x: block.x, y: block.y, width: block.width, height: block.height },\r\n        // PDF coordinate space — used by backend for content stream removal\r\n        pdfX: block.pdfX,\r\n        pdfY: block.pdfY,\r\n        pdfFontSize: block.pdfFontSize,\r\n        scale,\r\n      }\r\n      textObj.on('changed', () => { editEntry.modified = textObj.text })\r\n      pageEdits.push(editEntry)\r\n    }\r\n\r\n    const newMap = new Map(editedPages.value)\r\n    newMap.set(pageNum, pageEdits)\r\n    editedPages.value = newMap\r\n\r\n    fabricCanvas.renderAll()\r\n    return pageEdits.length\r\n  }\r\n\r\n  /**\r\n   * Exit text edit mode.\r\n   */\r\n  async function exitTextEditMode(pageNum, fabricCanvas, rerenderPageFn, pdfCanvasEl) {\r\n    isEditingText.value = false\r\n    activeEditPage.value = null\r\n    if (!fabricCanvas) return\r\n\r\n    const pageEdits = editedPages.value.get(pageNum)\r\n    if (!pageEdits) return\r\n\r\n    const toRemove = []\r\n    const toKeep = []\r\n\r\n    for (const edit of pageEdits) {\r\n      edit.modified = edit.fabricObj.text\r\n      if (edit.original === edit.modified) {\r\n        toRemove.push(edit.fabricObj)\r\n      } else {\r\n        toKeep.push(edit)\r\n      }\r\n    }\r\n\r\n    for (const obj of toRemove) fabricCanvas.remove(obj)\r\n\r\n    // Re-render PDF page to restore original text\r\n    if (rerenderPageFn) {\r\n      await rerenderPageFn()\r\n      await new Promise(r => setTimeout(r, 150))\r\n    }\r\n\r\n    // White-out behind modified text on the fresh render\r\n    if (toKeep.length > 0 && pdfCanvasEl) {\r\n      const ctx = pdfCanvasEl.getContext('2d')\r\n      whiteOut(ctx, toKeep.map(e => e.bounds), 3)\r\n    }\r\n\r\n    const newMap = new Map(editedPages.value)\r\n    if (toKeep.length > 0) {\r\n      newMap.set(pageNum, toKeep)\r\n    } else {\r\n      newMap.delete(pageNum)\r\n    }\r\n    editedPages.value = newMap\r\n    fabricCanvas.renderAll()\r\n  }\r\n\r\n  function getTextModifications() {\r\n    const mods = []\r\n    for (const [pageNum, edits] of editedPages.value.entries()) {\r\n      for (const edit of edits) {\r\n        const text = edit.fabricObj?.text || edit.modified\r\n        if (edit.original !== text) {\r\n          mods.push({\r\n            page: pageNum,\r\n            original: edit.original,\r\n            modified: text,\r\n            bounds: edit.bounds,\r\n            color: edit.color,\r\n            fontSize: edit.fabricObj?.fontSize || 12,\r\n            // PDF coordinate space for backend content stream removal\r\n            pdf_x: edit.pdfX,\r\n            pdf_y: edit.pdfY,\r\n            pdf_font_size: edit.pdfFontSize,\r\n            scale: edit.scale,\r\n          })\r\n        }\r\n      }\r\n    }\r\n    return mods\r\n  }\r\n\r\n  function hasTextModifications() {\r\n    for (const edits of editedPages.value.values()) {\r\n      for (const edit of edits) {\r\n        if (edit.original !== (edit.fabricObj?.text || edit.modified)) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  function clearAll() {\r\n    editedPages.value = new Map()\r\n    isEditingText.value = false\r\n    activeEditPage.value = null\r\n  }\r\n\r\n  return {\r\n    isEditingText, editedPages, activeEditPage,\r\n    enterTextEditMode, exitTextEditMode,\r\n    getTextModifications, hasTextModifications, clearAll,\r\n  }\r\n}\r\n","<template>\r\n  <button\r\n    @click=\"$emit('click')\"\r\n    class=\"p-2 rounded-md transition-colors\"\r\n    :class=\"active === tool ? 'bg-brand-100 text-brand-700' : 'text-gray-600 hover:bg-gray-100'\"\r\n    :title=\"label\"\r\n  >\r\n    <component :is=\"iconComponent\" class=\"w-4 h-4\" />\r\n  </button>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed } from 'vue'\r\nimport * as icons from 'lucide-vue-next'\r\n\r\nconst props = defineProps({\r\n  icon: { type: String, required: true },\r\n  label: { type: String, default: '' },\r\n  tool: { type: String, default: '' },\r\n  active: { type: String, default: '' },\r\n})\r\n\r\ndefineEmits(['click'])\r\n\r\nconst iconComponent = computed(() => icons[props.icon] || icons.Circle)\r\n</script>\r\n","<template>\r\n  <div class=\"bg-white border-b border-gray-200 px-4 py-2 flex items-center gap-1 overflow-x-auto\">\r\n    <!-- Annotation Tools -->\r\n    <div class=\"flex items-center gap-1 pr-3 border-r border-gray-200\">\r\n      <ToolButton icon=\"MousePointer2\" label=\"Select\" tool=\"select\" :active=\"activeTool\" @click=\"setTool('select')\" />\r\n      <ToolButton icon=\"TextCursorInput\" label=\"Edit Text\" tool=\"editText\" :active=\"activeTool\" @click=\"setTool('editText')\" />\r\n      <ToolButton icon=\"Type\" label=\"Add Text\" tool=\"text\" :active=\"activeTool\" @click=\"setTool('text')\" />\r\n      <ToolButton icon=\"Image\" label=\"Image\" tool=\"image\" :active=\"activeTool\" @click=\"setTool('image')\" />\r\n      <ToolButton icon=\"PenTool\" label=\"Sign\" tool=\"signature\" :active=\"activeTool\" @click=\"setTool('signature')\" />\r\n      <ToolButton icon=\"Highlighter\" label=\"Highlight\" tool=\"highlight\" :active=\"activeTool\" @click=\"setTool('highlight')\" />\r\n      <ToolButton icon=\"Pencil\" label=\"Draw\" tool=\"draw\" :active=\"activeTool\" @click=\"setTool('draw')\" />\r\n      <ToolButton icon=\"Square\" label=\"Shape\" tool=\"shape\" :active=\"activeTool\" @click=\"setTool('shape')\" />\r\n      <ToolButton icon=\"StickyNote\" label=\"Note\" tool=\"note\" :active=\"activeTool\" @click=\"setTool('note')\" />\r\n      <ToolButton icon=\"RectangleHorizontal\" label=\"White Out\" tool=\"whiteout\" :active=\"activeTool\" @click=\"setTool('whiteout')\" />\r\n      <ToolButton icon=\"Eraser\" label=\"Eraser\" tool=\"eraser\" :active=\"activeTool\" @click=\"setTool('eraser')\" />\r\n    </div>\r\n\r\n    <!-- Server-side Tools -->\r\n    <div class=\"flex items-center gap-1 pl-3\">\r\n      <button\r\n        v-for=\"tool in serverTools\"\r\n        :key=\"tool.id\"\r\n        @click=\"$emit('server-tool', tool.id)\"\r\n        class=\"flex items-center gap-1 px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded-md transition-colors\"\r\n        :title=\"tool.label\"\r\n      >\r\n        <component :is=\"tool.icon\" class=\"w-4 h-4\" />\r\n        <span class=\"hidden lg:inline\">{{ tool.label }}</span>\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed } from 'vue'\r\nimport {\r\n  MousePointer2, Type, TextCursorInput, Image, PenTool, Highlighter, Pencil,\r\n  Square, StickyNote, RectangleHorizontal, Eraser,\r\n  Merge, Split, Minimize2, ScanLine, FileOutput,\r\n  Droplets, Shield, MoreHorizontal\r\n} from 'lucide-vue-next'\r\nimport ToolButton from './ToolButton.vue'\r\n\r\nconst props = defineProps({\r\n  activeTool: { type: String, default: 'select' },\r\n})\r\n\r\nconst emit = defineEmits(['update:activeTool', 'server-tool'])\r\n\r\nfunction setTool(tool) {\r\n  emit('update:activeTool', tool)\r\n}\r\n\r\nconst serverTools = [\r\n  { id: 'merge', label: 'Merge', icon: Merge },\r\n  { id: 'split', label: 'Split', icon: Split },\r\n  { id: 'compress', label: 'Compress', icon: Minimize2 },\r\n  { id: 'ocr', label: 'OCR', icon: ScanLine },\r\n  { id: 'convert', label: 'Convert', icon: FileOutput },\r\n  { id: 'watermark', label: 'Watermark', icon: Droplets },\r\n  { id: 'protect', label: 'Protect', icon: Shield },\r\n]\r\n</script>\r\n","<template>\r\n  <div\r\n    class=\"pdf-page-wrapper relative inline-block mb-4 shadow-lg bg-white\"\r\n    :data-page=\"pageNum\"\r\n  >\r\n    <!-- PDF.js rendered canvas -->\r\n    <canvas ref=\"pdfCanvas\" class=\"block\" />\r\n\r\n    <!-- Fabric.js overlay canvas -->\r\n    <canvas\r\n      ref=\"fabricCanvas\"\r\n      class=\"fabric-overlay absolute top-0 left-0\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, watch } from 'vue'\r\n\r\nconst props = defineProps({\r\n  pageNum: { type: Number, required: true },\r\n  renderPage: { type: Function, required: true },\r\n  initFabricCanvas: { type: Function, default: null },\r\n  scale: { type: Number, default: 1.0 },\r\n})\r\n\r\nconst emit = defineEmits(['page-rendered', 'page-visible'])\r\n\r\nconst pdfCanvas = ref(null)\r\nconst fabricCanvas = ref(null)\r\n\r\nasync function render() {\r\n  if (!pdfCanvas.value) return\r\n\r\n  const result = await props.renderPage(props.pageNum, pdfCanvas.value)\r\n  if (!result) return\r\n\r\n  // Initialize Fabric.js overlay with same dimensions\r\n  if (props.initFabricCanvas && fabricCanvas.value) {\r\n    props.initFabricCanvas(props.pageNum, fabricCanvas.value, result.width, result.height)\r\n  }\r\n\r\n  emit('page-rendered', {\r\n    pageNum: props.pageNum,\r\n    width: result.width,\r\n    height: result.height,\r\n  })\r\n}\r\n\r\nonMounted(render)\r\n\r\n// Re-render when scale changes\r\nwatch(() => props.scale, render)\r\n\r\n// Expose the PDF canvas element for text editing (white-out original text)\r\ndefineExpose({ pdfCanvas, rerender: render })\r\n</script>\r\n","<template>\r\n  <div\r\n    ref=\"canvasContainer\"\r\n    class=\"flex-1 overflow-auto bg-gray-300 flex flex-col items-center py-6 px-4\"\r\n    @scroll=\"onScroll\"\r\n  >\r\n    <PdfPageCanvas\r\n      v-for=\"page in totalPages\"\r\n      :key=\"page\"\r\n      :ref=\"el => setPageRef(page, el)\"\r\n      :page-num=\"page\"\r\n      :render-page=\"renderPage\"\r\n      :init-fabric-canvas=\"initFabricCanvas\"\r\n      :scale=\"scale\"\r\n      @page-rendered=\"onPageRendered\"\r\n    />\r\n\r\n    <!-- Empty state -->\r\n    <div v-if=\"totalPages === 0 && !loading\" class=\"text-center py-20\">\r\n      <FileText class=\"w-16 h-16 mx-auto text-gray-400 mb-4\" />\r\n      <p class=\"text-gray-500 text-lg\">No PDF loaded</p>\r\n      <p class=\"text-gray-400 text-sm mt-1\">Open a file to start editing</p>\r\n    </div>\r\n\r\n    <!-- Loading -->\r\n    <div v-if=\"loading\" class=\"text-center py-20\">\r\n      <div class=\"w-8 h-8 border-3 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto\" />\r\n      <p class=\"text-gray-500 mt-3\">Loading PDF...</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { FileText } from 'lucide-vue-next'\r\nimport PdfPageCanvas from './PdfPageCanvas.vue'\r\n\r\nconst props = defineProps({\r\n  totalPages: { type: Number, default: 0 },\r\n  renderPage: { type: Function, required: true },\r\n  initFabricCanvas: { type: Function, default: null },\r\n  scale: { type: Number, default: 1.0 },\r\n  loading: { type: Boolean, default: false },\r\n})\r\n\r\nconst emit = defineEmits(['page-changed', 'page-rendered'])\r\n\r\nconst canvasContainer = ref(null)\r\n// Use a plain (non-reactive) Map for template refs to avoid infinite update loops.\r\n// Template ref callbacks fire on every render; if they mutate reactive state,\r\n// they trigger re-renders → infinite recursion.\r\nconst pageRefs = new Map()\r\n\r\nfunction setPageRef(pageNum, el) {\r\n  if (el) {\r\n    pageRefs.set(pageNum, el)\r\n  } else {\r\n    pageRefs.delete(pageNum)\r\n  }\r\n}\r\n\r\nfunction onScroll() {\r\n  if (!canvasContainer.value) return\r\n\r\n  const container = canvasContainer.value\r\n  const pages = container.querySelectorAll('.pdf-page-wrapper')\r\n  const containerTop = container.scrollTop\r\n  const containerHeight = container.clientHeight\r\n\r\n  let currentPage = 1\r\n  for (const page of pages) {\r\n    const pageTop = page.offsetTop - container.offsetTop\r\n    const pageBottom = pageTop + page.clientHeight\r\n\r\n    if (pageTop <= containerTop + containerHeight / 2 && pageBottom > containerTop) {\r\n      currentPage = parseInt(page.dataset.page)\r\n    }\r\n  }\r\n\r\n  emit('page-changed', currentPage)\r\n}\r\n\r\nfunction scrollToPage(pageNum) {\r\n  const container = canvasContainer.value\r\n  if (!container) return\r\n\r\n  const page = container.querySelector(`[data-page=\"${pageNum}\"]`)\r\n  if (page) {\r\n    page.scrollIntoView({ behavior: 'smooth', block: 'start' })\r\n  }\r\n}\r\n\r\nfunction getPageCanvasEl(pageNum) {\r\n  const comp = pageRefs.get(pageNum)\r\n  return comp?.pdfCanvas || null\r\n}\r\n\r\nfunction rerenderPage(pageNum) {\r\n  const comp = pageRefs.get(pageNum)\r\n  if (comp?.rerender) comp.rerender()\r\n}\r\n\r\nfunction onPageRendered(data) {\r\n  emit('page-rendered', data)\r\n}\r\n\r\ndefineExpose({ scrollToPage, getPageCanvasEl, rerenderPage })\r\n</script>\r\n","<template>\r\n  <div class=\"w-52 bg-white border-r border-gray-200 flex flex-col h-full\">\r\n    <!-- Tabs -->\r\n    <div class=\"flex border-b border-gray-200\">\r\n      <button\r\n        v-for=\"tab in tabs\"\r\n        :key=\"tab.id\"\r\n        @click=\"activeTab = tab.id\"\r\n        class=\"flex-1 py-2 px-1 text-xs font-medium transition-colors border-b-2\"\r\n        :class=\"activeTab === tab.id\r\n          ? 'border-brand-500 text-brand-600'\r\n          : 'border-transparent text-gray-500 hover:text-gray-700'\"\r\n      >\r\n        <component :is=\"tab.icon\" class=\"w-4 h-4 mx-auto\" />\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Thumbnails -->\r\n    <div v-if=\"activeTab === 'thumbnails'\" class=\"flex-1 overflow-y-auto p-2 space-y-2\">\r\n      <div\r\n        v-for=\"page in totalPages\"\r\n        :key=\"page\"\r\n        @click=\"$emit('go-to-page', page)\"\r\n        class=\"cursor-pointer rounded-lg border-2 transition-colors p-1\"\r\n        :class=\"currentPage === page ? 'border-brand-500 bg-brand-50' : 'border-gray-200 hover:border-brand-300'\"\r\n      >\r\n        <canvas\r\n          :ref=\"el => { if (el) thumbnailRefs[page] = el }\"\r\n          class=\"w-full bg-white rounded\"\r\n        />\r\n        <p class=\"text-xs text-center text-gray-500 mt-1\">{{ page }}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Annotations list -->\r\n    <div v-if=\"activeTab === 'annotations'\" class=\"flex-1 overflow-y-auto p-2\">\r\n      <div v-if=\"annotationList.length === 0\" class=\"text-sm text-gray-500 text-center py-4\">\r\n        No annotations yet\r\n      </div>\r\n      <div\r\n        v-for=\"annot in annotationList\"\r\n        :key=\"annot.id\"\r\n        class=\"px-3 py-2 text-xs border-b border-gray-100 hover:bg-gray-50 cursor-pointer\"\r\n        @click=\"$emit('select-annotation', annot)\"\r\n      >\r\n        <div class=\"flex items-center justify-between\">\r\n          <span class=\"font-medium capitalize\">{{ annot.type }}</span>\r\n          <span class=\"text-gray-400\">p.{{ annot.page }}</span>\r\n        </div>\r\n        <p v-if=\"annot.text\" class=\"text-gray-500 truncate mt-0.5\">{{ annot.text }}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Outline (placeholder) -->\r\n    <div v-if=\"activeTab === 'outline'\" class=\"flex-1 overflow-y-auto p-2\">\r\n      <p class=\"text-sm text-gray-500 text-center py-4\">Document outline</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, watch, onMounted } from 'vue'\r\nimport { LayoutGrid, List, FileText } from 'lucide-vue-next'\r\n\r\nconst props = defineProps({\r\n  totalPages: { type: Number, default: 0 },\r\n  currentPage: { type: Number, default: 1 },\r\n  annotationList: { type: Array, default: () => [] },\r\n  renderThumbnail: { type: Function, default: null },\r\n})\r\n\r\ndefineEmits(['go-to-page', 'select-annotation'])\r\n\r\nconst activeTab = ref('thumbnails')\r\nconst thumbnailRefs = reactive({})\r\n\r\nconst tabs = [\r\n  { id: 'thumbnails', icon: LayoutGrid },\r\n  { id: 'annotations', icon: List },\r\n  { id: 'outline', icon: FileText },\r\n]\r\n\r\n// Render thumbnails when they become available\r\nwatch(() => props.totalPages, async (pages) => {\r\n  if (pages && props.renderThumbnail) {\r\n    // Wait for refs to be set\r\n    await new Promise(r => setTimeout(r, 100))\r\n    for (let i = 1; i <= pages; i++) {\r\n      const canvas = thumbnailRefs[i]\r\n      if (canvas) {\r\n        await props.renderThumbnail(i, canvas, 0.2)\r\n      }\r\n    }\r\n  }\r\n})\r\n</script>\r\n","<template>\r\n  <div class=\"w-56 bg-white border-l border-gray-200 p-4 overflow-y-auto\">\r\n    <h3 class=\"text-sm font-semibold text-gray-900 mb-4\">Properties</h3>\r\n\r\n    <div v-if=\"!activeObject\" class=\"text-sm text-gray-500\">\r\n      Select an annotation to edit its properties.\r\n    </div>\r\n\r\n    <div v-else class=\"space-y-4\">\r\n      <!-- Color -->\r\n      <div>\r\n        <label class=\"block text-xs font-medium text-gray-600 mb-1\">Color</label>\r\n        <input\r\n          type=\"color\"\r\n          :value=\"toolOptions.color\"\r\n          @input=\"$emit('update-options', { color: $event.target.value })\"\r\n          class=\"w-full h-8 rounded border border-gray-300 cursor-pointer\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Font Size -->\r\n      <div v-if=\"activeObject?.type === 'textbox'\">\r\n        <label class=\"block text-xs font-medium text-gray-600 mb-1\">Font Size</label>\r\n        <input\r\n          type=\"number\"\r\n          :value=\"toolOptions.fontSize\"\r\n          @input=\"$emit('update-options', { fontSize: parseInt($event.target.value) })\"\r\n          min=\"8\"\r\n          max=\"120\"\r\n          class=\"w-full px-3 py-1.5 border border-gray-300 rounded text-sm\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Opacity -->\r\n      <div>\r\n        <label class=\"block text-xs font-medium text-gray-600 mb-1\">\r\n          Opacity: {{ Math.round(toolOptions.opacity * 100) }}%\r\n        </label>\r\n        <input\r\n          type=\"range\"\r\n          :value=\"toolOptions.opacity\"\r\n          @input=\"$emit('update-options', { opacity: parseFloat($event.target.value) })\"\r\n          min=\"0\"\r\n          max=\"1\"\r\n          step=\"0.05\"\r\n          class=\"w-full\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Stroke Width -->\r\n      <div v-if=\"['rect', 'circle', 'line', 'path'].includes(activeObject?.type)\">\r\n        <label class=\"block text-xs font-medium text-gray-600 mb-1\">Stroke Width</label>\r\n        <input\r\n          type=\"number\"\r\n          :value=\"toolOptions.strokeWidth\"\r\n          @input=\"$emit('update-options', { strokeWidth: parseInt($event.target.value) })\"\r\n          min=\"1\"\r\n          max=\"20\"\r\n          class=\"w-full px-3 py-1.5 border border-gray-300 rounded text-sm\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Delete -->\r\n      <button\r\n        @click=\"$emit('delete-selected')\"\r\n        class=\"w-full px-3 py-2 text-sm text-red-600 bg-red-50 hover:bg-red-100 rounded-md transition-colors\"\r\n      >\r\n        Delete\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\ndefineProps({\r\n  activeObject: { type: Object, default: null },\r\n  toolOptions: { type: Object, default: () => ({}) },\r\n})\r\n\r\ndefineEmits(['update-options', 'delete-selected'])\r\n</script>\r\n","<template>\r\n  <div class=\"bg-gray-100 border-t border-gray-200 px-4 py-1.5 flex items-center justify-between text-xs text-gray-600\">\r\n    <!-- Left: Page info -->\r\n    <div class=\"flex items-center gap-4\">\r\n      <span>Page {{ currentPage }} of {{ totalPages }}</span>\r\n    </div>\r\n\r\n    <!-- Center: Zoom -->\r\n    <div class=\"flex items-center gap-2\">\r\n      <button @click=\"$emit('zoom-out')\" class=\"p-1 hover:bg-gray-200 rounded\" title=\"Zoom out\">\r\n        <ZoomOut class=\"w-3.5 h-3.5\" />\r\n      </button>\r\n      <span class=\"w-12 text-center\">{{ zoomPercent }}%</span>\r\n      <button @click=\"$emit('zoom-in')\" class=\"p-1 hover:bg-gray-200 rounded\" title=\"Zoom in\">\r\n        <ZoomIn class=\"w-3.5 h-3.5\" />\r\n      </button>\r\n      <button @click=\"$emit('zoom-fit')\" class=\"p-1 hover:bg-gray-200 rounded ml-1\" title=\"Fit to page\">\r\n        <Maximize2 class=\"w-3.5 h-3.5\" />\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Right: File info + save status -->\r\n    <div class=\"flex items-center gap-4\">\r\n      <span v-if=\"fileSize\">{{ fileSize }}</span>\r\n      <span v-if=\"isDirty\" class=\"text-amber-600\">Unsaved changes</span>\r\n      <span v-else-if=\"lastSaved\" class=\"text-green-600\">Saved</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ZoomIn, ZoomOut, Maximize2 } from 'lucide-vue-next'\r\n\r\ndefineProps({\r\n  currentPage: { type: Number, default: 1 },\r\n  totalPages: { type: Number, default: 0 },\r\n  zoomPercent: { type: Number, default: 100 },\r\n  fileSize: { type: String, default: '' },\r\n  isDirty: { type: Boolean, default: false },\r\n  lastSaved: { type: String, default: '' },\r\n})\r\n\r\ndefineEmits(['zoom-in', 'zoom-out', 'zoom-fit'])\r\n</script>\r\n","<template>\r\n  <div v-if=\"visible\" class=\"absolute top-2 right-4 z-10 bg-white border border-gray-200 rounded-lg shadow-lg p-3 flex items-center gap-2\">\r\n    <Search class=\"w-4 h-4 text-gray-400\" />\r\n    <input\r\n      ref=\"searchInput\"\r\n      v-model=\"query\"\r\n      @keydown.enter=\"findNext\"\r\n      @keydown.escape=\"$emit('close')\"\r\n      type=\"text\"\r\n      placeholder=\"Search in document...\"\r\n      class=\"w-56 text-sm border-none outline-none\"\r\n    />\r\n    <span v-if=\"total > 0\" class=\"text-xs text-gray-500\">{{ current }} / {{ total }}</span>\r\n    <button @click=\"findPrev\" class=\"p-1 hover:bg-gray-100 rounded\" :disabled=\"total === 0\">\r\n      <ChevronUp class=\"w-4 h-4\" />\r\n    </button>\r\n    <button @click=\"findNext\" class=\"p-1 hover:bg-gray-100 rounded\" :disabled=\"total === 0\">\r\n      <ChevronDown class=\"w-4 h-4\" />\r\n    </button>\r\n    <button @click=\"$emit('close')\" class=\"p-1 hover:bg-gray-100 rounded\">\r\n      <X class=\"w-4 h-4\" />\r\n    </button>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch, nextTick } from 'vue'\r\nimport { Search, ChevronUp, ChevronDown, X } from 'lucide-vue-next'\r\n\r\nconst props = defineProps({\r\n  visible: { type: Boolean, default: false },\r\n  getPageText: { type: Function, default: null },\r\n  totalPages: { type: Number, default: 0 },\r\n})\r\n\r\nconst emit = defineEmits(['close', 'go-to-page'])\r\n\r\nconst searchInput = ref(null)\r\nconst query = ref('')\r\nconst results = ref([])\r\nconst current = ref(0)\r\nconst total = ref(0)\r\n\r\nwatch(() => props.visible, async (v) => {\r\n  if (v) {\r\n    await nextTick()\r\n    searchInput.value?.focus()\r\n  }\r\n})\r\n\r\nwatch(query, async (q) => {\r\n  if (!q || !props.getPageText) {\r\n    results.value = []\r\n    current.value = 0\r\n    total.value = 0\r\n    return\r\n  }\r\n\r\n  const matches = []\r\n  for (let i = 1; i <= props.totalPages; i++) {\r\n    const text = await props.getPageText(i)\r\n    if (text.toLowerCase().includes(q.toLowerCase())) {\r\n      matches.push(i)\r\n    }\r\n  }\r\n  results.value = matches\r\n  total.value = matches.length\r\n  current.value = matches.length > 0 ? 1 : 0\r\n})\r\n\r\nfunction findNext() {\r\n  if (total.value === 0) return\r\n  current.value = current.value >= total.value ? 1 : current.value + 1\r\n  emit('go-to-page', results.value[current.value - 1])\r\n}\r\n\r\nfunction findPrev() {\r\n  if (total.value === 0) return\r\n  current.value = current.value <= 1 ? total.value : current.value - 1\r\n  emit('go-to-page', results.value[current.value - 1])\r\n}\r\n</script>\r\n","<template>\r\n  <div class=\"fixed inset-0 bg-black/30 z-50 flex items-center justify-center\" @click.self=\"$emit('close')\">\r\n    <div class=\"bg-white rounded-xl shadow-2xl w-[480px] max-h-[80vh] overflow-hidden\">\r\n      <!-- Header -->\r\n      <div class=\"flex items-center justify-between px-5 py-4 border-b border-gray-200\">\r\n        <div class=\"flex items-center gap-2\">\r\n          <component :is=\"toolConfig.icon\" class=\"w-5 h-5 text-brand-600\" />\r\n          <h3 class=\"font-semibold text-gray-900\">{{ toolConfig.title }}</h3>\r\n        </div>\r\n        <button @click=\"$emit('close')\" class=\"p-1 hover:bg-gray-100 rounded\">\r\n          <X class=\"w-4 h-4\" />\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Body -->\r\n      <div class=\"px-5 py-4 overflow-auto max-h-[60vh]\">\r\n        <p v-if=\"!hasFile\" class=\"text-gray-500 text-center py-8\">\r\n          No PDF loaded. Open a file first.\r\n        </p>\r\n\r\n        <template v-else>\r\n          <!-- Split Tool -->\r\n          <template v-if=\"toolId === 'split'\">\r\n            <p class=\"text-sm text-gray-600 mb-3\">Split the current PDF into separate files.</p>\r\n            <div class=\"space-y-3\">\r\n              <label class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Mode</span>\r\n                <select v-model=\"splitMode\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500 focus:border-brand-500\">\r\n                  <option value=\"ranges\">By page ranges</option>\r\n                  <option value=\"every\">Every N pages</option>\r\n                  <option value=\"extract\">Extract specific pages</option>\r\n                </select>\r\n              </label>\r\n              <label v-if=\"splitMode === 'ranges'\" class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Page ranges (e.g., 1-3, 5-7)</span>\r\n                <input v-model=\"splitRanges\" type=\"text\" placeholder=\"1-3, 4-6, 7-10\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500\" />\r\n              </label>\r\n              <label v-if=\"splitMode === 'every'\" class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Every N pages</span>\r\n                <input v-model.number=\"splitN\" type=\"number\" min=\"1\" :max=\"totalPages\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500\" />\r\n              </label>\r\n              <label v-if=\"splitMode === 'extract'\" class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Pages to extract (e.g., 1, 3, 5)</span>\r\n                <input v-model=\"extractPages\" type=\"text\" placeholder=\"1, 3, 5, 8\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500\" />\r\n              </label>\r\n              <p class=\"text-xs text-gray-400\">Total pages: {{ totalPages }}</p>\r\n            </div>\r\n          </template>\r\n\r\n          <!-- Compress Tool -->\r\n          <template v-if=\"toolId === 'compress'\">\r\n            <p class=\"text-sm text-gray-600 mb-3\">Reduce file size. Higher quality = larger file.</p>\r\n            <label class=\"block\">\r\n              <span class=\"text-sm font-medium text-gray-700\">Quality</span>\r\n              <select v-model=\"compressQuality\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500 focus:border-brand-500\">\r\n                <option value=\"screen\">Screen (smallest, 72 dpi)</option>\r\n                <option value=\"ebook\">Ebook (medium, 150 dpi)</option>\r\n                <option value=\"printer\">Printer (high, 300 dpi)</option>\r\n              </select>\r\n            </label>\r\n          </template>\r\n\r\n          <!-- Merge Tool -->\r\n          <template v-if=\"toolId === 'merge'\">\r\n            <p class=\"text-sm text-gray-600 mb-3\">Add more PDFs to merge with the current document.</p>\r\n            <div class=\"space-y-3\">\r\n              <div\r\n                class=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-brand-400 hover:bg-brand-50/30 transition\"\r\n                @click=\"pickMergeFiles\"\r\n                @dragover.prevent\r\n                @drop.prevent=\"handleMergeDrop\"\r\n              >\r\n                <FilePlus class=\"w-8 h-8 mx-auto text-gray-400 mb-2\" />\r\n                <p class=\"text-sm text-gray-600\">Click or drop PDFs to add</p>\r\n              </div>\r\n              <div v-if=\"mergeFiles.length > 0\" class=\"space-y-2\">\r\n                <div v-for=\"(file, idx) in mergeFiles\" :key=\"idx\" class=\"flex items-center gap-2 bg-gray-50 rounded px-3 py-2 text-sm\">\r\n                  <FileText class=\"w-4 h-4 text-gray-500 flex-shrink-0\" />\r\n                  <span class=\"flex-1 truncate\">{{ file.name }}</span>\r\n                  <button @click=\"mergeFiles.splice(idx, 1)\" class=\"text-gray-400 hover:text-red-500\">\r\n                    <X class=\"w-3.5 h-3.5\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </template>\r\n\r\n          <!-- Watermark Tool -->\r\n          <template v-if=\"toolId === 'watermark'\">\r\n            <p class=\"text-sm text-gray-600 mb-3\">Add a text watermark to all pages.</p>\r\n            <div class=\"space-y-3\">\r\n              <label class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Watermark text</span>\r\n                <input v-model=\"watermarkText\" type=\"text\" placeholder=\"CONFIDENTIAL\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500\" />\r\n              </label>\r\n              <label class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Opacity</span>\r\n                <input v-model.number=\"watermarkOpacity\" type=\"range\" min=\"0.05\" max=\"0.5\" step=\"0.05\" class=\"mt-1 w-full\" />\r\n                <span class=\"text-xs text-gray-400\">{{ Math.round(watermarkOpacity * 100) }}%</span>\r\n              </label>\r\n              <label class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Color</span>\r\n                <input v-model=\"watermarkColor\" type=\"color\" class=\"mt-1 w-12 h-8 rounded border\" />\r\n              </label>\r\n            </div>\r\n          </template>\r\n\r\n          <!-- Protect Tool -->\r\n          <template v-if=\"toolId === 'protect'\">\r\n            <p class=\"text-sm text-gray-600 mb-3\">Set a password to protect the PDF.</p>\r\n            <div class=\"space-y-3\">\r\n              <label class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">User password (to open)</span>\r\n                <input v-model=\"protectUserPw\" type=\"password\" placeholder=\"Enter password\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500\" />\r\n              </label>\r\n              <label class=\"block\">\r\n                <span class=\"text-sm font-medium text-gray-700\">Owner password (to edit, optional)</span>\r\n                <input v-model=\"protectOwnerPw\" type=\"password\" placeholder=\"Enter owner password\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500\" />\r\n              </label>\r\n            </div>\r\n          </template>\r\n\r\n          <!-- OCR / Convert - Need backend -->\r\n          <template v-if=\"toolId === 'ocr' || toolId === 'convert'\">\r\n            <div class=\"text-center py-6\">\r\n              <component :is=\"toolId === 'ocr' ? ScanLine : FileOutput\" class=\"w-12 h-12 mx-auto text-gray-300 mb-3\" />\r\n              <p class=\"text-gray-600 font-medium\">{{ toolConfig.title }}</p>\r\n              <p class=\"text-sm text-gray-400 mt-1\">\r\n                This operation requires the pdf_suite backend to be installed on your Frappe instance.\r\n              </p>\r\n              <div class=\"mt-4 bg-gray-50 rounded-lg p-3 text-left text-xs text-gray-500 font-mono\">\r\n                bench get-app https://github.com/Dravecx/pdf-suite<br>\r\n                bench --site your-site install-app pdf_suite\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </template>\r\n      </div>\r\n\r\n      <!-- Footer -->\r\n      <div v-if=\"hasFile && !['ocr', 'convert'].includes(toolId)\" class=\"px-5 py-3 border-t border-gray-200 flex justify-end gap-2\">\r\n        <button @click=\"$emit('close')\" class=\"px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg\">\r\n          Cancel\r\n        </button>\r\n        <button\r\n          @click=\"handleApply\"\r\n          :disabled=\"processing\"\r\n          class=\"px-4 py-2 text-sm bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2\"\r\n        >\r\n          <Loader2 v-if=\"processing\" class=\"w-4 h-4 animate-spin\" />\r\n          {{ processing ? 'Processing...' : 'Apply' }}\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Status -->\r\n      <div v-if=\"statusMessage\" class=\"px-5 py-2 text-sm\" :class=\"statusError ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-700'\">\r\n        {{ statusMessage }}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue'\r\nimport {\r\n  X, Loader2, FileText, FilePlus,\r\n  Merge, Split, Minimize2, ScanLine, FileOutput,\r\n  Droplets, Shield\r\n} from 'lucide-vue-next'\r\nimport { PDFDocument, rgb, StandardFonts, degrees } from 'pdf-lib'\r\n\r\nconst props = defineProps({\r\n  toolId: { type: String, required: true },\r\n  pdfFile: { type: [File, Object], default: null },\r\n  totalPages: { type: Number, default: 0 },\r\n})\r\n\r\nconst emit = defineEmits(['close', 'done'])\r\n\r\nconst hasFile = computed(() => !!props.pdfFile)\r\n\r\nconst processing = ref(false)\r\nconst statusMessage = ref('')\r\nconst statusError = ref(false)\r\n\r\n// Split state\r\nconst splitMode = ref('ranges')\r\nconst splitRanges = ref('')\r\nconst splitN = ref(1)\r\nconst extractPages = ref('')\r\n\r\n// Compress state\r\nconst compressQuality = ref('ebook')\r\n\r\n// Merge state\r\nconst mergeFiles = ref([])\r\n\r\n// Watermark state\r\nconst watermarkText = ref('CONFIDENTIAL')\r\nconst watermarkOpacity = ref(0.15)\r\nconst watermarkColor = ref('#888888')\r\n\r\n// Protect state\r\nconst protectUserPw = ref('')\r\nconst protectOwnerPw = ref('')\r\n\r\nconst toolConfigs = {\r\n  merge: { title: 'Merge PDFs', icon: Merge },\r\n  split: { title: 'Split PDF', icon: Split },\r\n  compress: { title: 'Compress PDF', icon: Minimize2 },\r\n  ocr: { title: 'OCR (Make Searchable)', icon: ScanLine },\r\n  convert: { title: 'Convert PDF', icon: FileOutput },\r\n  watermark: { title: 'Add Watermark', icon: Droplets },\r\n  protect: { title: 'Protect PDF', icon: Shield },\r\n}\r\n\r\nconst toolConfig = computed(() => toolConfigs[props.toolId] || { title: props.toolId, icon: FileText })\r\n\r\nfunction pickMergeFiles() {\r\n  const input = document.createElement('input')\r\n  input.type = 'file'\r\n  input.accept = '.pdf'\r\n  input.multiple = true\r\n  input.onchange = (e) => {\r\n    for (const file of e.target.files) {\r\n      mergeFiles.value.push(file)\r\n    }\r\n  }\r\n  input.click()\r\n}\r\n\r\nfunction handleMergeDrop(e) {\r\n  for (const file of e.dataTransfer.files) {\r\n    if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {\r\n      mergeFiles.value.push(file)\r\n    }\r\n  }\r\n}\r\n\r\nasync function handleApply() {\r\n  processing.value = true\r\n  statusMessage.value = ''\r\n  statusError.value = false\r\n\r\n  try {\r\n    switch (props.toolId) {\r\n      case 'split': await handleSplit(); break\r\n      case 'compress': await handleCompress(); break\r\n      case 'merge': await handleMerge(); break\r\n      case 'watermark': await handleWatermark(); break\r\n      case 'protect': await handleProtect(); break\r\n    }\r\n  } catch (e) {\r\n    statusMessage.value = 'Error: ' + (e.message || 'Operation failed')\r\n    statusError.value = true\r\n  } finally {\r\n    processing.value = false\r\n  }\r\n}\r\n\r\nasync function loadCurrentPdf() {\r\n  const file = props.pdfFile\r\n  if (file instanceof File) {\r\n    return await PDFDocument.load(await file.arrayBuffer())\r\n  }\r\n  throw new Error('No file loaded')\r\n}\r\n\r\nfunction downloadBlob(blob, filename) {\r\n  const url = URL.createObjectURL(blob)\r\n  const a = document.createElement('a')\r\n  a.href = url\r\n  a.download = filename\r\n  a.click()\r\n  URL.revokeObjectURL(url)\r\n}\r\n\r\nasync function handleSplit() {\r\n  const srcDoc = await loadCurrentPdf()\r\n  const total = srcDoc.getPageCount()\r\n\r\n  let pageSets = []\r\n\r\n  if (splitMode.value === 'ranges') {\r\n    const ranges = splitRanges.value.split(',').map(r => r.trim())\r\n    for (const range of ranges) {\r\n      const parts = range.split('-').map(Number)\r\n      if (parts.length === 2) {\r\n        const pages = []\r\n        for (let i = parts[0]; i <= Math.min(parts[1], total); i++) pages.push(i - 1)\r\n        pageSets.push(pages)\r\n      } else if (parts.length === 1 && !isNaN(parts[0])) {\r\n        pageSets.push([parts[0] - 1])\r\n      }\r\n    }\r\n  } else if (splitMode.value === 'every') {\r\n    const n = splitN.value || 1\r\n    for (let i = 0; i < total; i += n) {\r\n      const pages = []\r\n      for (let j = i; j < Math.min(i + n, total); j++) pages.push(j)\r\n      pageSets.push(pages)\r\n    }\r\n  } else if (splitMode.value === 'extract') {\r\n    const pages = extractPages.value.split(',').map(p => parseInt(p.trim()) - 1).filter(p => p >= 0 && p < total)\r\n    pageSets.push(pages)\r\n  }\r\n\r\n  if (pageSets.length === 0) {\r\n    statusMessage.value = 'No valid pages specified'\r\n    statusError.value = true\r\n    return\r\n  }\r\n\r\n  for (let i = 0; i < pageSets.length; i++) {\r\n    const newDoc = await PDFDocument.create()\r\n    const copiedPages = await newDoc.copyPages(srcDoc, pageSets[i])\r\n    for (const page of copiedPages) newDoc.addPage(page)\r\n    const bytes = await newDoc.save()\r\n    downloadBlob(new Blob([bytes], { type: 'application/pdf' }), `split_part_${i + 1}.pdf`)\r\n  }\r\n\r\n  statusMessage.value = `Split into ${pageSets.length} file(s) — downloading...`\r\n}\r\n\r\nasync function handleCompress() {\r\n  // Client-side \"compression\" — remove metadata, flatten unused objects\r\n  const srcDoc = await loadCurrentPdf()\r\n\r\n  // pdf-lib doesn't have true compression, but we can strip metadata\r\n  srcDoc.setTitle('')\r\n  srcDoc.setAuthor('')\r\n  srcDoc.setSubject('')\r\n  srcDoc.setKeywords([])\r\n  srcDoc.setProducer('')\r\n  srcDoc.setCreator('')\r\n\r\n  const bytes = await srcDoc.save({\r\n    useObjectStreams: true,\r\n    addDefaultPage: false,\r\n  })\r\n\r\n  downloadBlob(new Blob([bytes], { type: 'application/pdf' }), 'compressed.pdf')\r\n  statusMessage.value = `Saved. Note: for heavy compression (image downsampling), install the pdf_suite backend.`\r\n}\r\n\r\nasync function handleMerge() {\r\n  if (mergeFiles.value.length === 0) {\r\n    statusMessage.value = 'Add at least one PDF to merge'\r\n    statusError.value = true\r\n    return\r\n  }\r\n\r\n  const mainDoc = await loadCurrentPdf()\r\n\r\n  for (const file of mergeFiles.value) {\r\n    const bytes = await file.arrayBuffer()\r\n    const otherDoc = await PDFDocument.load(bytes)\r\n    const copiedPages = await mainDoc.copyPages(otherDoc, otherDoc.getPageIndices())\r\n    for (const page of copiedPages) mainDoc.addPage(page)\r\n  }\r\n\r\n  const resultBytes = await mainDoc.save()\r\n  downloadBlob(new Blob([resultBytes], { type: 'application/pdf' }), 'merged.pdf')\r\n  statusMessage.value = `Merged ${mergeFiles.value.length + 1} files — downloading...`\r\n}\r\n\r\nasync function handleWatermark() {\r\n  if (!watermarkText.value.trim()) {\r\n    statusMessage.value = 'Enter watermark text'\r\n    statusError.value = true\r\n    return\r\n  }\r\n\r\n  const pdfDoc = await loadCurrentPdf()\r\n  const font = await pdfDoc.embedFont(StandardFonts.HelveticaBold)\r\n  const pages = pdfDoc.getPages()\r\n\r\n  const hex = watermarkColor.value.replace('#', '')\r\n  const r = parseInt(hex.substring(0, 2), 16) / 255\r\n  const g = parseInt(hex.substring(2, 4), 16) / 255\r\n  const b = parseInt(hex.substring(4, 6), 16) / 255\r\n\r\n  for (const page of pages) {\r\n    const { width, height } = page.getSize()\r\n    const fontSize = Math.min(width, height) / 8\r\n\r\n    page.drawText(watermarkText.value, {\r\n      x: width / 2 - (watermarkText.value.length * fontSize * 0.3),\r\n      y: height / 2,\r\n      size: fontSize,\r\n      font,\r\n      color: rgb(r, g, b),\r\n      opacity: watermarkOpacity.value,\r\n      rotate: degrees(-45),\r\n    })\r\n  }\r\n\r\n  const bytes = await pdfDoc.save()\r\n  downloadBlob(new Blob([bytes], { type: 'application/pdf' }), 'watermarked.pdf')\r\n  statusMessage.value = `Watermark added to ${pages.length} pages — downloading...`\r\n}\r\n\r\nasync function handleProtect() {\r\n  if (!protectUserPw.value) {\r\n    statusMessage.value = 'Enter a user password'\r\n    statusError.value = true\r\n    return\r\n  }\r\n\r\n  // pdf-lib doesn't support encryption directly\r\n  // We'd need the backend for this\r\n  statusMessage.value = 'PDF encryption requires the pdf_suite backend (pikepdf). Install with: bench get-app pdf-suite'\r\n  statusError.value = true\r\n}\r\n</script>\r\n","<template>\r\n  <div class=\"flex flex-col h-screen bg-gray-50\">\r\n    <!-- Header -->\r\n    <div class=\"bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between\">\r\n      <div class=\"flex items-center gap-3\">\r\n        <router-link v-if=\"!embedded\" to=\"/\" class=\"text-brand-600 hover:text-brand-700\">\r\n          <FileText class=\"w-5 h-5\" />\r\n        </router-link>\r\n        <span class=\"font-semibold text-gray-900\">PDF Studio</span>\r\n\r\n        <!-- Undo / Redo -->\r\n        <div class=\"flex items-center gap-1 ml-4\">\r\n          <button\r\n            @click=\"handleUndo\"\r\n            :disabled=\"canvasUndoStack.length === 0\"\r\n            class=\"p-1.5 rounded hover:bg-gray-100 disabled:opacity-30\"\r\n            title=\"Undo (Ctrl+Z)\"\r\n          >\r\n            <Undo2 class=\"w-4 h-4\" />\r\n          </button>\r\n          <button\r\n            @click=\"handleRedo\"\r\n            :disabled=\"canvasRedoStack.length === 0\"\r\n            class=\"p-1.5 rounded hover:bg-gray-100 disabled:opacity-30\"\r\n            title=\"Redo (Ctrl+Y)\"\r\n          >\r\n            <Redo2 class=\"w-4 h-4\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"flex items-center gap-2\">\r\n        <span class=\"text-sm text-gray-500\">{{ store.fileName || 'No file' }}</span>\r\n      </div>\r\n\r\n      <div class=\"flex items-center gap-2\">\r\n        <button @click=\"showSearch = !showSearch\" class=\"p-2 hover:bg-gray-100 rounded\" title=\"Search (Ctrl+F)\">\r\n          <Search class=\"w-4 h-4\" />\r\n        </button>\r\n        <button @click=\"store.showSidebar = !store.showSidebar\" class=\"p-2 hover:bg-gray-100 rounded\" title=\"Toggle sidebar\">\r\n          <PanelLeft class=\"w-4 h-4\" />\r\n        </button>\r\n        <button @click=\"store.showProperties = !store.showProperties\" class=\"p-2 hover:bg-gray-100 rounded\" title=\"Toggle properties\">\r\n          <PanelRight class=\"w-4 h-4\" />\r\n        </button>\r\n\r\n        <!-- Save button -->\r\n        <button\r\n          @click=\"exportPdf('download')\"\r\n          :disabled=\"!pdfFile && !store.fileUrl\"\r\n          class=\"flex items-center gap-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium disabled:opacity-40\"\r\n          title=\"Save / Download (Ctrl+S)\"\r\n        >\r\n          <Save class=\"w-4 h-4\" />\r\n          Save\r\n        </button>\r\n\r\n        <!-- Export dropdown -->\r\n        <div class=\"relative\" ref=\"exportDropdown\">\r\n          <button\r\n            @click=\"showExportMenu = !showExportMenu\"\r\n            class=\"flex items-center gap-1 px-3 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 text-sm font-medium\"\r\n          >\r\n            <Download class=\"w-4 h-4\" />\r\n            Export\r\n            <ChevronDown class=\"w-3 h-3\" />\r\n          </button>\r\n          <div\r\n            v-if=\"showExportMenu\"\r\n            class=\"absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 w-48 z-20\"\r\n          >\r\n            <button @click=\"exportPdf('download')\" class=\"w-full text-left px-4 py-2 text-sm hover:bg-gray-50\">\r\n              Download PDF\r\n            </button>\r\n            <button @click=\"exportPdf('save')\" class=\"w-full text-left px-4 py-2 text-sm hover:bg-gray-50\">\r\n              Save to Frappe\r\n            </button>\r\n            <button @click=\"exportPdf('flatten')\" class=\"w-full text-left px-4 py-2 text-sm hover:bg-gray-50\">\r\n              Flatten & Download\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Toolbar -->\r\n    <PdfToolbar\r\n      :active-tool=\"currentTool\"\r\n      @update:active-tool=\"handleToolChange\"\r\n      @server-tool=\"handleServerTool\"\r\n    />\r\n\r\n    <!-- Active tool indicator -->\r\n    <div v-if=\"currentTool !== 'select'\" class=\"border-b px-4 py-1.5 text-sm flex items-center justify-between\" :class=\"toolIndicatorClass\">\r\n      <span>\r\n        <strong class=\"capitalize\">{{ toolLabel }}</strong> {{ toolHint }}\r\n      </span>\r\n      <button @click=\"handleToolChange('select')\" class=\"text-xs hover:underline\" :class=\"currentTool === 'editText' ? 'text-amber-700' : 'text-brand-600'\">\r\n        {{ currentTool === 'editText' ? 'Done Editing' : 'Back to Select' }}\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Main area -->\r\n    <div class=\"flex flex-1 overflow-hidden relative\">\r\n      <!-- Search bar -->\r\n      <PdfSearchBar\r\n        :visible=\"showSearch\"\r\n        :get-page-text=\"pdf.getPageText\"\r\n        :total-pages=\"pdf.totalPages.value\"\r\n        @close=\"showSearch = false\"\r\n        @go-to-page=\"goToPage\"\r\n      />\r\n\r\n      <!-- Sidebar -->\r\n      <PdfSidebar\r\n        v-if=\"store.showSidebar\"\r\n        :total-pages=\"pdf.totalPages.value\"\r\n        :current-page=\"pdf.currentPage.value\"\r\n        :annotation-list=\"annotations.annotationList.value\"\r\n        :render-thumbnail=\"pdf.renderThumbnail\"\r\n        @go-to-page=\"goToPage\"\r\n        @select-annotation=\"annotations.selectAnnotation\"\r\n      />\r\n\r\n      <!-- Canvas area -->\r\n      <PdfCanvas\r\n        ref=\"canvasArea\"\r\n        :total-pages=\"pdf.totalPages.value\"\r\n        :render-page=\"pdf.renderPage\"\r\n        :init-fabric-canvas=\"fabric.initCanvas\"\r\n        :scale=\"pdf.scale.value\"\r\n        :loading=\"pdf.loading.value\"\r\n        @page-changed=\"pdf.currentPage.value = $event\"\r\n      />\r\n\r\n      <!-- Properties panel -->\r\n      <PdfPropertiesPanel\r\n        v-if=\"store.showProperties\"\r\n        :active-object=\"fabric.activeObject.value\"\r\n        :tool-options=\"fabric.toolOptions.value\"\r\n        @update-options=\"handleOptionsUpdate\"\r\n        @delete-selected=\"fabric.deleteSelected(pdf.currentPage.value)\"\r\n      />\r\n    </div>\r\n\r\n    <!-- Status bar -->\r\n    <PdfStatusBar\r\n      :current-page=\"pdf.currentPage.value\"\r\n      :total-pages=\"pdf.totalPages.value\"\r\n      :zoom-percent=\"pdf.zoomPercent.value\"\r\n      :file-size=\"fileSizeStr\"\r\n      :is-dirty=\"store.isDirty\"\r\n      :last-saved=\"store.lastSaved\"\r\n      @zoom-in=\"pdf.zoomIn()\"\r\n      @zoom-out=\"pdf.zoomOut()\"\r\n      @zoom-fit=\"pdf.zoomFit()\"\r\n    />\r\n\r\n    <!-- File drop zone (when no file loaded) -->\r\n    <div\r\n      v-if=\"pdf.totalPages.value === 0 && !pdf.loading.value\"\r\n      class=\"absolute inset-0 flex items-center justify-center bg-gray-50/80 z-10\"\r\n    >\r\n      <FileDropZone\r\n        accept=\".pdf\"\r\n        label=\"Drop a PDF here or click to open\"\r\n        hint=\"Supports PDF files up to 100 MB\"\r\n        class=\"w-96\"\r\n        @files-selected=\"handleFileOpen\"\r\n      />\r\n    </div>\r\n\r\n    <!-- Server Tool Panel (inline dialog) -->\r\n    <ServerToolPanel\r\n      v-if=\"activeServerTool\"\r\n      :tool-id=\"activeServerTool\"\r\n      :pdf-file=\"pdfFile\"\r\n      :total-pages=\"pdf.totalPages.value\"\r\n      @close=\"activeServerTool = null\"\r\n      @done=\"handleServerToolDone\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch, onMounted, onUnmounted } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport {\r\n  FileText, Undo2, Redo2, Search, PanelLeft, PanelRight,\r\n  Download, ChevronDown, Save\r\n} from 'lucide-vue-next'\r\nimport { useEditorStore } from '@/stores/editorStore'\r\nimport { usePdfRenderer } from '@/composables/usePdfRenderer'\r\nimport { useFabricCanvas } from '@/composables/useFabricCanvas'\r\nimport { usePdfModifier } from '@/composables/usePdfModifier'\r\nimport { useUndoRedo } from '@/composables/useUndoRedo'\r\nimport { useAnnotations } from '@/composables/useAnnotations'\r\nimport { usePdfApi } from '@/composables/usePdfApi'\r\nimport { usePdfTextEditor } from '@/composables/usePdfTextEditor'\r\nimport PdfToolbar from './PdfToolbar.vue'\r\nimport PdfCanvas from './PdfCanvas.vue'\r\nimport PdfSidebar from './PdfSidebar.vue'\r\nimport PdfPropertiesPanel from './PdfPropertiesPanel.vue'\r\nimport PdfStatusBar from './PdfStatusBar.vue'\r\nimport PdfSearchBar from './PdfSearchBar.vue'\r\nimport FileDropZone from '@/components/shared/FileDropZone.vue'\r\nimport ServerToolPanel from './ServerToolPanel.vue'\r\n\r\nconst props = defineProps({\r\n  embedded: { type: Boolean, default: false },\r\n})\r\n\r\nconst route = useRoute()\r\nconst store = useEditorStore()\r\nconst pdf = usePdfRenderer()\r\nconst fabric = useFabricCanvas()\r\nconst modifier = usePdfModifier()\r\nconst undoRedo = useUndoRedo()\r\nconst annotations = useAnnotations()\r\nconst api = usePdfApi()\r\nconst textEditor = usePdfTextEditor()\r\n\r\nconst canvasArea = ref(null)\r\nconst showSearch = ref(false)\r\nconst showExportMenu = ref(false)\r\nconst pdfFile = ref(null)\r\nconst activeServerTool = ref(null)\r\nconst currentTool = ref('select')\r\n\r\n// Canvas-based undo/redo (stores Fabric JSON snapshots per page)\r\nconst canvasUndoStack = ref([]) // [{pageNum, state}]\r\nconst canvasRedoStack = ref([])\r\nlet isUndoRedoing = false\r\n\r\nfunction saveCanvasState(pageNum) {\r\n  if (isUndoRedoing) return\r\n  const canvas = fabric.canvases.value.get(pageNum)\r\n  if (!canvas) return\r\n  const state = JSON.stringify(canvas.toJSON(['_annotationType', '_pageNum', '_originalText', '_originalColor', '_originalBounds', '_pdfCoords', '_lineItems']))\r\n  canvasUndoStack.value.push({ pageNum, state })\r\n  canvasRedoStack.value = []\r\n  // Trim to 30 states\r\n  if (canvasUndoStack.value.length > 30) canvasUndoStack.value.shift()\r\n}\r\n\r\nasync function handleUndo() {\r\n  if (canvasUndoStack.value.length === 0) return\r\n  isUndoRedoing = true\r\n  const entry = canvasUndoStack.value.pop()\r\n  const canvas = fabric.canvases.value.get(entry.pageNum)\r\n  if (canvas) {\r\n    // Save current state for redo\r\n    const current = JSON.stringify(canvas.toJSON(['_annotationType', '_pageNum', '_originalText', '_originalColor', '_originalBounds', '_pdfCoords', '_lineItems']))\r\n    canvasRedoStack.value.push({ pageNum: entry.pageNum, state: current })\r\n    await canvas.loadFromJSON(JSON.parse(entry.state))\r\n    canvas.renderAll()\r\n  }\r\n  isUndoRedoing = false\r\n}\r\n\r\nasync function handleRedo() {\r\n  if (canvasRedoStack.value.length === 0) return\r\n  isUndoRedoing = true\r\n  const entry = canvasRedoStack.value.pop()\r\n  const canvas = fabric.canvases.value.get(entry.pageNum)\r\n  if (canvas) {\r\n    const current = JSON.stringify(canvas.toJSON(['_annotationType', '_pageNum', '_originalText', '_originalColor', '_originalBounds', '_pdfCoords', '_lineItems']))\r\n    canvasUndoStack.value.push({ pageNum: entry.pageNum, state: current })\r\n    await canvas.loadFromJSON(JSON.parse(entry.state))\r\n    canvas.renderAll()\r\n  }\r\n  isUndoRedoing = false\r\n}\r\n\r\nconst fileSizeStr = computed(() => {\r\n  if (!store.fileSize) return ''\r\n  return humanSize(store.fileSize)\r\n})\r\n\r\nconst toolLabel = computed(() => {\r\n  if (currentTool.value === 'editText') return 'Edit Text'\r\n  return currentTool.value\r\n})\r\n\r\nconst toolHint = computed(() => {\r\n  if (currentTool.value === 'editText') return '— text extracted. Click any line to edit it directly.'\r\n  return '— click on the PDF to add'\r\n})\r\n\r\nconst toolIndicatorClass = computed(() => {\r\n  if (currentTool.value === 'editText') return 'bg-amber-50 border-amber-200 text-amber-800'\r\n  return 'bg-brand-50 border-brand-200 text-brand-700'\r\n})\r\n\r\n// Wire fabric annotation callback to mark dirty + track annotations + save undo state\r\nfabric.setOnAnnotationAdded((pageNum, obj) => {\r\n  saveCanvasState(pageNum)\r\n  store.markDirty()\r\n  annotations.addAnnotation(pageNum, {\r\n    type: obj._annotationType || obj.type,\r\n    text: obj.text || '',\r\n  })\r\n})\r\n\r\nonMounted(() => {\r\n  const fileUrl = route.query.file\r\n  if (fileUrl) {\r\n    loadFromUrl(fileUrl)\r\n  }\r\n\r\n  if (route.query.embed === 'true') {\r\n    const tools = route.query.tools?.split(',')\r\n    store.setEmbedMode(tools)\r\n  }\r\n\r\n  // Pick up file passed from StudioHome\r\n  if (window.__pdfStudioFile) {\r\n    const file = window.__pdfStudioFile\r\n    delete window.__pdfStudioFile\r\n    handleFileOpen([file])\r\n  }\r\n\r\n  document.addEventListener('keydown', handleKeydown)\r\n})\r\n\r\nonUnmounted(() => {\r\n  document.removeEventListener('keydown', handleKeydown)\r\n})\r\n\r\nfunction handleKeydown(e) {\r\n  // Don't intercept keys when editing text in Fabric\r\n  const ae = document.activeElement\r\n  if (ae && (ae.tagName === 'INPUT' || ae.tagName === 'TEXTAREA' || ae.isContentEditable)) return\r\n\r\n  // Delete key removes selected object\r\n  if (e.key === 'Delete' || e.key === 'Backspace') {\r\n    fabric.deleteSelected(pdf.currentPage.value)\r\n    e.preventDefault()\r\n  }\r\n\r\n  if (e.ctrlKey && e.key === 's') {\r\n    e.preventDefault()\r\n    exportPdf('download')\r\n  } else if (e.ctrlKey && e.key === 'z') {\r\n    e.preventDefault()\r\n    handleUndo()\r\n  } else if (e.ctrlKey && e.key === 'y') {\r\n    e.preventDefault()\r\n    handleRedo()\r\n  } else if (e.ctrlKey && e.key === 'f') {\r\n    e.preventDefault()\r\n    showSearch.value = !showSearch.value\r\n  } else if (e.key === 'Escape') {\r\n    handleToolChange('select')\r\n    showExportMenu.value = false\r\n    activeServerTool.value = null\r\n  }\r\n}\r\n\r\nasync function handleToolChange(tool) {\r\n  const previousTool = currentTool.value\r\n\r\n  // If leaving editText mode, commit text edits\r\n  if (previousTool === 'editText' && tool !== 'editText') {\r\n    const pageNum = pdf.currentPage.value\r\n    const fabricCanvas = fabric.canvases.value.get(pageNum)\r\n    const pdfCanvasEl = canvasArea.value?.getPageCanvasEl(pageNum)\r\n    const rerenderFn = () => canvasArea.value?.rerenderPage(pageNum)\r\n    await textEditor.exitTextEditMode(pageNum, fabricCanvas, rerenderFn, pdfCanvasEl)\r\n  }\r\n\r\n  currentTool.value = tool\r\n\r\n  // If entering editText mode, extract and overlay text\r\n  if (tool === 'editText') {\r\n    await activateTextEditMode()\r\n    // Don't change fabric tool — we want select-like behavior for editing\r\n    fabric.setTool('select')\r\n    store.setTool('editText')\r\n  } else {\r\n    fabric.setTool(tool)\r\n    store.setTool(tool)\r\n  }\r\n}\r\n\r\nasync function activateTextEditMode() {\r\n  const pageNum = pdf.currentPage.value\r\n  const fabricCanvas = fabric.canvases.value.get(pageNum)\r\n  const pdfCanvasEl = canvasArea.value?.getPageCanvasEl(pageNum)\r\n\r\n  if (!pdf.pdfDoc.value || !fabricCanvas || !pdfCanvasEl) {\r\n    console.warn('No PDF or canvas available for text editing')\r\n    return\r\n  }\r\n\r\n  const count = await textEditor.enterTextEditMode(\r\n    pdf.pdfDoc.value,\r\n    pageNum,\r\n    fabricCanvas,\r\n    pdfCanvasEl,\r\n    pdf.scale.value\r\n  )\r\n  console.log(`Extracted ${count} text lines for editing on page ${pageNum}`)\r\n  store.markDirty()\r\n}\r\n\r\nfunction handleOptionsUpdate(opts) {\r\n  fabric.updateToolOptions(opts)\r\n  store.updateToolOptions(opts)\r\n\r\n  // Apply to currently selected object if any\r\n  const obj = fabric.activeObject.value\r\n  if (obj) {\r\n    if (opts.color !== undefined) {\r\n      obj.set('fill', opts.color)\r\n    }\r\n    if (opts.fontSize !== undefined) {\r\n      obj.set('fontSize', opts.fontSize)\r\n    }\r\n    if (opts.opacity !== undefined) {\r\n      obj.set('opacity', opts.opacity)\r\n    }\r\n    if (opts.strokeWidth !== undefined) {\r\n      obj.set('strokeWidth', opts.strokeWidth)\r\n    }\r\n    // Re-render the canvas containing the object\r\n    for (const canvas of fabric.canvases.value.values()) {\r\n      if (canvas.getObjects().includes(obj)) {\r\n        canvas.renderAll()\r\n        break\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nasync function handleFileOpen(files) {\r\n  if (!files.length) return\r\n  const file = files[0]\r\n  pdfFile.value = file\r\n  store.setDocument('', file.name, file.size, 0)\r\n\r\n  await pdf.loadPdf(file)\r\n  store.totalPages = pdf.totalPages.value\r\n}\r\n\r\nasync function loadFromUrl(url) {\r\n  store.setDocument(url, url.split('/').pop(), 0, 0)\r\n  await pdf.loadPdf(url)\r\n  store.totalPages = pdf.totalPages.value\r\n}\r\n\r\nfunction goToPage(pageNum) {\r\n  pdf.goToPage(pageNum)\r\n  canvasArea.value?.scrollToPage(pageNum)\r\n}\r\n\r\nasync function exportPdf(mode) {\r\n  showExportMenu.value = false\r\n\r\n  const source = pdfFile.value || store.fileUrl\r\n  if (!source) return\r\n\r\n  const textMods = textEditor.getTextModifications()\r\n  const outputName = store.fileName || 'edited.pdf'\r\n\r\n  // If there are text edits, route through backend (pikepdf content stream removal)\r\n  // so original text is permanently gone — not just overlaid\r\n  if (textMods.length > 0) {\r\n    await exportWithBackend(textMods, outputName, mode)\r\n    return\r\n  }\r\n\r\n  // No text edits — client-side only (annotations, shapes, etc.)\r\n  await exportClientSide(mode, outputName)\r\n}\r\n\r\nasync function exportWithBackend(textMods, outputName, mode) {\r\n  // 1. Upload the original PDF to Frappe for server-side processing\r\n  let fileUrl = store.fileUrl\r\n  if (!fileUrl && pdfFile.value) {\r\n    const uploadResult = await api.uploadFile(pdfFile.value)\r\n    if (!uploadResult.success) {\r\n      alert('Upload failed: ' + (uploadResult.error || 'Unknown error'))\r\n      return\r\n    }\r\n    fileUrl = uploadResult.data.file_url\r\n  }\r\n\r\n  // 2. Send to backend — pikepdf removes original text, reportlab draws replacement\r\n  const result = await api.exportEdited(fileUrl, textMods, outputName)\r\n  if (!result.success) {\r\n    alert('Export failed: ' + (result.error || 'Unknown error'))\r\n    return\r\n  }\r\n\r\n  // 3. If there are also Fabric annotations, apply them client-side on top\r\n  const allAnnots = fabric.getAllAnnotations()\r\n  const hasNonTextAnnots = Object.values(allAnnots).some(objs =>\r\n    objs.some(o => o._annotationType !== 'text-edit')\r\n  )\r\n\r\n  if (hasNonTextAnnots) {\r\n    const pdfDoc = await modifier.loadForEdit(result.data.file_url)\r\n    const pdfAnnotations = []\r\n    for (const [pageNum, objects] of Object.entries(allAnnots)) {\r\n      for (const obj of objects) {\r\n        if (obj._annotationType === 'text-edit') continue\r\n        pdfAnnotations.push({\r\n          page: parseInt(pageNum),\r\n          type: obj._annotationType || obj.type,\r\n          x: obj.left || 0, y: obj.top || 0,\r\n          width: obj.width, height: obj.height,\r\n          text: obj.text,\r\n          color: obj.fill || obj.stroke,\r\n          fontSize: obj.fontSize,\r\n          opacity: obj.opacity,\r\n        })\r\n      }\r\n    }\r\n    await modifier.embedAnnotations(pdfDoc, pdfAnnotations)\r\n    await modifier.downloadPdf(pdfDoc, outputName)\r\n  } else {\r\n    // Trigger download directly from the backend file URL\r\n    const a = document.createElement('a')\r\n    a.href = result.data.file_url\r\n    a.download = outputName\r\n    a.click()\r\n  }\r\n\r\n  store.markSaved()\r\n}\r\n\r\nasync function exportClientSide(mode, outputName) {\r\n  const source = pdfFile.value || store.fileUrl\r\n  const pdfDoc = await modifier.loadForEdit(source)\r\n\r\n  const allAnnots = fabric.getAllAnnotations()\r\n  const pdfAnnotations = []\r\n  for (const [pageNum, objects] of Object.entries(allAnnots)) {\r\n    for (const obj of objects) {\r\n      if (obj._annotationType === 'text-edit') continue\r\n      pdfAnnotations.push({\r\n        page: parseInt(pageNum),\r\n        type: obj._annotationType || obj.type,\r\n        x: obj.left || 0, y: obj.top || 0,\r\n        width: obj.width, height: obj.height,\r\n        text: obj.text,\r\n        color: obj.fill || obj.stroke,\r\n        fontSize: obj.fontSize,\r\n        opacity: obj.opacity,\r\n      })\r\n    }\r\n  }\r\n\r\n  if (pdfAnnotations.length > 0) {\r\n    await modifier.embedAnnotations(pdfDoc, pdfAnnotations)\r\n  }\r\n\r\n  if (mode === 'download' || mode === 'flatten') {\r\n    await modifier.downloadPdf(pdfDoc, outputName)\r\n  } else if (mode === 'save') {\r\n    const blob = await modifier.exportAsBlob(pdfDoc)\r\n    if (blob) {\r\n      const file = new File([blob], outputName, { type: 'application/pdf' })\r\n      const result = await api.uploadFile(file)\r\n      if (result.success) {\r\n        store.markSaved(result.data.name)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nfunction handleServerTool(toolId) {\r\n  // Open inline dialog instead of new tab\r\n  activeServerTool.value = toolId\r\n}\r\n\r\nfunction handleServerToolDone(result) {\r\n  activeServerTool.value = null\r\n  if (result?.reload) {\r\n    // Reload the PDF if the operation modified it\r\n    if (pdfFile.value) {\r\n      handleFileOpen([pdfFile.value])\r\n    }\r\n  }\r\n}\r\n\r\n\r\nfunction humanSize(bytes) {\r\n  for (const unit of ['B', 'KB', 'MB', 'GB']) {\r\n    if (bytes < 1024) return `${bytes.toFixed(1)} ${unit}`\r\n    bytes /= 1024\r\n  }\r\n  return `${bytes.toFixed(1)} TB`\r\n}\r\n</script>\r\n","<template>\r\n  <PdfEditor :embedded=\"isEmbedded\" />\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, onMounted } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport PdfEditor from '@/components/editor/PdfEditor.vue'\r\n\r\nconst route = useRoute()\r\nconst isEmbedded = computed(() => route.query.embed === 'true')\r\n\r\nonMounted(() => {\r\n  // Pick up file passed from StudioHome\r\n  if (window.__pdfStudioFile) {\r\n    // PdfEditor will handle file loading via its drop zone or we trigger it\r\n    const file = window.__pdfStudioFile\r\n    delete window.__pdfStudioFile\r\n\r\n    // Dispatch a custom event that PdfEditor can listen to\r\n    setTimeout(() => {\r\n      window.dispatchEvent(new CustomEvent('pdf-studio-open-file', { detail: file }))\r\n    }, 100)\r\n  }\r\n})\r\n</script>\r\n"],"names":["useEditorStore","defineStore","fileUrl","ref","fileName","fileSize","totalPages","currentPage","scale","sidebarTab","showSidebar","showProperties","activeTool","toolOptions","isDirty","sessionName","lastSaved","isEmbedded","allowedTools","zoomPercent","computed","setDocument","url","name","size","pages","setTool","tool","updateToolOptions","opts","__spreadValues","markDirty","markSaved","setEmbedMode","tools","reset","pdfjsLib.GlobalWorkerOptions","usePdfRenderer","pdfDoc","shallowRef","loading","error","pageRendering","loadPdf","source","__async","loadingTask","pdfjsLib.getDocument","arrayBuffer","pdf","e","renderPage","pageNum","canvas","page","viewport","renderContext","renderThumbnail","thumbScale","ctx","getPageText","item","zoomIn","zoomOut","zoomFit","setZoom","newScale","goToPage","nextPage","prevPage","destroy","onUnmounted","useFabricCanvas","canvases","activeObject","onAnnotationAdded","setOnAnnotationAdded","cb","initCanvas","canvasEl","width","height","destroyCanvas","fabricCanvas","Canvas","_a","opt","pointer","handleToolClick","newMap","y","obj","Textbox","Rect","noteRect","noteText","pickImage","dataUrl","addImageToCanvas","resolve","input","file","reader","ev","img","FabricImage","maxDim","deleteSelected","c","active","getAllAnnotations","annotations","objects","loadAnnotations","destroyAll","usePdfModifier","exporting","exportError","loadForEdit","PDFDocument","bytes","embedAnnotations","font","StandardFonts","annot","pageIndex","pageHeight","parseColor","_b","_c","image","base64","_d","_e","applyPageModifications","modifications","mod","exportPdf","exportAsBlob","downloadPdf","filename","blob","a","hex","r","g","b","rgb","useAnnotations","selectedAnnotation","annotationCount","sum","annotationList","list","annots","__spreadProps","addAnnotation","annotation","generateId","removeAnnotation","annotationId","updateAnnotation","updates","idx","clearPage","clearAll","selectAnnotation","usePdfTextEditor","isEditingText","editedPages","activeEditPage","extractTextWithPositions","textContent","items","tx","ty","pdfFontSize","vx","vy","fontSize","topY","groupIntoBlocks","sorted","dy","blocks","currentBlock","i","last","gap","avgFontSize","block","sortedBlock","text","first","maxFontSize","minY","maxHeight","sampleColor","x","sx","sy","sw","data","dR","dG","dB","dL","lum","whiteOut","pad","enterTextEditMode","pdfCanvasEl","colors","pageEdits","color","textObj","editEntry","exitTextEditMode","rerenderPageFn","toRemove","toKeep","edit","getTextModifications","mods","edits","hasTextModifications","props","__props","iconComponent","icons","icons.Circle","_createElementBlock","$emit","_normalizeClass","_openBlock","_createBlock","_resolveDynamicComponent","emit","__emit","serverTools","Merge","Split","Minimize2","ScanLine","FileOutput","Droplets","Shield","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","ToolButton","_hoisted_3","_Fragment","_renderList","$event","_hoisted_5","_toDisplayString","pdfCanvas","render","result","onMounted","watch","__expose","canvasContainer","pageRefs","setPageRef","el","onScroll","container","containerTop","containerHeight","pageTop","pageBottom","scrollToPage","getPageCanvasEl","comp","rerenderPage","onPageRendered","PdfPageCanvas","_unref","FileText","_cache","activeTab","thumbnailRefs","reactive","tabs","LayoutGrid","List","tab","_hoisted_4","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_9","ZoomOut","ZoomIn","Maximize2","searchInput","query","results","current","total","v","nextTick","q","matches","findNext","findPrev","Search","ChevronUp","ChevronDown","X","hasFile","processing","statusMessage","statusError","splitMode","splitRanges","splitN","extractPages","compressQuality","mergeFiles","watermarkText","watermarkOpacity","watermarkColor","protectUserPw","protectOwnerPw","toolConfigs","toolConfig","pickMergeFiles","handleMergeDrop","handleApply","handleSplit","handleCompress","handleMerge","handleWatermark","handleProtect","loadCurrentPdf","downloadBlob","srcDoc","pageSets","ranges","range","parts","n","j","p","newDoc","copiedPages","mainDoc","otherDoc","resultBytes","degrees","_hoisted_15","FilePlus","_hoisted_16","_hoisted_17","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","Loader2","_createTextVNode","route","useRoute","store","fabric","modifier","api","usePdfApi","textEditor","canvasArea","showSearch","showExportMenu","pdfFile","activeServerTool","currentTool","canvasUndoStack","canvasRedoStack","isUndoRedoing","saveCanvasState","state","handleUndo","entry","handleRedo","fileSizeStr","humanSize","toolLabel","toolHint","toolIndicatorClass","loadFromUrl","handleFileOpen","handleKeydown","ae","handleToolChange","rerenderFn","activateTextEditMode","count","handleOptionsUpdate","files","mode","textMods","outputName","exportWithBackend","exportClientSide","uploadResult","allAnnots","objs","o","pdfAnnotations","handleServerTool","toolId","handleServerToolDone","unit","_component_router_link","Undo2","Redo2","PanelLeft","PanelRight","Save","Download","PdfToolbar","PdfSearchBar","PdfSidebar","PdfCanvas","PdfPropertiesPanel","PdfStatusBar","FileDropZone","ServerToolPanel","PdfEditor"],"mappings":"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"}