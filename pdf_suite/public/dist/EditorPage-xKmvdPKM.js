var He=Object.defineProperty,qe=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var Ae=(e,p,t)=>p in e?He(e,p,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[p]=t,se=(e,p)=>{for(var t in p||(p={}))Ye.call(p,t)&&Ae(e,t,p[t]);if(Fe)for(var t of Fe(p))Je.call(p,t)&&Ae(e,t,p[t]);return e},De=(e,p)=>qe(e,Xe(p));var j=(e,p,t)=>new Promise((a,k)=>{var b=y=>{try{f(t.next(y))}catch(M){k(M)}},h=y=>{try{f(t.throw(y))}catch(M){k(M)}},f=y=>y.done?a(y.value):Promise.resolve(y.value).then(b,h);f((t=t.apply(e,p)).next())});import{B as Ke,z as T,e as Z,C as Ce,D as Te,o as C,c as D,n as G,q as ge,p as ce,E as Ze,G as Ge,b as o,a as I,F as K,r as re,t as V,M as ze,S as Ee,v as _e,y as ke,x as Pe,H as Ie,I as je,s as $e,J as he,g as $,h as ve,d as N,K as Qe,N as et,O as tt,Z as ot,P as nt,Q as at,R as lt,T as Be,U as te,V as ae,W as Oe,X as st,Y as Ne,_ as Se,$ as Me,a0 as xe,a1 as it,i as de,a2 as rt,u as Ue,f as dt,w as ut,a3 as ct,a4 as ft,a5 as pt,a6 as gt,a7 as vt,a8 as mt}from"./vue-vendor-Cf1u-26_.js";import{_ as yt,a as we}from"./pdf-js-Ci2W4ooy.js";import{X as bt,U as be,j as me,o as ht}from"./fabric-cjQCy6PH.js";import{S as Re,P as ue,r as Le,d as xt}from"./pdf-lib-kckEV9H8.js";import{u as wt}from"./usePdfApi-BXiAzpXu.js";import{_ as kt}from"./FileDropZone-BNRVS-bJ.js";const Pt=Ke("editor",()=>{const e=T(""),p=T(""),t=T(0),a=T(0),k=T(1),b=T(1),h=T("thumbnails"),f=T(!0),y=T(!1),M=T("select"),z=T({color:"#000000",fontSize:16,fontFamily:"Helvetica",strokeWidth:2,opacity:1,highlightColor:"#ffff00"}),S=T(!1),s=T(null),r=T(null),m=T(!1),F=T(null),g=Z(()=>Math.round(b.value*100));function n(d,B,U,oe){e.value=d,p.value=B,t.value=U,a.value=oe,k.value=1,S.value=!1,s.value=null,r.value=null}function l(d){M.value=d}function P(d){z.value=se(se({},z.value),d)}function x(){S.value=!0}function v(d){S.value=!1,s.value=d,r.value=new Date().toISOString()}function w(d=null){m.value=!0,F.value=d}function A(){e.value="",p.value="",t.value=0,a.value=0,k.value=1,b.value=1,M.value="select",S.value=!1,s.value=null,r.value=null}return{fileUrl:e,fileName:p,fileSize:t,totalPages:a,currentPage:k,scale:b,zoomPercent:g,sidebarTab:h,showSidebar:f,showProperties:y,activeTool:M,toolOptions:z,isDirty:S,sessionName:s,lastSaved:r,isEmbedded:m,allowedTools:F,setDocument:n,setTool:l,updateToolOptions:P,markDirty:x,markSaved:v,setEmbedMode:w,reset:A}});yt.workerSrc=new URL("/assets/pdf_suite/dist/pdf.worker.min-yatZIOMy.mjs",import.meta.url).toString();function St(){const e=Te(null),p=T(0),t=T(1),a=T(1),k=T(!1),b=T(""),h=T(!1),f=T(""),y=Z(()=>Math.round(a.value*100));function M(v){return j(this,null,function*(){k.value=!0,b.value="";try{let w;if(v instanceof ArrayBuffer||v instanceof Uint8Array)w=we({data:v});else if(v instanceof File){f.value=v.name;const d=yield v.arrayBuffer();w=we({data:d})}else if(typeof v=="string")f.value=v.split("/").pop(),w=we(v);else throw new Error("Invalid PDF source");const A=yield w.promise;e.value=A,p.value=A.numPages,t.value=1}catch(w){b.value=w.message||"Failed to load PDF",e.value=null,p.value=0}finally{k.value=!1}})}function z(v,w){return j(this,null,function*(){if(!e.value||v<1||v>p.value)return null;h.value=!0;try{const A=yield e.value.getPage(v),d=A.getViewport({scale:a.value});w.width=d.width,w.height=d.height;const U={canvasContext:w.getContext("2d"),viewport:d};return yield A.render(U).promise,{width:d.width,height:d.height,originalWidth:d.viewBox[2],originalHeight:d.viewBox[3]}}catch(A){return console.error(`Error rendering page ${v}:`,A),null}finally{h.value=!1}})}function S(v,w,A=.2){return j(this,null,function*(){if(!(!e.value||v<1||v>p.value))try{const d=yield e.value.getPage(v),B=d.getViewport({scale:A});w.width=B.width,w.height=B.height;const U=w.getContext("2d");yield d.render({canvasContext:U,viewport:B}).promise}catch(d){console.error(`Error rendering thumbnail ${v}:`,d)}})}function s(v){return j(this,null,function*(){return e.value?(yield(yield e.value.getPage(v)).getTextContent()).items.map(d=>d.str).join(" "):""})}function r(){a.value=Math.min(a.value+.25,5)}function m(){a.value=Math.max(a.value-.25,.25)}function F(){a.value=1}function g(v){a.value=Math.max(.25,Math.min(5,v))}function n(v){t.value=Math.max(1,Math.min(v,p.value))}function l(){n(t.value+1)}function P(){n(t.value-1)}function x(){e.value&&(e.value.destroy(),e.value=null)}return Ce(x),{pdfDoc:e,totalPages:p,currentPage:t,scale:a,zoomPercent:y,loading:k,error:b,pageRendering:h,fileName:f,loadPdf:M,renderPage:z,renderThumbnail:S,getPageText:s,zoomIn:r,zoomOut:m,zoomFit:F,setZoom:g,goToPage:n,nextPage:l,prevPage:P,destroy:x}}function Ct(){const e=Te(new Map),p=T(null),t=T("select"),a=T({color:"#000000",fontSize:16,strokeWidth:2,opacity:1,highlightColor:"#ffff00"});let k=null;function b(n){k=n}function h(n,l,P,x){F(n);try{const v=new bt(l,{width:P,height:x,selection:t.value==="select",isDrawingMode:!1});v.on("selection:created",A=>{var d;p.value=((d=A.selected)==null?void 0:d[0])||null}),v.on("selection:updated",A=>{var d;p.value=((d=A.selected)==null?void 0:d[0])||null}),v.on("selection:cleared",()=>{p.value=null}),v.on("mouse:down",A=>{if(t.value==="select")return;if(t.value==="eraser"&&A.target){v.remove(A.target),v.renderAll(),p.value=null;return}if(A.target)return;const d=v.getScenePoint?v.getScenePoint(A.e):v.getPointer(A.e);f(n,v,d)});const w=new Map(e.value);return w.set(n,v),e.value=w,v}catch(v){return console.error(`[FabricCanvas] FAILED page ${n}:`,v),null}}function f(n,l,P){const x=P.x,v=P.y;let w=null;switch(t.value){case"text":w=new be("Type here...",{left:x,top:v,width:200,fontSize:a.value.fontSize||16,fill:a.value.color||"#000000",fontFamily:"Helvetica",editable:!0,_annotationType:"text",_pageNum:n}),l.add(w),l.setActiveObject(w),w.enterEditing(),w.selectAll();break;case"highlight":w=new me({left:x,top:v,width:200,height:22,fill:a.value.highlightColor||"#ffff00",opacity:.35,selectable:!0,_annotationType:"highlight",_pageNum:n}),l.add(w),l.setActiveObject(w);break;case"whiteout":w=new me({left:x,top:v,width:200,height:28,fill:"#ffffff",opacity:1,selectable:!0,stroke:"#e0e0e0",strokeWidth:.5,_annotationType:"whiteout",_pageNum:n}),l.add(w),l.setActiveObject(w);break;case"shape":w=new me({left:x,top:v,width:150,height:100,fill:"transparent",stroke:a.value.color||"#000000",strokeWidth:a.value.strokeWidth||2,selectable:!0,_annotationType:"rectangle",_pageNum:n}),l.add(w),l.setActiveObject(w);break;case"note":const A=new me({left:x,top:v,width:160,height:100,fill:"#FFF9C4",stroke:"#F9A825",strokeWidth:1,rx:4,ry:4,shadow:{color:"rgba(0,0,0,0.15)",blur:6,offsetX:2,offsetY:2},selectable:!0,_annotationType:"note-bg",_pageNum:n}),d=new be("Note...",{left:x+8,top:v+8,width:144,fontSize:12,fill:"#333333",fontFamily:"Helvetica",editable:!0,_annotationType:"note-text",_pageNum:n});l.add(A),l.add(d),l.setActiveObject(d),d.enterEditing(),w=d;break;case"signature":w=new be("Signature",{left:x,top:v,width:180,fontSize:28,fill:"#1a237e",fontFamily:"cursive",fontStyle:"italic",editable:!0,_annotationType:"signature",_pageNum:n}),l.add(w),l.setActiveObject(w),w.enterEditing(),w.selectAll();break;case"image":y().then(B=>{B&&M(n,l,B,x,v)});return;case"draw":l.isDrawingMode=!0,l.freeDrawingBrush&&(l.freeDrawingBrush.color=a.value.color||"#000000",l.freeDrawingBrush.width=a.value.strokeWidth||3);return;case"eraser":return}w&&(l.renderAll(),k&&k(n,w))}function y(){return new Promise(n=>{const l=document.createElement("input");l.type="file",l.accept="image/*",l.onchange=P=>{const x=P.target.files[0];if(!x){n(null);return}const v=new FileReader;v.onload=w=>n(w.target.result),v.readAsDataURL(x)},l.click()})}function M(n,l,P,x,v){return j(this,null,function*(){try{const w=yield ht.fromURL(P),A=300,d=Math.min(A/w.width,A/w.height,1);w.set({left:x,top:v,scaleX:d,scaleY:d,_annotationType:"image",_pageNum:n}),l.add(w),l.setActiveObject(w),l.renderAll(),k&&k(n,w)}catch(w){console.error("Failed to add image:",w)}})}function z(n){t.value=n;for(const l of e.value.values())l.isDrawingMode=n==="draw",n==="draw"&&l.freeDrawingBrush&&(l.freeDrawingBrush.color=a.value.color||"#000000",l.freeDrawingBrush.width=a.value.strokeWidth||3),l.selection=n==="select",n==="text"||n==="note"||n==="signature"?(l.defaultCursor="text",l.hoverCursor="text"):n==="draw"?(l.defaultCursor="crosshair",l.hoverCursor="crosshair"):n==="eraser"?(l.defaultCursor="not-allowed",l.hoverCursor="pointer"):n==="select"?(l.defaultCursor="default",l.hoverCursor="move"):(l.defaultCursor="crosshair",l.hoverCursor="crosshair")}function S(n){a.value=se(se({},a.value),n)}function s(n){const l=e.value.get(n);if(!l){for(const x of e.value.values()){const v=x.getActiveObject();if(v){x.remove(v),x.renderAll(),p.value=null;return}}return}const P=l.getActiveObject();P&&(l.remove(P),l.renderAll(),p.value=null)}function r(){const n={};for(const[l,P]of e.value.entries()){const x=P.toJSON(["_annotationType","_pageNum"]).objects;x.length>0&&(n[l]=x)}return n}function m(n){return j(this,null,function*(){for(const[l,P]of Object.entries(n)){const x=e.value.get(parseInt(l));x&&P.length>0&&(yield x.loadFromJSON({objects:P,version:"6.0.0"}),x.renderAll())}})}function F(n){const l=e.value.get(n);if(l){l.dispose();const P=new Map(e.value);P.delete(n),e.value=P}}function g(){for(const n of e.value.values())n.dispose();e.value=new Map}return Ce(g),{canvases:e,activeObject:p,activeTool:t,toolOptions:a,initCanvas:h,setTool:z,updateToolOptions:S,deleteSelected:s,getAllAnnotations:r,loadAnnotations:m,setOnAnnotationAdded:b,destroyCanvas:F,destroyAll:g}}function Tt(){const e=T(!1),p=T("");function t(y){return j(this,null,function*(){if(y instanceof ArrayBuffer||y instanceof Uint8Array)return yield ue.load(y);if(y instanceof File){const M=yield y.arrayBuffer();return yield ue.load(M)}if(typeof y=="string"){const z=yield(yield fetch(y,{credentials:"include"})).arrayBuffer();return yield ue.load(z)}throw new Error("Invalid source for PDF editing")})}function a(y,M){return j(this,null,function*(){var S,s,r,m,F;const z=yield y.embedFont(Re.Helvetica);for(const g of M){const n=(g.page||1)-1;if(n>=y.getPageCount())continue;const l=y.getPage(n),{height:P}=l.getSize();switch(g.type){case"text":l.drawText(g.text||"",{x:g.x||0,y:P-(g.y||0)-(g.fontSize||14),size:g.fontSize||14,font:z,color:ye(g.color||"#000000"),opacity:(S=g.opacity)!=null?S:1});break;case"rectangle":case"whiteout":l.drawRectangle({x:g.x||0,y:P-(g.y||0)-(g.height||20),width:g.width||100,height:g.height||20,color:ye(g.color||(g.type==="whiteout"?"#ffffff":"#000000")),opacity:(s=g.opacity)!=null?s:1,borderWidth:g.borderWidth||0});break;case"highlight":l.drawRectangle({x:g.x||0,y:P-(g.y||0)-(g.height||14),width:g.width||100,height:g.height||14,color:ye(g.color||"#ffff00"),opacity:(r=g.opacity)!=null?r:.3});break;case"image":if(g.imageData)try{let x;if(g.imageData.startsWith("data:image/png")){const v=g.imageData.split(",")[1];x=yield y.embedPng(Uint8Array.from(atob(v),w=>w.charCodeAt(0)))}else{const v=g.imageData.split(",")[1];x=yield y.embedJpg(Uint8Array.from(atob(v),w=>w.charCodeAt(0)))}l.drawImage(x,{x:g.x||0,y:P-(g.y||0)-(g.height||100),width:g.width||100,height:g.height||100,opacity:(m=g.opacity)!=null?m:1})}catch(x){console.error("Failed to embed image annotation:",x)}break;case"line":l.drawLine({start:{x:g.x||0,y:P-(g.y||0)},end:{x:g.x2||100,y:P-(g.y2||0)},thickness:g.strokeWidth||2,color:ye(g.color||"#000000"),opacity:(F=g.opacity)!=null?F:1});break}}})}function k(y,M){return j(this,null,function*(){for(const z of M)switch(z.type){case"rotate":if(z.pageIndex<y.getPageCount()){const S=y.getPage(z.pageIndex);S.setRotation(S.getRotation().angle+(z.angle||90))}break;case"delete":z.pageIndex<y.getPageCount()&&y.removePage(z.pageIndex);break}})}function b(y){return j(this,null,function*(){e.value=!0,p.value="";try{return yield y.save()}catch(M){return p.value=M.message,null}finally{e.value=!1}})}function h(y){return j(this,null,function*(){const M=yield b(y);return M?new Blob([M],{type:"application/pdf"}):null})}function f(y,M="edited.pdf"){return j(this,null,function*(){const z=yield h(y);if(!z)return;const S=URL.createObjectURL(z),s=document.createElement("a");s.href=S,s.download=M,s.click(),URL.revokeObjectURL(S)})}return{exporting:e,exportError:p,loadForEdit:t,embedAnnotations:a,applyPageModifications:k,exportPdf:b,exportAsBlob:h,downloadPdf:f}}function ye(e){e=e.replace("#","");const p=parseInt(e.substring(0,2),16)/255,t=parseInt(e.substring(2,4),16)/255,a=parseInt(e.substring(4,6),16)/255;return Le(p,t,a)}function $t(){const e=T({}),p=T(null),t=Z(()=>Object.values(e.value).reduce((S,s)=>S+s.length,0)),a=Z(()=>{const S=[];for(const[s,r]of Object.entries(e.value))for(const m of r)S.push(De(se({},m),{page:parseInt(s)}));return S.sort((s,r)=>s.page-r.page)});function k(S,s){return e.value[S]||(e.value[S]=[]),s.id=s.id||z(),e.value[S].push(s),s}function b(S,s){e.value[S]&&(e.value[S]=e.value[S].filter(r=>r.id!==s),e.value[S].length===0&&delete e.value[S])}function h(S,s,r){if(!e.value[S])return;const m=e.value[S].findIndex(F=>F.id===s);m>=0&&(e.value[S][m]=se(se({},e.value[S][m]),r))}function f(S){delete e.value[S]}function y(){e.value={},p.value=null}function M(S){p.value=S}function z(){return`annot_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}return{annotations:e,selectedAnnotation:p,annotationCount:t,annotationList:a,addAnnotation:k,removeAnnotation:b,updateAnnotation:h,clearPage:f,clearAll:y,selectAnnotation:M}}function Ft(){const e=T(!1),p=Te(new Map),t=T(null);function a(s,r,m){return j(this,null,function*(){const F=yield s.getPage(r),g=F.getViewport({scale:m}),n=yield F.getTextContent(),l=[];for(const P of n.items){if(!P.str||!P.str.trim())continue;const x=P.transform[4],v=P.transform[5],w=Math.abs(P.transform[3]),[A,d]=g.convertToViewportPoint(x,v),B=P.width*m,U=P.height*m,oe=w*m,fe=d-U;l.push({str:P.str,x:A,y:fe,width:B,height:U,fontSize:oe,fontFamily:P.fontName||"sans-serif",fontWeight:"normal",fontStyle:"normal",pdfX:x,pdfY:v,pdfFontSize:w})}return l})}function k(s){if(s.length===0)return[];const r=[...s].sort((g,n)=>{const l=g.y-n.y;return Math.abs(l)<5?g.x-n.x:l}),m=[];let F=[r[0]];for(let g=1;g<r.length;g++){const n=r[g],l=F[F.length-1];if(Math.abs(n.y-l.y)<5){const x=n.x-(l.x+l.width),v=(n.fontSize+l.fontSize)/2;x<=v*1.2&&x>=-2?F.push(n):(m.push(F),F=[n])}else m.push(F),F=[n]}return m.push(F),m.map(g=>{const n=g.sort((d,B)=>d.x-B.x),l=n.map(d=>d.str).join(" "),P=n[0],x=n[n.length-1],v=Math.max(...n.map(d=>d.fontSize)),w=Math.min(...n.map(d=>d.y)),A=Math.max(...n.map(d=>d.height));return{text:l,x:P.x,y:w,width:x.x+x.width-P.x,height:A,fontSize:v,fontFamily:P.fontFamily,fontWeight:P.fontWeight,fontStyle:P.fontStyle,items:n,pdfX:P.pdfX,pdfY:P.pdfY,pdfFontSize:Math.max(...n.map(d=>d.pdfFontSize))}})}function b(s,r,m,F,g){try{const n=Math.max(0,Math.floor(r+2)),l=Math.max(0,Math.floor(m+g*.5)),P=Math.max(Math.min(Math.floor(F*.3),20),1),x=s.getImageData(n,l,P,1).data;let v=255,w=255,A=255,d=999;for(let B=0;B<x.length;B+=4){const U=.299*x[B]+.587*x[B+1]+.114*x[B+2];U<d&&(d=U,v=x[B],w=x[B+1],A=x[B+2])}return d>200?"#000000":"#"+[v,w,A].map(B=>B.toString(16).padStart(2,"0")).join("")}catch(n){return"#000000"}}function h(s,r,m=2){s.fillStyle="#ffffff";for(const F of r)s.fillRect(Math.floor(F.x)-m,Math.floor(F.y)-m,Math.ceil(F.width)+m*2+2,Math.ceil(F.height)+m*2+2)}function f(s,r,m,F,g){return j(this,null,function*(){if(!s||!m||!F||e.value&&t.value===r)return 0;e.value=!0,t.value=r;const n=yield a(s,r,g);if(n.length===0)return 0;const l=k(n),P=F.getContext("2d"),x=l.map(A=>b(P,A.x,A.y,A.width,A.height));h(P,l);const v=[];for(let A=0;A<l.length;A++){const d=l[A],B=x[A],U=new be(d.text,{left:d.x,top:d.y,width:Math.max(d.width+6,30),fontSize:d.fontSize,fontFamily:d.fontFamily||"Helvetica, Arial, sans-serif",fontWeight:d.fontWeight||"normal",fontStyle:d.fontStyle||"normal",fill:B,editable:!0,backgroundColor:"transparent",borderColor:"transparent",cornerColor:"#4A90D9",cornerSize:5,transparentCorners:!1,padding:1,splitByGrapheme:!1,hasBorders:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,_annotationType:"text-edit",_pageNum:r,_originalText:d.text,_originalColor:B,_originalBounds:{x:d.x,y:d.y,width:d.width,height:d.height}});U.on("mouseover",()=>{m.getActiveObject()!==U&&(U.set({hasBorders:!0,borderColor:"rgba(74, 144, 217, 0.4)",borderDashArray:[4,3]}),m.renderAll())}),U.on("mouseout",()=>{m.getActiveObject()!==U&&(U.set({hasBorders:!1,borderColor:"transparent",borderDashArray:null}),m.renderAll())}),U.on("selected",()=>{U.set({hasBorders:!0,hasControls:!0,borderColor:"#4A90D9",borderDashArray:null,lockMovementX:!1,lockMovementY:!1}),m.renderAll()}),U.on("deselected",()=>{U.set({hasBorders:!1,hasControls:!1,borderColor:"transparent",lockMovementX:!0,lockMovementY:!0}),m.renderAll()}),m.add(U);const oe={original:d.text,modified:d.text,fabricObj:U,color:B,bounds:{x:d.x,y:d.y,width:d.width,height:d.height},pdfX:d.pdfX,pdfY:d.pdfY,pdfFontSize:d.pdfFontSize,scale:g};U.on("changed",()=>{oe.modified=U.text}),v.push(oe)}const w=new Map(p.value);return w.set(r,v),p.value=w,m.renderAll(),v.length})}function y(s,r,m,F){return j(this,null,function*(){if(e.value=!1,t.value=null,!r)return;const g=p.value.get(s);if(!g)return;const n=[],l=[];for(const x of g)x.modified=x.fabricObj.text,x.original===x.modified?n.push(x.fabricObj):l.push(x);for(const x of n)r.remove(x);if(m&&(yield m(),yield new Promise(x=>setTimeout(x,150))),l.length>0&&F){const x=F.getContext("2d");h(x,l.map(v=>v.bounds),3)}const P=new Map(p.value);l.length>0?P.set(s,l):P.delete(s),p.value=P,r.renderAll()})}function M(){var r,m;const s=[];for(const[F,g]of p.value.entries())for(const n of g){const l=((r=n.fabricObj)==null?void 0:r.text)||n.modified;n.original!==l&&s.push({page:F,original:n.original,modified:l,bounds:n.bounds,color:n.color,fontSize:((m=n.fabricObj)==null?void 0:m.fontSize)||12,pdf_x:n.pdfX,pdf_y:n.pdfY,pdf_font_size:n.pdfFontSize,scale:n.scale})}return s}function z(){var s;for(const r of p.value.values())for(const m of r)if(m.original!==(((s=m.fabricObj)==null?void 0:s.text)||m.modified))return!0;return!1}function S(){p.value=new Map,e.value=!1,t.value=null}return{isEditingText:e,editedPages:p,activeEditPage:t,enterTextEditMode:f,exitTextEditMode:y,getTextModifications:M,hasTextModifications:z,clearAll:S}}const At=["title"],ee={__name:"ToolButton",props:{icon:{type:String,required:!0},label:{type:String,default:""},tool:{type:String,default:""},active:{type:String,default:""}},emits:["click"],setup(e){const p=e,t=Z(()=>Ze[p.icon]||Ge);return(a,k)=>(C(),D("button",{onClick:k[0]||(k[0]=b=>a.$emit("click")),class:ce(["p-2 rounded-md transition-colors",e.active===e.tool?"bg-brand-100 text-brand-700":"text-gray-600 hover:bg-gray-100"]),title:e.label},[(C(),G(ge(t.value),{class:"w-4 h-4"}))],10,At))}},Dt={class:"bg-white border-b border-gray-200 px-4 py-2 flex items-center gap-1 overflow-x-auto"},Ot={class:"flex items-center gap-1 pr-3 border-r border-gray-200"},Mt={class:"flex items-center gap-1 pl-3"},zt=["onClick","title"],Et={class:"hidden lg:inline"},_t={__name:"PdfToolbar",props:{activeTool:{type:String,default:"select"}},emits:["update:activeTool","server-tool"],setup(e,{emit:p}){const t=p;function a(b){t("update:activeTool",b)}const k=[{id:"merge",label:"Merge",icon:ze},{id:"split",label:"Split",icon:Ee},{id:"compress",label:"Compress",icon:_e},{id:"ocr",label:"OCR",icon:ke},{id:"convert",label:"Convert",icon:Pe},{id:"watermark",label:"Watermark",icon:Ie},{id:"protect",label:"Protect",icon:je}];return(b,h)=>(C(),D("div",Dt,[o("div",Ot,[I(ee,{icon:"MousePointer2",label:"Select",tool:"select",active:e.activeTool,onClick:h[0]||(h[0]=f=>a("select"))},null,8,["active"]),I(ee,{icon:"TextCursorInput",label:"Edit Text",tool:"editText",active:e.activeTool,onClick:h[1]||(h[1]=f=>a("editText"))},null,8,["active"]),I(ee,{icon:"Type",label:"Add Text",tool:"text",active:e.activeTool,onClick:h[2]||(h[2]=f=>a("text"))},null,8,["active"]),I(ee,{icon:"Image",label:"Image",tool:"image",active:e.activeTool,onClick:h[3]||(h[3]=f=>a("image"))},null,8,["active"]),I(ee,{icon:"PenTool",label:"Sign",tool:"signature",active:e.activeTool,onClick:h[4]||(h[4]=f=>a("signature"))},null,8,["active"]),I(ee,{icon:"Highlighter",label:"Highlight",tool:"highlight",active:e.activeTool,onClick:h[5]||(h[5]=f=>a("highlight"))},null,8,["active"]),I(ee,{icon:"Pencil",label:"Draw",tool:"draw",active:e.activeTool,onClick:h[6]||(h[6]=f=>a("draw"))},null,8,["active"]),I(ee,{icon:"Square",label:"Shape",tool:"shape",active:e.activeTool,onClick:h[7]||(h[7]=f=>a("shape"))},null,8,["active"]),I(ee,{icon:"StickyNote",label:"Note",tool:"note",active:e.activeTool,onClick:h[8]||(h[8]=f=>a("note"))},null,8,["active"]),I(ee,{icon:"RectangleHorizontal",label:"White Out",tool:"whiteout",active:e.activeTool,onClick:h[9]||(h[9]=f=>a("whiteout"))},null,8,["active"]),I(ee,{icon:"Eraser",label:"Eraser",tool:"eraser",active:e.activeTool,onClick:h[10]||(h[10]=f=>a("eraser"))},null,8,["active"])]),o("div",Mt,[(C(),D(K,null,re(k,f=>o("button",{key:f.id,onClick:y=>b.$emit("server-tool",f.id),class:"flex items-center gap-1 px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded-md transition-colors",title:f.label},[(C(),G(ge(f.icon),{class:"w-4 h-4"})),o("span",Et,V(f.label),1)],8,zt)),64))])]))}},It=["data-page"],jt={__name:"PdfPageCanvas",props:{pageNum:{type:Number,required:!0},renderPage:{type:Function,required:!0},initFabricCanvas:{type:Function,default:null},scale:{type:Number,default:1}},emits:["page-rendered","page-visible"],setup(e,{expose:p,emit:t}){const a=e,k=t,b=T(null),h=T(null);function f(){return j(this,null,function*(){if(!b.value)return;const y=yield a.renderPage(a.pageNum,b.value);y&&(a.initFabricCanvas&&h.value&&a.initFabricCanvas(a.pageNum,h.value,y.width,y.height),k("page-rendered",{pageNum:a.pageNum,width:y.width,height:y.height}))})}return $e(f),he(()=>a.scale,f),p({pdfCanvas:b,rerender:f}),(y,M)=>(C(),D("div",{class:"pdf-page-wrapper relative inline-block mb-4 shadow-lg bg-white","data-page":e.pageNum},[o("canvas",{ref_key:"pdfCanvas",ref:b,class:"block"},null,512),o("canvas",{ref_key:"fabricCanvas",ref:h,class:"fabric-overlay absolute top-0 left-0"},null,512)],8,It))}},Bt={key:0,class:"text-center py-20"},Nt={key:1,class:"text-center py-20"},Ut={__name:"PdfCanvas",props:{totalPages:{type:Number,default:0},renderPage:{type:Function,required:!0},initFabricCanvas:{type:Function,default:null},scale:{type:Number,default:1},loading:{type:Boolean,default:!1}},emits:["page-changed","page-rendered"],setup(e,{expose:p,emit:t}){const a=t,k=T(null),b=new Map;function h(s,r){r?b.set(s,r):b.delete(s)}function f(){if(!k.value)return;const s=k.value,r=s.querySelectorAll(".pdf-page-wrapper"),m=s.scrollTop,F=s.clientHeight;let g=1;for(const n of r){const l=n.offsetTop-s.offsetTop,P=l+n.clientHeight;l<=m+F/2&&P>m&&(g=parseInt(n.dataset.page))}a("page-changed",g)}function y(s){const r=k.value;if(!r)return;const m=r.querySelector(`[data-page="${s}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"start"})}function M(s){const r=b.get(s);return(r==null?void 0:r.pdfCanvas)||null}function z(s){const r=b.get(s);r!=null&&r.rerender&&r.rerender()}function S(s){a("page-rendered",s)}return p({scrollToPage:y,getPageCanvasEl:M,rerenderPage:z}),(s,r)=>(C(),D("div",{ref_key:"canvasContainer",ref:k,class:"flex-1 overflow-auto bg-gray-300 flex flex-col items-center py-6 px-4",onScroll:f},[(C(!0),D(K,null,re(e.totalPages,m=>(C(),G(jt,{key:m,ref_for:!0,ref:F=>h(m,F),"page-num":m,"render-page":e.renderPage,"init-fabric-canvas":e.initFabricCanvas,scale:e.scale,onPageRendered:S},null,8,["page-num","render-page","init-fabric-canvas","scale"]))),128)),e.totalPages===0&&!e.loading?(C(),D("div",Bt,[I($(ve),{class:"w-16 h-16 mx-auto text-gray-400 mb-4"}),r[0]||(r[0]=o("p",{class:"text-gray-500 text-lg"},"No PDF loaded",-1)),r[1]||(r[1]=o("p",{class:"text-gray-400 text-sm mt-1"},"Open a file to start editing",-1))])):N("",!0),e.loading?(C(),D("div",Nt,[...r[2]||(r[2]=[o("div",{class:"w-8 h-8 border-3 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto"},null,-1),o("p",{class:"text-gray-500 mt-3"},"Loading PDF...",-1)])])):N("",!0)],544))}},Rt={class:"w-52 bg-white border-r border-gray-200 flex flex-col h-full"},Lt={class:"flex border-b border-gray-200"},Wt=["onClick"],Vt={key:0,class:"flex-1 overflow-y-auto p-2 space-y-2"},Ht=["onClick"],qt={class:"text-xs text-center text-gray-500 mt-1"},Xt={key:1,class:"flex-1 overflow-y-auto p-2"},Yt={key:0,class:"text-sm text-gray-500 text-center py-4"},Jt=["onClick"],Kt={class:"flex items-center justify-between"},Zt={class:"font-medium capitalize"},Gt={class:"text-gray-400"},Qt={key:0,class:"text-gray-500 truncate mt-0.5"},eo={key:2,class:"flex-1 overflow-y-auto p-2"},to={__name:"PdfSidebar",props:{totalPages:{type:Number,default:0},currentPage:{type:Number,default:1},annotationList:{type:Array,default:()=>[]},renderThumbnail:{type:Function,default:null}},emits:["go-to-page","select-annotation"],setup(e){const p=e,t=T("thumbnails"),a=tt({}),k=[{id:"thumbnails",icon:Qe},{id:"annotations",icon:et},{id:"outline",icon:ve}];return he(()=>p.totalPages,b=>j(this,null,function*(){if(b&&p.renderThumbnail){yield new Promise(h=>setTimeout(h,100));for(let h=1;h<=b;h++){const f=a[h];f&&(yield p.renderThumbnail(h,f,.2))}}})),(b,h)=>(C(),D("div",Rt,[o("div",Lt,[(C(),D(K,null,re(k,f=>o("button",{key:f.id,onClick:y=>t.value=f.id,class:ce(["flex-1 py-2 px-1 text-xs font-medium transition-colors border-b-2",t.value===f.id?"border-brand-500 text-brand-600":"border-transparent text-gray-500 hover:text-gray-700"])},[(C(),G(ge(f.icon),{class:"w-4 h-4 mx-auto"}))],10,Wt)),64))]),t.value==="thumbnails"?(C(),D("div",Vt,[(C(!0),D(K,null,re(e.totalPages,f=>(C(),D("div",{key:f,onClick:y=>b.$emit("go-to-page",f),class:ce(["cursor-pointer rounded-lg border-2 transition-colors p-1",e.currentPage===f?"border-brand-500 bg-brand-50":"border-gray-200 hover:border-brand-300"])},[o("canvas",{ref_for:!0,ref:y=>{y&&(a[f]=y)},class:"w-full bg-white rounded"},null,512),o("p",qt,V(f),1)],10,Ht))),128))])):N("",!0),t.value==="annotations"?(C(),D("div",Xt,[e.annotationList.length===0?(C(),D("div",Yt," No annotations yet ")):N("",!0),(C(!0),D(K,null,re(e.annotationList,f=>(C(),D("div",{key:f.id,class:"px-3 py-2 text-xs border-b border-gray-100 hover:bg-gray-50 cursor-pointer",onClick:y=>b.$emit("select-annotation",f)},[o("div",Kt,[o("span",Zt,V(f.type),1),o("span",Gt,"p."+V(f.page),1)]),f.text?(C(),D("p",Qt,V(f.text),1)):N("",!0)],8,Jt))),128))])):N("",!0),t.value==="outline"?(C(),D("div",eo,[...h[0]||(h[0]=[o("p",{class:"text-sm text-gray-500 text-center py-4"},"Document outline",-1)])])):N("",!0)]))}},oo={class:"w-56 bg-white border-l border-gray-200 p-4 overflow-y-auto"},no={key:0,class:"text-sm text-gray-500"},ao={key:1,class:"space-y-4"},lo=["value"],so={key:0},io=["value"],ro={class:"block text-xs font-medium text-gray-600 mb-1"},uo=["value"],co={key:1},fo=["value"],po={__name:"PdfPropertiesPanel",props:{activeObject:{type:Object,default:null},toolOptions:{type:Object,default:()=>({})}},emits:["update-options","delete-selected"],setup(e){return(p,t)=>{var a,k;return C(),D("div",oo,[t[8]||(t[8]=o("h3",{class:"text-sm font-semibold text-gray-900 mb-4"},"Properties",-1)),e.activeObject?(C(),D("div",ao,[o("div",null,[t[5]||(t[5]=o("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Color",-1)),o("input",{type:"color",value:e.toolOptions.color,onInput:t[0]||(t[0]=b=>p.$emit("update-options",{color:b.target.value})),class:"w-full h-8 rounded border border-gray-300 cursor-pointer"},null,40,lo)]),((a=e.activeObject)==null?void 0:a.type)==="textbox"?(C(),D("div",so,[t[6]||(t[6]=o("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Font Size",-1)),o("input",{type:"number",value:e.toolOptions.fontSize,onInput:t[1]||(t[1]=b=>p.$emit("update-options",{fontSize:parseInt(b.target.value)})),min:"8",max:"120",class:"w-full px-3 py-1.5 border border-gray-300 rounded text-sm"},null,40,io)])):N("",!0),o("div",null,[o("label",ro," Opacity: "+V(Math.round(e.toolOptions.opacity*100))+"% ",1),o("input",{type:"range",value:e.toolOptions.opacity,onInput:t[2]||(t[2]=b=>p.$emit("update-options",{opacity:parseFloat(b.target.value)})),min:"0",max:"1",step:"0.05",class:"w-full"},null,40,uo)]),["rect","circle","line","path"].includes((k=e.activeObject)==null?void 0:k.type)?(C(),D("div",co,[t[7]||(t[7]=o("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Stroke Width",-1)),o("input",{type:"number",value:e.toolOptions.strokeWidth,onInput:t[3]||(t[3]=b=>p.$emit("update-options",{strokeWidth:parseInt(b.target.value)})),min:"1",max:"20",class:"w-full px-3 py-1.5 border border-gray-300 rounded text-sm"},null,40,fo)])):N("",!0),o("button",{onClick:t[4]||(t[4]=b=>p.$emit("delete-selected")),class:"w-full px-3 py-2 text-sm text-red-600 bg-red-50 hover:bg-red-100 rounded-md transition-colors"}," Delete ")])):(C(),D("div",no," Select an annotation to edit its properties. "))])}}},go={class:"bg-gray-100 border-t border-gray-200 px-4 py-1.5 flex items-center justify-between text-xs text-gray-600"},vo={class:"flex items-center gap-4"},mo={class:"flex items-center gap-2"},yo={class:"w-12 text-center"},bo={class:"flex items-center gap-4"},ho={key:0},xo={key:1,class:"text-amber-600"},wo={key:2,class:"text-green-600"},ko={__name:"PdfStatusBar",props:{currentPage:{type:Number,default:1},totalPages:{type:Number,default:0},zoomPercent:{type:Number,default:100},fileSize:{type:String,default:""},isDirty:{type:Boolean,default:!1},lastSaved:{type:String,default:""}},emits:["zoom-in","zoom-out","zoom-fit"],setup(e){return(p,t)=>(C(),D("div",go,[o("div",vo,[o("span",null,"Page "+V(e.currentPage)+" of "+V(e.totalPages),1)]),o("div",mo,[o("button",{onClick:t[0]||(t[0]=a=>p.$emit("zoom-out")),class:"p-1 hover:bg-gray-200 rounded",title:"Zoom out"},[I($(ot),{class:"w-3.5 h-3.5"})]),o("span",yo,V(e.zoomPercent)+"%",1),o("button",{onClick:t[1]||(t[1]=a=>p.$emit("zoom-in")),class:"p-1 hover:bg-gray-200 rounded",title:"Zoom in"},[I($(nt),{class:"w-3.5 h-3.5"})]),o("button",{onClick:t[2]||(t[2]=a=>p.$emit("zoom-fit")),class:"p-1 hover:bg-gray-200 rounded ml-1",title:"Fit to page"},[I($(at),{class:"w-3.5 h-3.5"})])]),o("div",bo,[e.fileSize?(C(),D("span",ho,V(e.fileSize),1)):N("",!0),e.isDirty?(C(),D("span",xo,"Unsaved changes")):e.lastSaved?(C(),D("span",wo,"Saved")):N("",!0)])]))}},Po={key:0,class:"absolute top-2 right-4 z-10 bg-white border border-gray-200 rounded-lg shadow-lg p-3 flex items-center gap-2"},So={key:0,class:"text-xs text-gray-500"},Co=["disabled"],To=["disabled"],$o={__name:"PdfSearchBar",props:{visible:{type:Boolean,default:!1},getPageText:{type:Function,default:null},totalPages:{type:Number,default:0}},emits:["close","go-to-page"],setup(e,{emit:p}){const t=e,a=p,k=T(null),b=T(""),h=T([]),f=T(0),y=T(0);he(()=>t.visible,S=>j(this,null,function*(){var s;S&&(yield lt(),(s=k.value)==null||s.focus())})),he(b,S=>j(this,null,function*(){if(!S||!t.getPageText){h.value=[],f.value=0,y.value=0;return}const s=[];for(let r=1;r<=t.totalPages;r++)(yield t.getPageText(r)).toLowerCase().includes(S.toLowerCase())&&s.push(r);h.value=s,y.value=s.length,f.value=s.length>0?1:0}));function M(){y.value!==0&&(f.value=f.value>=y.value?1:f.value+1,a("go-to-page",h.value[f.value-1]))}function z(){y.value!==0&&(f.value=f.value<=1?y.value:f.value-1,a("go-to-page",h.value[f.value-1]))}return(S,s)=>e.visible?(C(),D("div",Po,[I($(Be),{class:"w-4 h-4 text-gray-400"}),te(o("input",{ref_key:"searchInput",ref:k,"onUpdate:modelValue":s[0]||(s[0]=r=>b.value=r),onKeydown:[Oe(M,["enter"]),s[1]||(s[1]=Oe(r=>S.$emit("close"),["escape"]))],type:"text",placeholder:"Search in document...",class:"w-56 text-sm border-none outline-none"},null,544),[[ae,b.value]]),y.value>0?(C(),D("span",So,V(f.value)+" / "+V(y.value),1)):N("",!0),o("button",{onClick:z,class:"p-1 hover:bg-gray-100 rounded",disabled:y.value===0},[I($(st),{class:"w-4 h-4"})],8,Co),o("button",{onClick:M,class:"p-1 hover:bg-gray-100 rounded",disabled:y.value===0},[I($(Ne),{class:"w-4 h-4"})],8,To),o("button",{onClick:s[2]||(s[2]=r=>S.$emit("close")),class:"p-1 hover:bg-gray-100 rounded"},[I($(Se),{class:"w-4 h-4"})])])):N("",!0)}},Fo={class:"bg-white rounded-xl shadow-2xl w-[480px] max-h-[80vh] overflow-hidden"},Ao={class:"flex items-center justify-between px-5 py-4 border-b border-gray-200"},Do={class:"flex items-center gap-2"},Oo={class:"font-semibold text-gray-900"},Mo={class:"px-5 py-4 overflow-auto max-h-[60vh]"},zo={key:0,class:"text-gray-500 text-center py-8"},Eo={class:"space-y-3"},_o={class:"block"},Io={key:0,class:"block"},jo={key:1,class:"block"},Bo=["max"],No={key:2,class:"block"},Uo={class:"text-xs text-gray-400"},Ro={class:"block"},Lo={class:"space-y-3"},Wo={key:0,class:"space-y-2"},Vo={class:"flex-1 truncate"},Ho=["onClick"],qo={class:"space-y-3"},Xo={class:"block"},Yo={class:"block"},Jo={class:"text-xs text-gray-400"},Ko={class:"block"},Zo={class:"space-y-3"},Go={class:"block"},Qo={class:"block"},en={key:5,class:"text-center py-6"},tn={class:"text-gray-600 font-medium"},on={key:0,class:"px-5 py-3 border-t border-gray-200 flex justify-end gap-2"},nn=["disabled"],an={__name:"ServerToolPanel",props:{toolId:{type:String,required:!0},pdfFile:{type:[File,Object],default:null},totalPages:{type:Number,default:0}},emits:["close","done"],setup(e,{emit:p}){const t=e,a=Z(()=>!!t.pdfFile),k=T(!1),b=T(""),h=T(!1),f=T("ranges"),y=T(""),M=T(1),z=T(""),S=T("ebook"),s=T([]),r=T("CONFIDENTIAL"),m=T(.15),F=T("#888888"),g=T(""),n=T(""),l={merge:{title:"Merge PDFs",icon:ze},split:{title:"Split PDF",icon:Ee},compress:{title:"Compress PDF",icon:_e},ocr:{title:"OCR (Make Searchable)",icon:ke},convert:{title:"Convert PDF",icon:Pe},watermark:{title:"Add Watermark",icon:Ie},protect:{title:"Protect PDF",icon:je}},P=Z(()=>l[t.toolId]||{title:t.toolId,icon:ve});function x(){const E=document.createElement("input");E.type="file",E.accept=".pdf",E.multiple=!0,E.onchange=u=>{for(const O of u.target.files)s.value.push(O)},E.click()}function v(E){for(const u of E.dataTransfer.files)(u.type==="application/pdf"||u.name.endsWith(".pdf"))&&s.value.push(u)}function w(){return j(this,null,function*(){k.value=!0,b.value="",h.value=!1;try{switch(t.toolId){case"split":yield B();break;case"compress":yield U();break;case"merge":yield oe();break;case"watermark":yield fe();break;case"protect":yield pe();break}}catch(E){b.value="Error: "+(E.message||"Operation failed"),h.value=!0}finally{k.value=!1}})}function A(){return j(this,null,function*(){const E=t.pdfFile;if(E instanceof File)return yield ue.load(yield E.arrayBuffer());throw new Error("No file loaded")})}function d(E,u){const O=URL.createObjectURL(E),L=document.createElement("a");L.href=O,L.download=u,L.click(),URL.revokeObjectURL(O)}function B(){return j(this,null,function*(){const E=yield A(),u=E.getPageCount();let O=[];if(f.value==="ranges"){const L=y.value.split(",").map(W=>W.trim());for(const W of L){const X=W.split("-").map(Number);if(X.length===2){const Y=[];for(let ne=X[0];ne<=Math.min(X[1],u);ne++)Y.push(ne-1);O.push(Y)}else X.length===1&&!isNaN(X[0])&&O.push([X[0]-1])}}else if(f.value==="every"){const L=M.value||1;for(let W=0;W<u;W+=L){const X=[];for(let Y=W;Y<Math.min(W+L,u);Y++)X.push(Y);O.push(X)}}else if(f.value==="extract"){const L=z.value.split(",").map(W=>parseInt(W.trim())-1).filter(W=>W>=0&&W<u);O.push(L)}if(O.length===0){b.value="No valid pages specified",h.value=!0;return}for(let L=0;L<O.length;L++){const W=yield ue.create(),X=yield W.copyPages(E,O[L]);for(const ne of X)W.addPage(ne);const Y=yield W.save();d(new Blob([Y],{type:"application/pdf"}),`split_part_${L+1}.pdf`)}b.value=`Split into ${O.length} file(s) — downloading...`})}function U(){return j(this,null,function*(){const E=yield A();E.setTitle(""),E.setAuthor(""),E.setSubject(""),E.setKeywords([]),E.setProducer(""),E.setCreator("");const u=yield E.save({useObjectStreams:!0,addDefaultPage:!1});d(new Blob([u],{type:"application/pdf"}),"compressed.pdf"),b.value="Saved. Note: for heavy compression (image downsampling), install the pdf_suite backend."})}function oe(){return j(this,null,function*(){if(s.value.length===0){b.value="Add at least one PDF to merge",h.value=!0;return}const E=yield A();for(const O of s.value){const L=yield O.arrayBuffer(),W=yield ue.load(L),X=yield E.copyPages(W,W.getPageIndices());for(const Y of X)E.addPage(Y)}const u=yield E.save();d(new Blob([u],{type:"application/pdf"}),"merged.pdf"),b.value=`Merged ${s.value.length+1} files — downloading...`})}function fe(){return j(this,null,function*(){if(!r.value.trim()){b.value="Enter watermark text",h.value=!0;return}const E=yield A(),u=yield E.embedFont(Re.HelveticaBold),O=E.getPages(),L=F.value.replace("#",""),W=parseInt(L.substring(0,2),16)/255,X=parseInt(L.substring(2,4),16)/255,Y=parseInt(L.substring(4,6),16)/255;for(const c of O){const{width:i,height:R}=c.getSize(),_=Math.min(i,R)/8;c.drawText(r.value,{x:i/2-r.value.length*_*.3,y:R/2,size:_,font:u,color:Le(W,X,Y),opacity:m.value,rotate:xt(-45)})}const ne=yield E.save();d(new Blob([ne],{type:"application/pdf"}),"watermarked.pdf"),b.value=`Watermark added to ${O.length} pages — downloading...`})}function pe(){return j(this,null,function*(){if(!g.value){b.value="Enter a user password",h.value=!0;return}b.value="PDF encryption requires the pdf_suite backend (pikepdf). Install with: bench get-app pdf-suite",h.value=!0})}return(E,u)=>(C(),D("div",{class:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center",onClick:u[13]||(u[13]=xe(O=>E.$emit("close"),["self"]))},[o("div",Fo,[o("div",Ao,[o("div",Do,[(C(),G(ge(P.value.icon),{class:"w-5 h-5 text-brand-600"})),o("h3",Oo,V(P.value.title),1)]),o("button",{onClick:u[0]||(u[0]=O=>E.$emit("close")),class:"p-1 hover:bg-gray-100 rounded"},[I($(Se),{class:"w-4 h-4"})])]),o("div",Mo,[a.value?(C(),D(K,{key:1},[e.toolId==="split"?(C(),D(K,{key:0},[u[19]||(u[19]=o("p",{class:"text-sm text-gray-600 mb-3"},"Split the current PDF into separate files.",-1)),o("div",Eo,[o("label",_o,[u[15]||(u[15]=o("span",{class:"text-sm font-medium text-gray-700"},"Mode",-1)),te(o("select",{"onUpdate:modelValue":u[1]||(u[1]=O=>f.value=O),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500 focus:border-brand-500"},[...u[14]||(u[14]=[o("option",{value:"ranges"},"By page ranges",-1),o("option",{value:"every"},"Every N pages",-1),o("option",{value:"extract"},"Extract specific pages",-1)])],512),[[Me,f.value]])]),f.value==="ranges"?(C(),D("label",Io,[u[16]||(u[16]=o("span",{class:"text-sm font-medium text-gray-700"},"Page ranges (e.g., 1-3, 5-7)",-1)),te(o("input",{"onUpdate:modelValue":u[2]||(u[2]=O=>y.value=O),type:"text",placeholder:"1-3, 4-6, 7-10",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500"},null,512),[[ae,y.value]])])):N("",!0),f.value==="every"?(C(),D("label",jo,[u[17]||(u[17]=o("span",{class:"text-sm font-medium text-gray-700"},"Every N pages",-1)),te(o("input",{"onUpdate:modelValue":u[3]||(u[3]=O=>M.value=O),type:"number",min:"1",max:e.totalPages,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500"},null,8,Bo),[[ae,M.value,void 0,{number:!0}]])])):N("",!0),f.value==="extract"?(C(),D("label",No,[u[18]||(u[18]=o("span",{class:"text-sm font-medium text-gray-700"},"Pages to extract (e.g., 1, 3, 5)",-1)),te(o("input",{"onUpdate:modelValue":u[4]||(u[4]=O=>z.value=O),type:"text",placeholder:"1, 3, 5, 8",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500"},null,512),[[ae,z.value]])])):N("",!0),o("p",Uo,"Total pages: "+V(e.totalPages),1)])],64)):N("",!0),e.toolId==="compress"?(C(),D(K,{key:1},[u[22]||(u[22]=o("p",{class:"text-sm text-gray-600 mb-3"},"Reduce file size. Higher quality = larger file.",-1)),o("label",Ro,[u[21]||(u[21]=o("span",{class:"text-sm font-medium text-gray-700"},"Quality",-1)),te(o("select",{"onUpdate:modelValue":u[5]||(u[5]=O=>S.value=O),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500 focus:border-brand-500"},[...u[20]||(u[20]=[o("option",{value:"screen"},"Screen (smallest, 72 dpi)",-1),o("option",{value:"ebook"},"Ebook (medium, 150 dpi)",-1),o("option",{value:"printer"},"Printer (high, 300 dpi)",-1)])],512),[[Me,S.value]])])],64)):N("",!0),e.toolId==="merge"?(C(),D(K,{key:2},[u[24]||(u[24]=o("p",{class:"text-sm text-gray-600 mb-3"},"Add more PDFs to merge with the current document.",-1)),o("div",Lo,[o("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-brand-400 hover:bg-brand-50/30 transition",onClick:x,onDragover:u[6]||(u[6]=xe(()=>{},["prevent"])),onDrop:xe(v,["prevent"])},[I($(it),{class:"w-8 h-8 mx-auto text-gray-400 mb-2"}),u[23]||(u[23]=o("p",{class:"text-sm text-gray-600"},"Click or drop PDFs to add",-1))],32),s.value.length>0?(C(),D("div",Wo,[(C(!0),D(K,null,re(s.value,(O,L)=>(C(),D("div",{key:L,class:"flex items-center gap-2 bg-gray-50 rounded px-3 py-2 text-sm"},[I($(ve),{class:"w-4 h-4 text-gray-500 flex-shrink-0"}),o("span",Vo,V(O.name),1),o("button",{onClick:W=>s.value.splice(L,1),class:"text-gray-400 hover:text-red-500"},[I($(Se),{class:"w-3.5 h-3.5"})],8,Ho)]))),128))])):N("",!0)])],64)):N("",!0),e.toolId==="watermark"?(C(),D(K,{key:3},[u[28]||(u[28]=o("p",{class:"text-sm text-gray-600 mb-3"},"Add a text watermark to all pages.",-1)),o("div",qo,[o("label",Xo,[u[25]||(u[25]=o("span",{class:"text-sm font-medium text-gray-700"},"Watermark text",-1)),te(o("input",{"onUpdate:modelValue":u[7]||(u[7]=O=>r.value=O),type:"text",placeholder:"CONFIDENTIAL",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500"},null,512),[[ae,r.value]])]),o("label",Yo,[u[26]||(u[26]=o("span",{class:"text-sm font-medium text-gray-700"},"Opacity",-1)),te(o("input",{"onUpdate:modelValue":u[8]||(u[8]=O=>m.value=O),type:"range",min:"0.05",max:"0.5",step:"0.05",class:"mt-1 w-full"},null,512),[[ae,m.value,void 0,{number:!0}]]),o("span",Jo,V(Math.round(m.value*100))+"%",1)]),o("label",Ko,[u[27]||(u[27]=o("span",{class:"text-sm font-medium text-gray-700"},"Color",-1)),te(o("input",{"onUpdate:modelValue":u[9]||(u[9]=O=>F.value=O),type:"color",class:"mt-1 w-12 h-8 rounded border"},null,512),[[ae,F.value]])])])],64)):N("",!0),e.toolId==="protect"?(C(),D(K,{key:4},[u[31]||(u[31]=o("p",{class:"text-sm text-gray-600 mb-3"},"Set a password to protect the PDF.",-1)),o("div",Zo,[o("label",Go,[u[29]||(u[29]=o("span",{class:"text-sm font-medium text-gray-700"},"User password (to open)",-1)),te(o("input",{"onUpdate:modelValue":u[10]||(u[10]=O=>g.value=O),type:"password",placeholder:"Enter password",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500"},null,512),[[ae,g.value]])]),o("label",Qo,[u[30]||(u[30]=o("span",{class:"text-sm font-medium text-gray-700"},"Owner password (to edit, optional)",-1)),te(o("input",{"onUpdate:modelValue":u[11]||(u[11]=O=>n.value=O),type:"password",placeholder:"Enter owner password",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm text-sm px-3 py-2 border focus:ring-brand-500"},null,512),[[ae,n.value]])])])],64)):N("",!0),e.toolId==="ocr"||e.toolId==="convert"?(C(),D("div",en,[(C(),G(ge(e.toolId==="ocr"?$(ke):$(Pe)),{class:"w-12 h-12 mx-auto text-gray-300 mb-3"})),o("p",tn,V(P.value.title),1),u[32]||(u[32]=o("p",{class:"text-sm text-gray-400 mt-1"}," This operation requires the pdf_suite backend to be installed on your Frappe instance. ",-1)),u[33]||(u[33]=o("div",{class:"mt-4 bg-gray-50 rounded-lg p-3 text-left text-xs text-gray-500 font-mono"},[de(" bench get-app https://github.com/Dravecx/pdf-suite"),o("br"),de(" bench --site your-site install-app pdf_suite ")],-1))])):N("",!0)],64)):(C(),D("p",zo," No PDF loaded. Open a file first. "))]),a.value&&!["ocr","convert"].includes(e.toolId)?(C(),D("div",on,[o("button",{onClick:u[12]||(u[12]=O=>E.$emit("close")),class:"px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg"}," Cancel "),o("button",{onClick:w,disabled:k.value,class:"px-4 py-2 text-sm bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2"},[k.value?(C(),G($(rt),{key:0,class:"w-4 h-4 animate-spin"})):N("",!0),de(" "+V(k.value?"Processing...":"Apply"),1)],8,nn)])):N("",!0),b.value?(C(),D("div",{key:1,class:ce(["px-5 py-2 text-sm",h.value?"bg-red-50 text-red-600":"bg-green-50 text-green-700"])},V(b.value),3)):N("",!0)])]))}},ln={class:"flex flex-col h-screen bg-gray-50"},sn={class:"bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between"},rn={class:"flex items-center gap-3"},dn={class:"flex items-center gap-1 ml-4"},un=["disabled"],cn=["disabled"],fn={class:"flex items-center gap-2"},pn={class:"text-sm text-gray-500"},gn={class:"flex items-center gap-2"},vn=["disabled"],mn={class:"relative",ref:"exportDropdown"},yn={key:0,class:"absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 w-48 z-20"},bn={class:"capitalize"},hn={class:"flex flex-1 overflow-hidden relative"},xn={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-50/80 z-10"},wn={__name:"PdfEditor",props:{embedded:{type:Boolean,default:!1}},setup(e){const p=Ue(),t=Pt(),a=St(),k=Ct(),b=Tt(),h=$t(),f=wt(),y=Ft(),M=T(null),z=T(!1),S=T(!1),s=T(null),r=T(null),m=T("select"),F=T([]),g=T([]);let n=!1;function l(c){if(n)return;const i=k.canvases.value.get(c);if(!i)return;const R=JSON.stringify(i.toJSON(["_annotationType","_pageNum","_originalText","_originalColor","_originalBounds","_pdfCoords","_lineItems"]));F.value.push({pageNum:c,state:R}),g.value=[],F.value.length>30&&F.value.shift()}function P(){return j(this,null,function*(){if(F.value.length===0)return;n=!0;const c=F.value.pop(),i=k.canvases.value.get(c.pageNum);if(i){const R=JSON.stringify(i.toJSON(["_annotationType","_pageNum","_originalText","_originalColor","_originalBounds","_pdfCoords","_lineItems"]));g.value.push({pageNum:c.pageNum,state:R}),yield i.loadFromJSON(JSON.parse(c.state)),i.renderAll()}n=!1})}function x(){return j(this,null,function*(){if(g.value.length===0)return;n=!0;const c=g.value.pop(),i=k.canvases.value.get(c.pageNum);if(i){const R=JSON.stringify(i.toJSON(["_annotationType","_pageNum","_originalText","_originalColor","_originalBounds","_pdfCoords","_lineItems"]));F.value.push({pageNum:c.pageNum,state:R}),yield i.loadFromJSON(JSON.parse(c.state)),i.renderAll()}n=!1})}const v=Z(()=>t.fileSize?ne(t.fileSize):""),w=Z(()=>m.value==="editText"?"Edit Text":m.value),A=Z(()=>m.value==="editText"?"— text extracted. Click any line to edit it directly.":"— click on the PDF to add"),d=Z(()=>m.value==="editText"?"bg-amber-50 border-amber-200 text-amber-800":"bg-brand-50 border-brand-200 text-brand-700");k.setOnAnnotationAdded((c,i)=>{l(c),t.markDirty(),h.addAnnotation(c,{type:i._annotationType||i.type,text:i.text||""})}),$e(()=>{var i;const c=p.query.file;if(c&&E(c),p.query.embed==="true"){const R=(i=p.query.tools)==null?void 0:i.split(",");t.setEmbedMode(R)}if(window.__pdfStudioFile){const R=window.__pdfStudioFile;delete window.__pdfStudioFile,pe([R])}document.addEventListener("keydown",B)}),Ce(()=>{document.removeEventListener("keydown",B)});function B(c){const i=document.activeElement;i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.isContentEditable)||((c.key==="Delete"||c.key==="Backspace")&&(k.deleteSelected(a.currentPage.value),c.preventDefault()),c.ctrlKey&&c.key==="s"?(c.preventDefault(),O("download")):c.ctrlKey&&c.key==="z"?(c.preventDefault(),P()):c.ctrlKey&&c.key==="y"?(c.preventDefault(),x()):c.ctrlKey&&c.key==="f"?(c.preventDefault(),z.value=!z.value):c.key==="Escape"&&(U("select"),S.value=!1,r.value=null))}function U(c){return j(this,null,function*(){var R;if(m.value==="editText"&&c!=="editText"){const _=a.currentPage.value,Q=k.canvases.value.get(_),le=(R=M.value)==null?void 0:R.getPageCanvasEl(_),ie=()=>{var q;return(q=M.value)==null?void 0:q.rerenderPage(_)};yield y.exitTextEditMode(_,Q,ie,le)}m.value=c,c==="editText"?(yield oe(),k.setTool("select"),t.setTool("editText")):(k.setTool(c),t.setTool(c))})}function oe(){return j(this,null,function*(){var Q;const c=a.currentPage.value,i=k.canvases.value.get(c),R=(Q=M.value)==null?void 0:Q.getPageCanvasEl(c);if(!a.pdfDoc.value||!i||!R){console.warn("No PDF or canvas available for text editing");return}const _=yield y.enterTextEditMode(a.pdfDoc.value,c,i,R,a.scale.value);console.log(`Extracted ${_} text lines for editing on page ${c}`),t.markDirty()})}function fe(c){k.updateToolOptions(c),t.updateToolOptions(c);const i=k.activeObject.value;if(i){c.color!==void 0&&i.set("fill",c.color),c.fontSize!==void 0&&i.set("fontSize",c.fontSize),c.opacity!==void 0&&i.set("opacity",c.opacity),c.strokeWidth!==void 0&&i.set("strokeWidth",c.strokeWidth);for(const R of k.canvases.value.values())if(R.getObjects().includes(i)){R.renderAll();break}}}function pe(c){return j(this,null,function*(){if(!c.length)return;const i=c[0];s.value=i,t.setDocument("",i.name,i.size,0),yield a.loadPdf(i),t.totalPages=a.totalPages.value})}function E(c){return j(this,null,function*(){t.setDocument(c,c.split("/").pop(),0,0),yield a.loadPdf(c),t.totalPages=a.totalPages.value})}function u(c){var i;a.goToPage(c),(i=M.value)==null||i.scrollToPage(c)}function O(c){return j(this,null,function*(){if(S.value=!1,!(s.value||t.fileUrl))return;const R=y.getTextModifications(),_=t.fileName||"edited.pdf";if(R.length>0){yield L(R,_);return}yield W(c,_)})}function L(c,i,R){return j(this,null,function*(){let _=t.fileUrl;if(!_&&s.value){const q=yield f.uploadFile(s.value);if(!q.success){alert("Upload failed: "+(q.error||"Unknown error"));return}_=q.data.file_url}const Q=yield f.exportEdited(_,c,i);if(!Q.success){alert("Export failed: "+(Q.error||"Unknown error"));return}const le=k.getAllAnnotations();if(Object.values(le).some(q=>q.some(H=>H._annotationType!=="text-edit"))){const q=yield b.loadForEdit(Q.data.file_url),H=[];for(const[We,Ve]of Object.entries(le))for(const J of Ve)J._annotationType!=="text-edit"&&H.push({page:parseInt(We),type:J._annotationType||J.type,x:J.left||0,y:J.top||0,width:J.width,height:J.height,text:J.text,color:J.fill||J.stroke,fontSize:J.fontSize,opacity:J.opacity});yield b.embedAnnotations(q,H),yield b.downloadPdf(q,i)}else{const q=document.createElement("a");q.href=Q.data.file_url,q.download=i,q.click()}t.markSaved()})}function W(c,i){return j(this,null,function*(){const R=s.value||t.fileUrl,_=yield b.loadForEdit(R),Q=k.getAllAnnotations(),le=[];for(const[ie,q]of Object.entries(Q))for(const H of q)H._annotationType!=="text-edit"&&le.push({page:parseInt(ie),type:H._annotationType||H.type,x:H.left||0,y:H.top||0,width:H.width,height:H.height,text:H.text,color:H.fill||H.stroke,fontSize:H.fontSize,opacity:H.opacity});if(le.length>0&&(yield b.embedAnnotations(_,le)),c==="download"||c==="flatten")yield b.downloadPdf(_,i);else if(c==="save"){const ie=yield b.exportAsBlob(_);if(ie){const q=new File([ie],i,{type:"application/pdf"}),H=yield f.uploadFile(q);H.success&&t.markSaved(H.data.name)}}})}function X(c){r.value=c}function Y(c){r.value=null,c!=null&&c.reload&&s.value&&pe([s.value])}function ne(c){for(const i of["B","KB","MB","GB"]){if(c<1024)return`${c.toFixed(1)} ${i}`;c/=1024}return`${c.toFixed(1)} TB`}return(c,i)=>{const R=dt("router-link");return C(),D("div",ln,[o("div",sn,[o("div",rn,[e.embedded?N("",!0):(C(),G(R,{key:0,to:"/",class:"text-brand-600 hover:text-brand-700"},{default:ut(()=>[I($(ve),{class:"w-5 h-5"})]),_:1})),i[16]||(i[16]=o("span",{class:"font-semibold text-gray-900"},"PDF Studio",-1)),o("div",dn,[o("button",{onClick:P,disabled:F.value.length===0,class:"p-1.5 rounded hover:bg-gray-100 disabled:opacity-30",title:"Undo (Ctrl+Z)"},[I($(ct),{class:"w-4 h-4"})],8,un),o("button",{onClick:x,disabled:g.value.length===0,class:"p-1.5 rounded hover:bg-gray-100 disabled:opacity-30",title:"Redo (Ctrl+Y)"},[I($(ft),{class:"w-4 h-4"})],8,cn)])]),o("div",fn,[o("span",pn,V($(t).fileName||"No file"),1)]),o("div",gn,[o("button",{onClick:i[0]||(i[0]=_=>z.value=!z.value),class:"p-2 hover:bg-gray-100 rounded",title:"Search (Ctrl+F)"},[I($(Be),{class:"w-4 h-4"})]),o("button",{onClick:i[1]||(i[1]=_=>$(t).showSidebar=!$(t).showSidebar),class:"p-2 hover:bg-gray-100 rounded",title:"Toggle sidebar"},[I($(pt),{class:"w-4 h-4"})]),o("button",{onClick:i[2]||(i[2]=_=>$(t).showProperties=!$(t).showProperties),class:"p-2 hover:bg-gray-100 rounded",title:"Toggle properties"},[I($(gt),{class:"w-4 h-4"})]),o("button",{onClick:i[3]||(i[3]=_=>O("download")),disabled:!s.value&&!$(t).fileUrl,class:"flex items-center gap-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium disabled:opacity-40",title:"Save / Download (Ctrl+S)"},[I($(vt),{class:"w-4 h-4"}),i[17]||(i[17]=de(" Save ",-1))],8,vn),o("div",mn,[o("button",{onClick:i[4]||(i[4]=_=>S.value=!S.value),class:"flex items-center gap-1 px-3 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 text-sm font-medium"},[I($(mt),{class:"w-4 h-4"}),i[18]||(i[18]=de(" Export ",-1)),I($(Ne),{class:"w-3 h-3"})]),S.value?(C(),D("div",yn,[o("button",{onClick:i[5]||(i[5]=_=>O("download")),class:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50"}," Download PDF "),o("button",{onClick:i[6]||(i[6]=_=>O("save")),class:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50"}," Save to Frappe "),o("button",{onClick:i[7]||(i[7]=_=>O("flatten")),class:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50"}," Flatten & Download ")])):N("",!0)],512)])]),I(_t,{"active-tool":m.value,"onUpdate:activeTool":U,onServerTool:X},null,8,["active-tool"]),m.value!=="select"?(C(),D("div",{key:0,class:ce(["border-b px-4 py-1.5 text-sm flex items-center justify-between",d.value])},[o("span",null,[o("strong",bn,V(w.value),1),de(" "+V(A.value),1)]),o("button",{onClick:i[8]||(i[8]=_=>U("select")),class:ce(["text-xs hover:underline",m.value==="editText"?"text-amber-700":"text-brand-600"])},V(m.value==="editText"?"Done Editing":"Back to Select"),3)],2)):N("",!0),o("div",hn,[I($o,{visible:z.value,"get-page-text":$(a).getPageText,"total-pages":$(a).totalPages.value,onClose:i[9]||(i[9]=_=>z.value=!1),onGoToPage:u},null,8,["visible","get-page-text","total-pages"]),$(t).showSidebar?(C(),G(to,{key:0,"total-pages":$(a).totalPages.value,"current-page":$(a).currentPage.value,"annotation-list":$(h).annotationList.value,"render-thumbnail":$(a).renderThumbnail,onGoToPage:u,onSelectAnnotation:$(h).selectAnnotation},null,8,["total-pages","current-page","annotation-list","render-thumbnail","onSelectAnnotation"])):N("",!0),I(Ut,{ref_key:"canvasArea",ref:M,"total-pages":$(a).totalPages.value,"render-page":$(a).renderPage,"init-fabric-canvas":$(k).initCanvas,scale:$(a).scale.value,loading:$(a).loading.value,onPageChanged:i[10]||(i[10]=_=>$(a).currentPage.value=_)},null,8,["total-pages","render-page","init-fabric-canvas","scale","loading"]),$(t).showProperties?(C(),G(po,{key:1,"active-object":$(k).activeObject.value,"tool-options":$(k).toolOptions.value,onUpdateOptions:fe,onDeleteSelected:i[11]||(i[11]=_=>$(k).deleteSelected($(a).currentPage.value))},null,8,["active-object","tool-options"])):N("",!0)]),I(ko,{"current-page":$(a).currentPage.value,"total-pages":$(a).totalPages.value,"zoom-percent":$(a).zoomPercent.value,"file-size":v.value,"is-dirty":$(t).isDirty,"last-saved":$(t).lastSaved,onZoomIn:i[12]||(i[12]=_=>$(a).zoomIn()),onZoomOut:i[13]||(i[13]=_=>$(a).zoomOut()),onZoomFit:i[14]||(i[14]=_=>$(a).zoomFit())},null,8,["current-page","total-pages","zoom-percent","file-size","is-dirty","last-saved"]),$(a).totalPages.value===0&&!$(a).loading.value?(C(),D("div",xn,[I(kt,{accept:".pdf",label:"Drop a PDF here or click to open",hint:"Supports PDF files up to 100 MB",class:"w-96",onFilesSelected:pe})])):N("",!0),r.value?(C(),G(an,{key:2,"tool-id":r.value,"pdf-file":s.value,"total-pages":$(a).totalPages.value,onClose:i[15]||(i[15]=_=>r.value=null),onDone:Y},null,8,["tool-id","pdf-file","total-pages"])):N("",!0)])}}},An={__name:"EditorPage",setup(e){const p=Ue(),t=Z(()=>p.query.embed==="true");return $e(()=>{if(window.__pdfStudioFile){const a=window.__pdfStudioFile;delete window.__pdfStudioFile,setTimeout(()=>{window.dispatchEvent(new CustomEvent("pdf-studio-open-file",{detail:a}))},100)}}),(a,k)=>(C(),G(wn,{embedded:t.value},null,8,["embedded"]))}};export{An as default};
//# sourceMappingURL=EditorPage-xKmvdPKM.js.map
