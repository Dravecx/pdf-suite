{"version":3,"file":"TemplateGenerator-CfbWZ_rU.js","sources":["../../../frontend/src/components/template/TemplateGenerator.vue"],"sourcesContent":["<template>\r\n  <div class=\"min-h-screen bg-gray-50\">\r\n    <div class=\"max-w-xl mx-auto px-6 py-10\">\r\n\r\n      <!-- Header -->\r\n      <div class=\"flex items-center gap-3 mb-8\">\r\n        <button\r\n          class=\"flex items-center gap-1.5 text-sm text-gray-600 hover:text-gray-900 transition-colors\"\r\n          @click=\"$router.push('/templates')\"\r\n        >\r\n          <ArrowLeft class=\"w-4 h-4\" />\r\n          Templates\r\n        </button>\r\n        <div class=\"w-px h-4 bg-gray-200\" />\r\n        <span class=\"text-sm text-gray-500\">Generate PDF</span>\r\n      </div>\r\n\r\n      <!-- Loading -->\r\n      <div v-if=\"loading\" class=\"flex justify-center py-16\">\r\n        <div class=\"w-8 h-8 border-2 border-orange-500 border-t-transparent rounded-full animate-spin\" />\r\n      </div>\r\n\r\n      <!-- Not found -->\r\n      <div v-else-if=\"!template\" class=\"text-center py-16\">\r\n        <p class=\"text-red-600 mb-3\">Template not found.</p>\r\n        <button @click=\"$router.push('/templates')\" class=\"text-sm text-orange-600 hover:underline\">\r\n          Back to templates\r\n        </button>\r\n      </div>\r\n\r\n      <template v-else>\r\n\r\n        <!-- Template info card -->\r\n        <div class=\"bg-white border border-gray-200 rounded-2xl p-5 mb-5 shadow-sm\">\r\n          <div class=\"flex items-start justify-between\">\r\n            <div>\r\n              <h1 class=\"text-lg font-bold text-gray-900\">{{ template.template_name }}</h1>\r\n              <p v-if=\"template.description\" class=\"text-sm text-gray-500 mt-1\">{{ template.description }}</p>\r\n            </div>\r\n            <button\r\n              class=\"text-sm text-gray-500 hover:text-orange-600 flex items-center gap-1 transition-colors\"\r\n              @click=\"$router.push({ name: 'template-edit', params: { name: route.params.name } })\"\r\n            >\r\n              <Pencil class=\"w-3.5 h-3.5\" />\r\n              Edit\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Variables form -->\r\n        <div class=\"bg-white border border-gray-200 rounded-2xl p-5 mb-5 shadow-sm\">\r\n          <h2 class=\"text-sm font-semibold text-gray-700 mb-4\">\r\n            Fill in Variables\r\n            <span class=\"font-normal text-gray-400\">({{ variables.length }})</span>\r\n          </h2>\r\n\r\n          <p v-if=\"variables.length === 0\" class=\"text-sm text-gray-400 py-4 text-center\">\r\n            This template has no variables. Click Generate to create the PDF.\r\n          </p>\r\n\r\n          <div v-else class=\"space-y-4\">\r\n            <div v-for=\"v in variables\" :key=\"v\">\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                <span class=\"inline-flex items-center gap-1\">\r\n                  <span class=\"px-1.5 py-0.5 bg-orange-100 text-orange-700 text-xs rounded font-mono\">{{ chipLabel(v) }}</span>\r\n                </span>\r\n              </label>\r\n              <input\r\n                v-model=\"variableValues[v]\"\r\n                type=\"text\"\r\n                :placeholder=\"`Enter value for ${v}`\"\r\n                class=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent transition\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Output filename -->\r\n        <div class=\"bg-white border border-gray-200 rounded-2xl p-5 mb-5 shadow-sm\">\r\n          <label class=\"block text-sm font-medium text-gray-700 mb-1.5\">Output filename</label>\r\n          <div class=\"flex items-center gap-2\">\r\n            <input\r\n              v-model=\"outputFilename\"\r\n              type=\"text\"\r\n              placeholder=\"document\"\r\n              class=\"flex-1 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent\"\r\n            />\r\n            <span class=\"text-sm text-gray-400\">.pdf</span>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Generate button -->\r\n        <button\r\n          @click=\"generate\"\r\n          :disabled=\"generating\"\r\n          class=\"w-full flex items-center justify-center gap-2 px-4 py-3 bg-orange-500 text-white font-medium rounded-xl hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-sm\"\r\n        >\r\n          <span v-if=\"generating\" class=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n          <FileDown v-else class=\"w-4 h-4\" />\r\n          {{ generating ? 'Generating PDFâ€¦' : 'Generate PDF' }}\r\n        </button>\r\n\r\n        <!-- Success result -->\r\n        <div\r\n          v-if=\"resultUrl\"\r\n          class=\"mt-4 p-4 bg-green-50 border border-green-200 rounded-xl flex items-center justify-between gap-3\"\r\n        >\r\n          <div class=\"flex items-center gap-2\">\r\n            <CheckCircle class=\"w-5 h-5 text-green-600 flex-shrink-0\" />\r\n            <span class=\"text-sm text-green-800\">PDF generated successfully!</span>\r\n          </div>\r\n          <a\r\n            :href=\"resultUrl\"\r\n            :download=\"resultFilename\"\r\n            class=\"flex items-center gap-1.5 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors flex-shrink-0\"\r\n          >\r\n            <Download class=\"w-3.5 h-3.5\" />\r\n            Download\r\n          </a>\r\n        </div>\r\n\r\n        <!-- Error -->\r\n        <div v-if=\"errorMsg\" class=\"mt-4 p-4 bg-red-50 border border-red-200 rounded-xl\">\r\n          <p class=\"text-sm text-red-700\">{{ errorMsg }}</p>\r\n        </div>\r\n\r\n      </template>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ArrowLeft, FileDown, Pencil, CheckCircle, Download } from 'lucide-vue-next'\r\nimport { usePdfApi } from '@/composables/usePdfApi'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst api = usePdfApi()\r\n\r\nconst loading = ref(true)\r\nconst generating = ref(false)\r\nconst template = ref(null)\r\nconst variables = ref([])\r\nconst variableValues = reactive({})\r\nconst outputFilename = ref('')\r\nconst resultUrl = ref('')\r\nconst resultFilename = ref('')\r\nconst errorMsg = ref('')\r\n\r\nonMounted(async () => {\r\n  const name = route.params.name\r\n  if (!name) { loading.value = false; return }\r\n  try {\r\n    const res = await api.getTemplate(name)\r\n    if (res?.success) {\r\n      template.value = res.data\r\n      outputFilename.value = res.data.template_name || name\r\n      const schema = res.data.schema || {}\r\n      if (schema.type === 'tiptap') {\r\n        variables.value = schema.variables || []\r\n        variables.value.forEach(v => { variableValues[v] = '' })\r\n      }\r\n    }\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n})\r\n\r\nfunction chipLabel(name) {\r\n  return '{{' + name + '}}'\r\n}\r\n\r\nasync function generate() {\r\n  errorMsg.value = ''\r\n  resultUrl.value = ''\r\n  resultFilename.value = ''\r\n  generating.value = true\r\n  try {\r\n    const filename = (outputFilename.value.trim() || template.value?.template_name || 'document')\r\n    const res = await api.generateHtmlPdf(\r\n      route.params.name,\r\n      { ...variableValues },\r\n      filename,\r\n    )\r\n    if (res?.success) {\r\n      resultUrl.value = res.data.file_url\r\n      resultFilename.value = res.data.filename\r\n      // Auto-trigger download\r\n      const a = document.createElement('a')\r\n      a.href = resultUrl.value\r\n      a.download = resultFilename.value\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      document.body.removeChild(a)\r\n    } else {\r\n      errorMsg.value = res?.error || 'Failed to generate PDF'\r\n    }\r\n  } catch (e) {\r\n    errorMsg.value = 'Network error. Please try again.'\r\n  } finally {\r\n    generating.value = false\r\n  }\r\n}\r\n</script>\r\n"],"names":["route","useRoute","useRouter","api","usePdfApi","loading","ref","generating","template","variables","variableValues","reactive","outputFilename","resultUrl","resultFilename","errorMsg","onMounted","__async","name","res","schema","v","chipLabel","generate","filename","_a","__spreadValues","a","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_cache","$event","$router","_createVNode","_unref","ArrowLeft","_hoisted_4","_Fragment","_hoisted_6","_hoisted_7","_hoisted_8","_toDisplayString","_hoisted_9","Pencil","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_renderList","_hoisted_15","_hoisted_16","_hoisted_17","_vModelText","_hoisted_19","_hoisted_20","_hoisted_22","_createBlock","FileDown","_createTextVNode","_hoisted_23","_hoisted_24","CheckCircle","Download","_hoisted_26","_hoisted_27","_hoisted_5"],"mappings":"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"}