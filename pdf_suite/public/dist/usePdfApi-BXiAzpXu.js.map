{"version":3,"file":"usePdfApi-BXiAzpXu.js","sources":["../../../frontend/src/composables/usePdfApi.js"],"sourcesContent":["/**\r\n * Composable for calling PDF Suite backend APIs.\r\n * All methods return { success, data?, error? } responses.\r\n */\r\n\r\nconst BASE_URL = '/api/method/pdf_suite.api'\r\n\r\nasync function callApi(endpoint, params = {}, method = 'POST') {\r\n  try {\r\n    const url = `${BASE_URL}.${endpoint}`\r\n\r\n    const options = {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json', 'X-Frappe-CSRF-Token': getCsrfToken() },\r\n      credentials: 'include',\r\n    }\r\n\r\n    if (method === 'GET') {\r\n      const searchParams = new URLSearchParams()\r\n      for (const [key, value] of Object.entries(params)) {\r\n        searchParams.set(key, typeof value === 'object' ? JSON.stringify(value) : value)\r\n      }\r\n      const fullUrl = searchParams.toString() ? `${url}?${searchParams}` : url\r\n      const res = await fetch(fullUrl, options)\r\n      const json = await res.json()\r\n      return json.message || json\r\n    }\r\n\r\n    options.body = JSON.stringify(params)\r\n    const res = await fetch(url, options)\r\n    const json = await res.json()\r\n    return json.message || json\r\n  } catch (e) {\r\n    return { success: false, error: e.message || 'Network error' }\r\n  }\r\n}\r\n\r\nfunction getCsrfToken() {\r\n  const cookie = document.cookie.split(';').find(c => c.trim().startsWith('csrf_token='))\r\n  return cookie ? cookie.split('=')[1] : ''\r\n}\r\n\r\nexport function usePdfApi() {\r\n  return {\r\n    // Extract\r\n    getPdfInfo: (fileUrl) => callApi('extract.get_pdf_info', { file_url: fileUrl }),\r\n    extractText: (fileUrl, pages) => callApi('extract.extract_text', { file_url: fileUrl, page_numbers: pages }),\r\n    extractTables: (fileUrl, pages) => callApi('extract.extract_tables', { file_url: fileUrl, page_numbers: pages }),\r\n    extractImages: (fileUrl, pages) => callApi('extract.extract_images', { file_url: fileUrl, page_numbers: pages }),\r\n\r\n    // Merge\r\n    mergePdfs: (fileUrls, outputName) => callApi('merge.merge_pdfs', { file_urls: fileUrls, output_filename: outputName }),\r\n    mergePdfsWithOptions: (configs, outputName) => callApi('merge.merge_pdfs_with_options', { file_configs: configs, output_filename: outputName }),\r\n\r\n    // Split\r\n    splitPdf: (fileUrl, ranges) => callApi('split.split_pdf', { file_url: fileUrl, page_ranges: ranges }),\r\n    splitEveryN: (fileUrl, n) => callApi('split.split_pdf_every_n', { file_url: fileUrl, n }),\r\n    extractPages: (fileUrl, pages, outputName) => callApi('split.extract_pages', { file_url: fileUrl, page_numbers: pages, output_filename: outputName }),\r\n\r\n    // Compress\r\n    compressPdf: (fileUrl, quality, outputName) => callApi('compress.compress_pdf', { file_url: fileUrl, quality, output_filename: outputName }),\r\n\r\n    // Watermark\r\n    addTextWatermark: (fileUrl, opts) => callApi('watermark.add_text_watermark', { file_url: fileUrl, ...opts }),\r\n    addImageWatermark: (fileUrl, opts) => callApi('watermark.add_image_watermark', { file_url: fileUrl, ...opts }),\r\n\r\n    // Protect\r\n    encryptPdf: (fileUrl, userPw, ownerPw, outputName) => callApi('protect.encrypt_pdf', { file_url: fileUrl, user_password: userPw, owner_password: ownerPw, output_filename: outputName }),\r\n    decryptPdf: (fileUrl, password, outputName) => callApi('protect.decrypt_pdf', { file_url: fileUrl, password, output_filename: outputName }),\r\n\r\n    // Flatten\r\n    flattenPdf: (fileUrl, outputName) => callApi('flatten.flatten_pdf', { file_url: fileUrl, output_filename: outputName }),\r\n\r\n    // Redact\r\n    redactAreas: (fileUrl, redactions, outputName) => callApi('redact.redact_areas', { file_url: fileUrl, redactions, output_filename: outputName }),\r\n    redactText: (fileUrl, searchText, outputName) => callApi('redact.redact_text', { file_url: fileUrl, search_text: searchText, output_filename: outputName }),\r\n\r\n    // OCR\r\n    ocrPdf: (fileUrl, lang, outputName) => callApi('ocr.ocr_pdf', { file_url: fileUrl, language: lang, output_filename: outputName }),\r\n    ocrImage: (fileUrl, lang) => callApi('ocr.ocr_image_to_text', { file_url: fileUrl, language: lang }),\r\n\r\n    // Convert\r\n    pdfToDocx: (fileUrl, outputName) => callApi('convert.pdf_to_docx', { file_url: fileUrl, output_filename: outputName }),\r\n    docxToPdf: (fileUrl, outputName) => callApi('convert.docx_to_pdf', { file_url: fileUrl, output_filename: outputName }),\r\n    htmlToPdf: (html, outputName) => callApi('convert.html_to_pdf', { html_content: html, output_filename: outputName }),\r\n\r\n    // Document sessions\r\n    exportEdited: (fileUrl, textMods, outputName) => callApi('document.export_edited_pdf', { file_url: fileUrl, text_modifications: textMods, output_filename: outputName }),\r\n    saveSession: (fileUrl, annotations, mods, name) => callApi('document.save_edit_session', { file_url: fileUrl, annotations, page_modifications: mods, session_name: name }),\r\n    loadSession: (name) => callApi('document.load_edit_session', { session_name: name }),\r\n    listSessions: () => callApi('document.list_edit_sessions', {}, 'GET'),\r\n\r\n    // Templates\r\n    saveTemplate: (name, schema, basePdf, desc) => callApi('template.save_template', { name, schema, base_pdf: basePdf, description: desc }),\r\n    getTemplate: (name) => callApi('template.get_template', { template_name: name }, 'GET'),\r\n    listTemplates: () => callApi('template.list_templates', {}, 'GET'),\r\n    deleteTemplate: (name) => callApi('template.delete_template', { template_name: name }),\r\n    generateHtmlPdf: (templateName, variableData, outputFilename) => callApi('template.generate_html_pdf', { template_name: templateName, variable_data: JSON.stringify(variableData), output_filename: outputFilename || '' }),\r\n\r\n    // Batch\r\n    startBatch: (operation, fileUrls, options) => callApi('batch.start_batch', { operation, file_urls: fileUrls, options }),\r\n    getBatchStatus: (name) => callApi('batch.get_batch_status', { batch_name: name }, 'GET'),\r\n\r\n    // Upload file\r\n    uploadFile: async (file, isPrivate = 1) => {\r\n      const formData = new FormData()\r\n      formData.append('file', file)\r\n      formData.append('is_private', isPrivate)\r\n      formData.append('folder', 'Home')\r\n\r\n      try {\r\n        const res = await fetch('/api/method/upload_file', {\r\n          method: 'POST',\r\n          headers: { 'X-Frappe-CSRF-Token': getCsrfToken() },\r\n          credentials: 'include',\r\n          body: formData,\r\n        })\r\n        const json = await res.json()\r\n        if (json.message?.file_url) {\r\n          return { success: true, data: { file_url: json.message.file_url, name: json.message.name } }\r\n        }\r\n        return { success: false, error: 'Upload failed' }\r\n      } catch (e) {\r\n        return { success: false, error: e.message }\r\n      }\r\n    },\r\n  }\r\n}\r\n"],"names":["BASE_URL","callApi","_0","__async","endpoint","params","method","url","options","getCsrfToken","searchParams","key","value","fullUrl","json","e","cookie","c","usePdfApi","fileUrl","pages","fileUrls","outputName","configs","ranges","n","quality","opts","__spreadValues","userPw","ownerPw","password","redactions","searchText","lang","html","textMods","annotations","mods","name","schema","basePdf","desc","templateName","variableData","outputFilename","operation","file","isPrivate","_a","formData"],"mappings":"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"}